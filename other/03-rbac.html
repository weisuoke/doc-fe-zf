<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>03. RBAC | 珠峰架构</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.1657c744.css" as="style"><link rel="preload" href="/assets/js/app.2af561cb.js" as="script"><link rel="preload" href="/assets/js/2.b2a5c435.js" as="script"><link rel="preload" href="/assets/js/14.380c4ee7.js" as="script"><link rel="prefetch" href="/assets/js/10.2b2c8443.js"><link rel="prefetch" href="/assets/js/11.689524dc.js"><link rel="prefetch" href="/assets/js/12.849e2da9.js"><link rel="prefetch" href="/assets/js/13.c798d95d.js"><link rel="prefetch" href="/assets/js/15.d5753b2e.js"><link rel="prefetch" href="/assets/js/16.49eb1f17.js"><link rel="prefetch" href="/assets/js/17.5ecf2b4f.js"><link rel="prefetch" href="/assets/js/18.da9c8265.js"><link rel="prefetch" href="/assets/js/19.59d827ef.js"><link rel="prefetch" href="/assets/js/20.73eb42bb.js"><link rel="prefetch" href="/assets/js/21.8570b5b4.js"><link rel="prefetch" href="/assets/js/22.34094913.js"><link rel="prefetch" href="/assets/js/23.5209939b.js"><link rel="prefetch" href="/assets/js/24.53d92201.js"><link rel="prefetch" href="/assets/js/25.7241adf1.js"><link rel="prefetch" href="/assets/js/26.fecc2611.js"><link rel="prefetch" href="/assets/js/27.e50fca48.js"><link rel="prefetch" href="/assets/js/28.4c168acc.js"><link rel="prefetch" href="/assets/js/29.f5186710.js"><link rel="prefetch" href="/assets/js/3.ba1dcccd.js"><link rel="prefetch" href="/assets/js/30.33cb1c11.js"><link rel="prefetch" href="/assets/js/31.c088791d.js"><link rel="prefetch" href="/assets/js/32.3b724af5.js"><link rel="prefetch" href="/assets/js/33.f975c942.js"><link rel="prefetch" href="/assets/js/34.7d1f4bd2.js"><link rel="prefetch" href="/assets/js/35.26c11750.js"><link rel="prefetch" href="/assets/js/36.e8890e58.js"><link rel="prefetch" href="/assets/js/37.516eba46.js"><link rel="prefetch" href="/assets/js/38.4f8b8525.js"><link rel="prefetch" href="/assets/js/39.26f95568.js"><link rel="prefetch" href="/assets/js/4.fca74266.js"><link rel="prefetch" href="/assets/js/40.b9a8ffbb.js"><link rel="prefetch" href="/assets/js/41.fd02ea5f.js"><link rel="prefetch" href="/assets/js/42.d2483185.js"><link rel="prefetch" href="/assets/js/43.70bff2de.js"><link rel="prefetch" href="/assets/js/44.219702ca.js"><link rel="prefetch" href="/assets/js/45.aba93af9.js"><link rel="prefetch" href="/assets/js/46.447ba87c.js"><link rel="prefetch" href="/assets/js/47.519ddc28.js"><link rel="prefetch" href="/assets/js/48.fd8af347.js"><link rel="prefetch" href="/assets/js/49.b3783fa9.js"><link rel="prefetch" href="/assets/js/5.cc992e8b.js"><link rel="prefetch" href="/assets/js/50.0bb20f92.js"><link rel="prefetch" href="/assets/js/51.37ba1a59.js"><link rel="prefetch" href="/assets/js/52.054af132.js"><link rel="prefetch" href="/assets/js/53.5aca78a0.js"><link rel="prefetch" href="/assets/js/54.78c43f89.js"><link rel="prefetch" href="/assets/js/55.8ecaadc1.js"><link rel="prefetch" href="/assets/js/56.e844f110.js"><link rel="prefetch" href="/assets/js/57.530db0e9.js"><link rel="prefetch" href="/assets/js/58.8c839289.js"><link rel="prefetch" href="/assets/js/59.6634b409.js"><link rel="prefetch" href="/assets/js/6.b8b36e50.js"><link rel="prefetch" href="/assets/js/60.7ebe5787.js"><link rel="prefetch" href="/assets/js/61.bfe89a8b.js"><link rel="prefetch" href="/assets/js/62.4cdf6e8c.js"><link rel="prefetch" href="/assets/js/63.a0e80f0d.js"><link rel="prefetch" href="/assets/js/64.62a1b782.js"><link rel="prefetch" href="/assets/js/65.7be0994b.js"><link rel="prefetch" href="/assets/js/66.5a592a8e.js"><link rel="prefetch" href="/assets/js/67.40b4291c.js"><link rel="prefetch" href="/assets/js/68.2ac34b58.js"><link rel="prefetch" href="/assets/js/69.728773d5.js"><link rel="prefetch" href="/assets/js/7.0414e914.js"><link rel="prefetch" href="/assets/js/70.30137f66.js"><link rel="prefetch" href="/assets/js/71.7735c9fc.js"><link rel="prefetch" href="/assets/js/72.e9f43339.js"><link rel="prefetch" href="/assets/js/73.2d754e71.js"><link rel="prefetch" href="/assets/js/74.bf70dd09.js"><link rel="prefetch" href="/assets/js/75.18c28356.js"><link rel="prefetch" href="/assets/js/76.a0626bc9.js"><link rel="prefetch" href="/assets/js/77.dfde57e0.js"><link rel="prefetch" href="/assets/js/78.b380a0d6.js"><link rel="prefetch" href="/assets/js/79.f7bafb5d.js"><link rel="prefetch" href="/assets/js/8.c3544379.js"><link rel="prefetch" href="/assets/js/80.ade6c33e.js"><link rel="prefetch" href="/assets/js/81.6335ba85.js"><link rel="prefetch" href="/assets/js/82.9d01c14e.js"><link rel="prefetch" href="/assets/js/83.47911fdd.js"><link rel="prefetch" href="/assets/js/9.844fca3b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1657c744.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">珠峰架构</span></a> <div class="links"><!----> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/react/" class="sidebar-heading clickable"><span>react</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vue/" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/webpack/" class="sidebar-heading clickable"><span>webpack</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/flutter/" class="sidebar-heading clickable"><span>flutter</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/interview/" class="sidebar-heading clickable"><span>interview</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/other/" class="sidebar-heading clickable router-link-active open"><span>other</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/other/01-https.html" class="sidebar-link">01. HTTPS简介</a></li><li><a href="/other/02-serverless.html" class="sidebar-link">02. Serverless</a></li><li><a href="/other/03-rbac.html" class="active sidebar-link">03. RBAC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/other/03-rbac.html#_1-rbac" class="sidebar-link">1.RBAC</a></li><li class="sidebar-sub-header"><a href="/other/03-rbac.html#_2-后端" class="sidebar-link">2. 后端</a></li><li class="sidebar-sub-header"><a href="/other/03-rbac.html#_3-前端" class="sidebar-link">3. 前端</a></li></ul></li><li><a href="/other/04-websocket.html" class="sidebar-link">04. WebSocket</a></li><li><a href="/other/05-monitor.html" class="sidebar-link">05. 工业级前端监控</a></li><li><a href="/other/06-monitor-2.html" class="sidebar-link">06. 工业级前端监控2</a></li><li><a href="/other/07-binary.html" class="sidebar-link">07. 二进制</a></li><li><a href="/other/08-binary-2.html" class="sidebar-link">08. 二进制</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_03-rbac"><a href="#_03-rbac" class="header-anchor">#</a> 03. RBAC</h1> <h2 id="_1-rbac"><a href="#_1-rbac" class="header-anchor">#</a> 1.RBAC</h2> <ul><li>基于角色的权限访问控制（Role-Based Access Control）</li> <li>RBAC（Role-Based Access Control，基于角色的访问控制），就是用户通过角色与权限进行关联</li> <li>一个用户拥有若干角色,每一个角色拥有若干权限。这样，就构造成<code>用户-角色-权限</code>的授权模型</li> <li>在这种模型中，用户与角色之间，角色与权限之间一般是多对多的关系</li> <li>在RBAC中最重要的概念包括：用户(User)，角色(Role)，权限(Permission)</li></ul> <h3 id="_1-1-示意图"><a href="#_1-1-示意图" class="header-anchor">#</a> 1.1 示意图</h3> <p><img src="https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2020-05-06-082816.png" alt="rbacimage"></p> <h3 id="_1-2-表设计"><a href="#_1-2-表设计" class="header-anchor">#</a> 1.2 表设计</h3> <h3 id="_1-2-1-用户表-user"><a href="#_1-2-1-用户表-user" class="header-anchor">#</a> 1.2.1 用户表(user)</h3> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">字段名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">默认</th></tr></thead> <tbody><tr><td style="text-align:left;">id</td> <td style="text-align:left;">ID</td> <td style="text-align:left;">int(11)</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">userName</td> <td style="text-align:left;">用户名</td> <td style="text-align:left;">varchar(255)</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">password</td> <td style="text-align:left;">密码</td> <td style="text-align:left;">varchar(255)</td> <td style="text-align:left;"></td></tr></tbody></table> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span>  <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>userName<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'isadmin'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'isuser'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-2-2-角色表-role"><a href="#_1-2-2-角色表-role" class="header-anchor">#</a> 1.2.2 角色表(role)</h3> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">字段名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">默认</th></tr></thead> <tbody><tr><td style="text-align:left;">id</td> <td style="text-align:left;">ID</td> <td style="text-align:left;">int(11)</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">name</td> <td style="text-align:left;">名称</td> <td style="text-align:left;">varchar(255)</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">desc</td> <td style="text-align:left;">描述</td> <td style="text-align:left;">varchar(255)</td> <td style="text-align:left;"></td></tr></tbody></table> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>role<span class="token punctuation">`</span>  <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">desc</span><span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span> E

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'管理员'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'普通用户'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-2-3-权限表-permission"><a href="#_1-2-3-权限表-permission" class="header-anchor">#</a> 1.2.3 权限表(permission)</h3> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">字段名</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">默认</th></tr></thead> <tbody><tr><td style="text-align:left;">id</td> <td style="text-align:left;">ID</td> <td style="text-align:left;">int(11)</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">name</td> <td style="text-align:left;">名称</td> <td style="text-align:left;">varchar(255)</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">parent_id</td> <td style="text-align:left;">父ID</td> <td style="text-align:left;">int(11)</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">icon</td> <td style="text-align:left;">图标</td> <td style="text-align:left;">varchar(255)</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">key</td> <td style="text-align:left;">路径</td> <td style="text-align:left;">varchar(255)</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">type</td> <td style="text-align:left;">类型</td> <td style="text-align:left;">varchar(32)</td> <td style="text-align:left;"></td></tr></tbody></table> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>permission<span class="token punctuation">`</span>  <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token punctuation">`</span>parent_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>icon<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">key</span><span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">type</span><span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'授权平台'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'desktop'</span><span class="token punctuation">,</span> <span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token string">'menu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'角色管理'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">,</span> <span class="token string">'/api/role'</span><span class="token punctuation">,</span> <span class="token string">'menu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'用户管理'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'/api/user'</span><span class="token punctuation">,</span> <span class="token string">'menu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'权限管理'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'idcard'</span><span class="token punctuation">,</span> <span class="token string">'/api/resource'</span><span class="token punctuation">,</span> <span class="token string">'menu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'添加用户'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">,</span> <span class="token string">'/api/user/add'</span><span class="token punctuation">,</span> <span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'删除用户'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">,</span> <span class="token string">'/api/user/delete'</span><span class="token punctuation">,</span> <span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-2-4-角色用户表-role-user"><a href="#_1-2-4-角色用户表-role-user" class="header-anchor">#</a> 1.2.4 角色用户表(role_user)</h3> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">字段名</th> <th style="text-align:left;">类型</th></tr></thead> <tbody><tr><td style="text-align:left;">role_id</td> <td style="text-align:left;">角色ID</td> <td style="text-align:left;">int(11)</td></tr> <tr><td style="text-align:left;">user_id</td> <td style="text-align:left;">用户ID</td> <td style="text-align:left;">int(11)</td></tr></tbody></table> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>role_user<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>role_user<span class="token punctuation">`</span>  <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>role_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>role_id<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span> 

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role_user<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role_user<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-2-5-角色权限-role-permission"><a href="#_1-2-5-角色权限-role-permission" class="header-anchor">#</a> 1.2.5 角色权限(role_permission)</h3> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">字段名</th> <th style="text-align:left;">类型</th></tr></thead> <tbody><tr><td style="text-align:left;">role_id</td> <td style="text-align:left;">角色ID</td> <td style="text-align:left;">int(11)</td></tr> <tr><td style="text-align:left;">permission_id</td> <td style="text-align:left;">资源ID</td> <td style="text-align:left;">int(11)</td></tr></tbody></table> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>role_permission<span class="token punctuation">`</span>  <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>role_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>permission_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>role_id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>permission_id<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span> 

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role_permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role_permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role_permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role_permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role_permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role_permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role_permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>role_permission<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-2-6-数据库脚本"><a href="#_1-2-6-数据库脚本" class="header-anchor">#</a> 1.2.6 数据库脚本</h3> <ul><li><a href="http://img.zhufengpeixun.cn/cms.sql" target="_blank" rel="noopener noreferrer">cms.sql<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="_2-后端"><a href="#_2-后端" class="header-anchor">#</a> 2. 后端</h2> <h3 id="_2-1-初始化项目"><a href="#_2-1-初始化项目" class="header-anchor">#</a> 2.1.初始化项目</h3> <ul><li><a href="https://eggjs.org/zh-cn/intro/quickstart.html" target="_blank" rel="noopener noreferrer">egg.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://eggjs.org/api/" target="_blank" rel="noopener noreferrer">api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> client-side
<span class="token builtin class-name">cd</span> client-side
cnpm init egg --type<span class="token operator">=</span>ts
cnpm i 
cnpm run dev
</code></pre></div><h3 id="_2-2-支持mysql"><a href="#_2-2-支持mysql" class="header-anchor">#</a> 2.2.支持MYSQL</h3> <ul><li><a href="https://eggjs.org/zh-cn/tutorials/mysql.html" target="_blank" rel="noopener noreferrer">mysql<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="_2-2-1-安装"><a href="#_2-2-1-安装" class="header-anchor">#</a> 2.2.1 安装</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>cnpm i --save egg-mysql
</code></pre></div><h4 id="_2-2-2-开启插件"><a href="#_2-2-2-开启插件" class="header-anchor">#</a> 2.2.2 开启插件</h4> <ul><li>config\plugin.ts</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>import { EggPlugin } from 'egg';

const plugin: EggPlugin = {
<span class="token inserted-sign inserted">+  mysql: {
+    enable: true,
+    package: 'egg-mysql'
+  }
</span>};
export default plugin;
</code></pre></div><h4 id="_2-2-3-配置数据源"><a href="#_2-2-3-配置数据源" class="header-anchor">#</a> 2.2.3 配置数据源</h4> <p>config\config.default.ts</p> <div class="language-diff extra-class"><pre class="language-diff"><code>import { EggAppConfig, EggAppInfo, PowerPartial } from 'egg';

export default (appInfo: EggAppInfo) =&gt; {
<span class="token unchanged">  const config = {} as PowerPartial&lt;EggAppConfig&gt;;
</span>
<span class="token unchanged">  // override config from framework / plugin
  // use for cookie sign key, should change to your own and keep security
  config.keys = appInfo.name + '_1580620890875_8931';
</span>
<span class="token unchanged">  // add your egg config in here
  config.middleware = [];
</span>
<span class="token inserted-sign inserted">+  config.mysql = {
+    // 单数据库信息配置
+    client: {
+      // host
+      host: 'localhost',
+      // 端口号
+      port: '3306',
+      // 用户名
+      user: 'root',
+      // 密码
+      password: 'root',
+      // 数据库名
+      database: 'cms'
+    },
+    // 是否加载到 app 上，默认开启
+    app: true,
+    // 是否加载到 agent 上，默认关闭
+    agent: false,
+  };
</span><span class="token unchanged">  // add your special config in here
  const bizConfig = {
    sourceUrl: `https://github.com/eggjs/examples/tree/master/${appInfo.name}`,
  };
</span>
<span class="token unchanged">  // the return config will combines to EggAppConfig
  return {
    ...config,
    ...bizConfig,
  };
</span>};
</code></pre></div><h4 id="_2-2-4-配置声明文件"><a href="#_2-2-4-配置声明文件" class="header-anchor">#</a> 2.2.4 配置声明文件</h4> <ul><li>config\config.default.ts</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>import 'egg';

declare module 'egg' {
<span class="token inserted-sign inserted">+    interface Application {
+        mysql: any;
+    }
</span>}
</code></pre></div><h4 id="_2-2-4-使用mysql"><a href="#_2-2-4-使用mysql" class="header-anchor">#</a> 2.2.4 使用mysql</h4> <ul><li>app\controller\home.ts</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>import { Controller } from 'egg';

export default class HomeController extends Controller {
<span class="token unchanged">  public async index() {
    const { ctx } = this;
</span><span class="token inserted-sign inserted">+    let users = await this.app.mysql.select('user');
+    ctx.body = {
+      success: true,
+      data: users
+    };
</span><span class="token unchanged">    //ctx.body = await ctx.service.test.sayHi('egg');
  }
</span>}
</code></pre></div><h3 id="_2-3-passport"><a href="#_2-3-passport" class="header-anchor">#</a> 2.3.Passport</h3> <ul><li><a href="https://eggjs.org/zh-cn/tutorials/passport.html" target="_blank" rel="noopener noreferrer">passport<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="_2-3-1-安装"><a href="#_2-3-1-安装" class="header-anchor">#</a> 2.3.1 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>cnpm i <span class="token operator">--</span>save egg<span class="token operator">-</span>passport passport<span class="token operator">-</span>local
</code></pre></div><h4 id="_2-3-2-config-plugin-ts"><a href="#_2-3-2-config-plugin-ts" class="header-anchor">#</a> 2.3.2 config\plugin.ts</h4> <p>config\plugin.ts</p> <div class="language-diff extra-class"><pre class="language-diff"><code>import { EggPlugin } from 'egg';

const plugin: EggPlugin = {
<span class="token unchanged">  mysql: {
    enable: true,
    package: 'egg-mysql'
  },
</span><span class="token inserted-sign inserted">+  passport: {
+    enable: true,
+    package: 'egg-passport'
+  },
+  passportLocal: {
+    enable: true,
+    package: 'egg-passport-local'
+  }
</span>};

export default plugin;
</code></pre></div><h4 id="_2-3-3-typings-index-d-ts"><a href="#_2-3-3-typings-index-d-ts" class="header-anchor">#</a> 2.3.3 typings\index.d.ts</h4> <p>typings\index.d.ts</p> <div class="language-diff extra-class"><pre class="language-diff"><code>import 'egg';

declare module 'egg' {
<span class="token unchanged">    interface Application {
         mysql: any;
</span><span class="token inserted-sign inserted">+        passport: any;
</span><span class="token unchanged">    }
</span>}
</code></pre></div><h4 id="_2-3-4-app-ts"><a href="#_2-3-4-app-ts" class="header-anchor">#</a> 2.3.4 app.ts</h4> <p>app.ts</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> IBoot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'egg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Strategy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'passport-local'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">FooBoot</span> <span class="token keyword">implements</span> <span class="token class-name">IBoot</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> app<span class="token operator">:</span> Application<span class="token punctuation">;</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">app<span class="token operator">:</span> Application</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">=</span> app<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">configDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//Config, plugin files have loaded.</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span>passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Strategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span> usernameField<span class="token operator">:</span> <span class="token string">'userName'</span><span class="token punctuation">,</span> passReqToCallback<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> userName<span class="token punctuation">,</span> password<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> where<span class="token operator">:</span> <span class="token punctuation">{</span> userName<span class="token punctuation">,</span> password <span class="token punctuation">}</span><span class="token punctuation">,</span> limit<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> offset<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>users <span class="token operator">&amp;&amp;</span> users<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> user <span class="token operator">=</span> users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> roles <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT role.* FROM user INNER JOIN role_user ON user.id = role_user.user_id inner JOIN role ON role_user.role_id=role.id WHERE user.id=?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span>currentAuthority <span class="token operator">=</span> roles<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">role</span> <span class="token operator">=&gt;</span> role<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                req<span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-3-5-app-controller-user-ts"><a href="#_2-3-5-app-controller-user-ts" class="header-anchor">#</a> 2.3.5 app\controller\user.ts</h4> <p>app\controller\user.ts</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Controller <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'egg'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">userController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">loginCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        status<span class="token operator">:</span> <span class="token string">'ok'</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
        currentAuthority<span class="token operator">:</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">.</span>currentAuthority
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        error<span class="token operator">:</span> <span class="token string">'用户名或密码错误'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">addUser2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> user <span class="token operator">=</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
      <span class="token keyword">let</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
      <span class="token keyword">let</span> permissions <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT permission.key FROM user INNER JOIN role_user ON user.id = role_user.user_id inner JOIN role_permission ON role_user.role_id=role_permission.role_id  INNER JOIN permission ON role_permission.permission_id = permission.id  WHERE user.id=?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> allowed <span class="token operator">=</span> permissions<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>allowed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
          success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          error<span class="token operator">:</span> <span class="token string">'添加用户成功'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
          success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          error<span class="token operator">:</span> <span class="token string">'用户未授权'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        error<span class="token operator">:</span> <span class="token string">'用户未授权'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token string">'添加用户成功'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-3-6-middleware-auth-ts"><a href="#_2-3-6-middleware-auth-ts" class="header-anchor">#</a> 2.3.6 middleware\auth.ts</h4> <p>app\middleware\auth.ts</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">_options<span class="token punctuation">,</span> _app</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> user <span class="token operator">=</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
            <span class="token keyword">let</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
            <span class="token keyword">let</span> permissions <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT permission.key FROM user INNER JOIN role_user ON user.id = role_user.user_id inner JOIN role_permission ON role_user.role_id=role_permission.role_id  INNER JOIN permission ON role_permission.permission_id = permission.id  WHERE user.id=?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> allowed <span class="token operator">=</span> permissions<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>allowed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span> success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token string">'用户未授权'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span> success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token string">'用户未授权'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-3-7-app-router-ts"><a href="#_2-3-7-app-router-ts" class="header-anchor">#</a> 2.3.7 app\router.ts</h4> <ul><li><a href="https://eggjs.org/zh-cn/basics/middleware.html#%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">middleware<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>app\router.ts</p> <div class="language-diff extra-class"><pre class="language-diff"><code>import { Application } from 'egg';
export default (app: Application) =&gt; {
<span class="token unchanged">  const { controller, router } = app;
  router.get('/', controller.home.index);
</span><span class="token inserted-sign inserted">+  const localStrategy = app.passport.authenticate('local', { successRedirect: '/server/api/loginCallback', failureRedirect: '/server/api/loginCallback' });
+  router.post('/api/login/account', localStrategy);
+  const auth = app.middleware.auth();
+  router.post('/api/user/add', auth, controller.user.addUser);
+  router.get('/api/loginCallback', controller.user.loginCallback);
</span>};
</code></pre></div><h4 id="_2-3-8-config-config-default-ts"><a href="#_2-3-8-config-config-default-ts" class="header-anchor">#</a> 2.3.8 config\config.default.ts</h4> <ul><li>config\config.default.ts</li> <li><a href="https://eggjs.org/zh-cn/core/security.html#web-%E5%AE%89%E5%85%A8%E6%A6%82%E5%BF%B5" target="_blank" rel="noopener noreferrer">csrf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted">+  config.security = {
+    csrf: false
+  }
</span></code></pre></div><h4 id="_2-3-9-测试"><a href="#_2-3-9-测试" class="header-anchor">#</a> 2.3.9 测试</h4> <ul><li><a href="https://insomnia.rest/" target="_blank" rel="noopener noreferrer">insomnia<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://img.zhufengpeixun.cn/Insomnia.Setup.7.0.6.zip" target="_blank" rel="noopener noreferrer">window<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://eggjs.org/zh-cn/core/development.html#%E8%B0%83%E8%AF%95" target="_blank" rel="noopener noreferrer">debug<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>ctrl+shift+p</p> <div class="language-js extra-class"><pre class="language-js"><code>Debug<span class="token operator">:</span> Toggle Auto Attach
</code></pre></div><h2 id="_3-前端"><a href="#_3-前端" class="header-anchor">#</a> 3. 前端</h2> <h3 id="_3-1-启动项目"><a href="#_3-1-启动项目" class="header-anchor">#</a> 3.1. 启动项目</h3> <ul><li><a href="https://github.com/umijs/create-umi" target="_blank" rel="noopener noreferrer">create-umi<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>umi <span class="token operator">-</span>v
umi ui
</code></pre></div><h3 id="_3-2-设置代理"><a href="#_3-2-设置代理" class="header-anchor">#</a> 3.2. 设置代理</h3> <h4 id="_3-2-1-config-config-ts"><a href="#_3-2-1-config-config-ts" class="header-anchor">#</a> 3.2.1 config\config.ts</h4> <p>config\config.ts</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted">+  proxy: {
+    '/server/api/': {
+      target: 'http://localhost:7001/',
+      changeOrigin: true,
+      pathRewrite: { '^/server': '' },
+    },
+  },
</span></code></pre></div><h3 id="_3-3-前端项目"><a href="#_3-3-前端项目" class="header-anchor">#</a> 3.3. 前端项目</h3> <h4 id="_3-3-1-config-config-ts"><a href="#_3-3-1-config-config-ts" class="header-anchor">#</a> 3.3.1 config\config.ts</h4> <p>config\config.ts</p> <div class="language-js extra-class"><pre class="language-js"><code>  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/user'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> <span class="token string">'../layouts/UserLayout'</span><span class="token punctuation">,</span>
      routes<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
          path<span class="token operator">:</span> <span class="token string">'/user/login'</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'./user/login'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> <span class="token string">'../layouts/SecurityLayout'</span><span class="token punctuation">,</span>
      routes<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'../layouts/BasicLayout'</span><span class="token punctuation">,</span>
          authority<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          routes<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
              redirect<span class="token operator">:</span> <span class="token string">'/welcome'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              path<span class="token operator">:</span> <span class="token string">'/welcome'</span><span class="token punctuation">,</span>
              name<span class="token operator">:</span> <span class="token string">'welcome'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'smile'</span><span class="token punctuation">,</span>
              component<span class="token operator">:</span> <span class="token string">'./Welcome'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              path<span class="token operator">:</span> <span class="token string">'/admin'</span><span class="token punctuation">,</span>
              name<span class="token operator">:</span> <span class="token string">'权限平台'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'crown'</span><span class="token punctuation">,</span>
              <span class="token comment">//component: './Admin',</span>
              <span class="token comment">//authority: ['admin'],</span>
              routes<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                  name<span class="token operator">:</span> <span class="token string">'角色管理'</span><span class="token punctuation">,</span>
                  icon<span class="token operator">:</span> <span class="token string">'smile'</span><span class="token punctuation">,</span>
                  path<span class="token operator">:</span> <span class="token string">'/admin/role'</span><span class="token punctuation">,</span>
                  component<span class="token operator">:</span> <span class="token string">'./admin/Role'</span><span class="token punctuation">,</span>
                  authority<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                  name<span class="token operator">:</span> <span class="token string">'用户管理'</span><span class="token punctuation">,</span>
                  icon<span class="token operator">:</span> <span class="token string">'smile'</span><span class="token punctuation">,</span>
                  path<span class="token operator">:</span> <span class="token string">'/admin/user'</span><span class="token punctuation">,</span>
                  component<span class="token operator">:</span> <span class="token string">'./admin/User'</span><span class="token punctuation">,</span>
                  authority<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                  name<span class="token operator">:</span> <span class="token string">'权限管理'</span><span class="token punctuation">,</span>
                  icon<span class="token operator">:</span> <span class="token string">'smile'</span><span class="token punctuation">,</span>
                  path<span class="token operator">:</span> <span class="token string">'/admin/permission'</span><span class="token punctuation">,</span>
                  component<span class="token operator">:</span> <span class="token string">'./admin/Permission'</span><span class="token punctuation">,</span>
                  authority<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              component<span class="token operator">:</span> <span class="token string">'./404'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          component<span class="token operator">:</span> <span class="token string">'./404'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      component<span class="token operator">:</span> <span class="token string">'./404'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="_3-3-2-user-index-tsx"><a href="#_3-3-2-user-index-tsx" class="header-anchor">#</a> 3.3.2 User\index.tsx</h4> <p>src\pages\admin\User\index.tsx</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted">+import { queryRule, updateRule, addUser, removeRule } from './service';
+import Authorized from '@/utils/Authorized';
+&lt;Authorized authority={['admin', 'user']} noMatch={null}&gt;
+            &lt;Button icon={'plus'} type=&quot;primary&quot; onClick={() =&gt; handleModalVisible(true)}&gt;
+              新建
+           &lt;/Button&gt;
+&lt;/Authorized&gt;
</span></code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">5/6/2020, 4:31:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/other/02-serverless.html" class="prev">
        02. Serverless
      </a></span> <span class="next"><a href="/other/04-websocket.html">
        04. WebSocket
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2af561cb.js" defer></script><script src="/assets/js/2.b2a5c435.js" defer></script><script src="/assets/js/14.380c4ee7.js" defer></script>
  </body>
</html>
