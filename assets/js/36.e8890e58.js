(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{363:function(t,n,s){"use strict";s.r(n);var a=s(33),e=Object(a.a)({},(function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_02-dva-source"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_02-dva-source"}},[t._v("#")]),t._v(" 02. dva source")]),t._v(" "),s("h2",{attrs:{id:"_1-dva介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-dva介绍"}},[t._v("#")]),t._v(" 1.dva介绍")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/dvajs/dva",target:"_blank",rel:"noopener noreferrer"}},[t._v("dva"),s("OutboundLink")],1),t._v("首先是一个基于 "),s("code",[t._v("redux")]),t._v(" 和 "),s("code",[t._v("redux-saga")]),t._v(" 的数据流方案，然后为了简化开发体验,dva 还额外内置了 "),s("code",[t._v("react-router")]),t._v(" 和 "),s("code",[t._v("fetch")]),t._v(",所以也可以理解为一个轻量级的应用框架")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2020-04-23-020203.png",alt:"dva"}})]),t._v(" "),s("h3",{attrs:{id:"_1-1-前置知识"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-前置知识"}},[t._v("#")]),t._v(" 1.1 前置知识")]),t._v(" "),s("ul",[s("li",[t._v("react")]),t._v(" "),s("li",[t._v("react-router-dom")]),t._v(" "),s("li",[t._v("redux")]),t._v(" "),s("li",[t._v("react-redux")]),t._v(" "),s("li",[t._v("connected-react-router")]),t._v(" "),s("li",[t._v("history")]),t._v(" "),s("li",[t._v("dva")])]),t._v(" "),s("h2",{attrs:{id:"_2-初始化项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-初始化项目"}},[t._v("#")]),t._v(" 2. 初始化项目")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("create"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("react"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("app zhufeng"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dva"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("source"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("typescript "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("typescript\ncd  zhufeng"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dva"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("source"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("typescript\ncnpm install dva@"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.6")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("beta"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" redux react"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("redux react"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("router"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dom connected"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("react"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("router history "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("save\nnpm start\n")])])]),s("h2",{attrs:{id:"_3-基本计数器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-基本计数器"}},[t._v("#")]),t._v(" 3. 基本计数器")]),t._v(" "),s("h3",{attrs:{id:"_3-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-使用"}},[t._v("#")]),t._v(" 3.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_3-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-index-tsx"}},[t._v("#")]),t._v(" 3.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" dva"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" connect "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./dva'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dva")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("model")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'counter'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" number"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    reducers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" number"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("number "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Counter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n            ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("number"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n            ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onClick")]),s("span",{pre:!0,attrs:{class:"token script language-javascript"}},[s("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"counter/add"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n        ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ConnectedCounter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("counter\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Counter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("router")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConnectedCounter")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#root'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-实现"}},[t._v("#")]),t._v(" 3.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_3-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 3.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ReactDOM "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react-dom'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createStore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" combineReducers "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'redux'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Provider "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react-redux'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" DvaInstance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Router"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Model "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./typings'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" prefixNamespace "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./prefixNamespace'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" connect "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DvaInstance "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        _models"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        router"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        _router"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        start\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" initialReducers "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("model")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("model"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Model")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" prefixedModel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prefixNamespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prefixedModel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" prefixedModel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("router")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("router"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Router")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_router "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" router"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("root")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" model "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            initialReducers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getReducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" rootReducer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createReducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" store "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createStore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rootReducer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ReactDOM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Provider")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("store")]),s("span",{pre:!0,attrs:{class:"token script language-javascript"}},[s("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("store"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_router")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Provider")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createReducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("combineReducers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initialReducers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getReducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("model")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" reducers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" defaultState "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("reducer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" defaultState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" reducer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" reducers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reducer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" reducer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./typings'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-2-2-prefixnamespace-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-prefixnamespace-tsx"}},[t._v("#")]),t._v(" 3.2.2 prefixNamespace.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\prefixNamespace.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NAMESPACE_SEP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./constants'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("memo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newKey "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NAMESPACE_SEP")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        memo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" memo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prefixNamespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("model")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reducers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reducers "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reducers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-2-3-constants-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-constants-tsx"}},[t._v("#")]),t._v(" 3.2.3 constants.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\constants.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NAMESPACE_SEP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-2-4-typings-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-typings-tsx"}},[t._v("#")]),t._v(" 3.2.4 typings.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\typings.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Dispatch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Reducer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" AnyAction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" MiddlewareAPI"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" StoreEnhancer "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'redux'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" History "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'history'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReducersMapObject")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Reducer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReducerEnhancer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reducer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Reducer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EffectsCommandMap")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    put"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AnyAction")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("action"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    call"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Function"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    select"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Function"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    take"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Function"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    cancel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Function"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" type EffectType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'takeEvery'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'takeLatest'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'watcher'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'throttle'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" type EffectWithType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" EffectType "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" type "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("Effect")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("action"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" AnyAction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" effects"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" EffectsCommandMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" type ReducersMapObjectWithEnhancer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ReducersMapObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ReducerEnhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EffectsMapObject")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Effect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" EffectWithType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SubscriptionsMapObject")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Subscription"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SubscriptionAPI")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    history"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" History"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    dispatch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Dispatch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" type "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("Subscription")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("api"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" SubscriptionAPI"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" done"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Model")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    reducers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ReducersMapObject "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ReducersMapObjectWithEnhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    effects"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" EffectsMapObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    subscriptions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" SubscriptionsMapObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RouterAPI")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    history"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" History"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    app"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DvaInstance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Router")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("api"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" RouterAPI"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSX")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Element "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("onActionFunc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("api"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" MiddlewareAPI"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Hooks")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    onError"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dispatch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Dispatch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    onAction"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" onActionFunc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" onActionFunc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    onStateChange"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    onReducer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ReducerEnhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    onEffect"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    onHmr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    extraReducers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ReducersMapObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    extraEnhancers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" StoreEnhancer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DvaInstance")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Record")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//use: (hooks: Hooks) => void,")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("model")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("model"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Model")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//unmodel: (namespace: string) => void,")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("router")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("router"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Router")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("selector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HTMLElement "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_4-支持effects"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-支持effects"}},[t._v("#")]),t._v(" 4. 支持effects")]),t._v(" "),s("h3",{attrs:{id:"_4-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-使用"}},[t._v("#")]),t._v(" 4.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_4-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-index-tsx"}},[t._v("#")]),t._v(" 4.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\nconst app = dva();\napp.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    effects: {\n+        *asyncAdd(action, { call, put }) {\n+            yield call(delay, 1000);\n+            yield put({ type: 'counter/add' });\n+        }\n+    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    return (\n        <div>\n            <p>{props.number}</p>\n            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n')]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步+</button>\n')]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        </div>\n    )\n")]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    (state) => state.counter\n")]),t._v(")(Counter);\napp.router(() => <ConnectedCounter />);\napp.start('#root');\n\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+function delay(ms) {\n+    return new Promise((resolve) => {\n+        setTimeout(function () {\n+            resolve();\n+        }, ms);\n+    });\n+}\n")])])])]),s("h3",{attrs:{id:"_4-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-实现"}},[t._v("#")]),t._v(" 4.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_4-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 4.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import { createStore, combineReducers, applyMiddleware } from 'redux';\n+import createSagaMiddleware from 'redux-saga';\n+import * as sagaEffects from 'redux-saga/effects';\n+import { NAMESPACE_SEP } from './constants';\n")]),t._v("import { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\nexport { connect };\n\nexport default function () {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n    const initialReducers = {};\n    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n    function router(router: Router) {\n        app._router = router;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function start(root) {\n        for (const model of app._models) {\n            initialReducers[model.namespace] = getReducer(model);\n        }\n        let rootReducer = createReducer();\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        const sagas = getSagas(app);\n+        const sagaMiddleware = createSagaMiddleware();\n+        let store = createStore(rootReducer, applyMiddleware(sagaMiddleware));\n+        sagas.forEach(saga => sagaMiddleware.run(saga));\n+        ReactDOM.render(<Provider store={store}>{app._router()}</Provider>, document.querySelector(root));\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        function createReducer() {\n           return combineReducers(initialReducers);\n        }\n    }\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    function getSagas(app) {\n+        let sagas: Array<any> = [];\n+        for (const model of app._models) {\n+            sagas.push(getSaga(model.effects, model));\n+        }\n+        return sagas;\n+    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+function getSaga(effects, model) {\n+    return function* () {\n+        for (const key in effects) {\n+            const watcher = getWatcher(key, model.effects[key], model);\n+            yield sagaEffects.fork(watcher);\n+        }\n+    };\n+}\n+function getWatcher(key, effect, model) {\n+    return function* () {\n+        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n+            yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n+        });\n+    };\n+}\n+function prefixType(type, model) {\n+    if (type.indexOf('/') === -1) {\n+        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n+    }\n+    return type;\n+}\n")]),t._v("function getReducer(model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers, state: defaultState } = model;\n    let reducer = (state = defaultState, action) => {\n        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n    return reducer;\n")]),t._v("}\n")])])]),s("h4",{attrs:{id:"_4-2-2-prefixnamespace-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-prefixnamespace-tsx"}},[t._v("#")]),t._v(" 4.2.2 prefixNamespace.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\prefixNamespace.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import { NAMESPACE_SEP } from './constants';\nfunction prefix(obj, namespace) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return Object.keys(obj).reduce((memo, key) => {\n        const newKey = `${namespace}${NAMESPACE_SEP}${key}`;\n        memo[newKey] = obj[key];\n        return memo;\n    }, {});\n")]),t._v("}\nexport default function prefixNamespace(model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (model.reducers)\n        model.reducers = prefix(model.reducers, model.namespace);\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    if (model.effects) {\n+        model.effects = prefix(model.effects, model.namespace);\n+    }\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return model;\n")]),t._v("}\n")])])]),s("h2",{attrs:{id:"_5-支持路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-支持路由"}},[t._v("#")]),t._v(" 5. 支持路由")]),t._v(" "),s("h3",{attrs:{id:"_5-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-使用"}},[t._v("#")]),t._v(" 5.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_5-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-index-tsx"}},[t._v("#")]),t._v(" 5.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import { Router, Route } from './dva/router';\n")]),t._v("const app = dva();\napp.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n    effects: {\n        *asyncAdd(action, { call, put }) {\n            yield call(delay, 1000);\n            yield put({ type: 'counter/add' });\n        }\n    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    return (\n        <div>\n            <p>{props.number}</p>\n            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步+</button>\n        </div>\n    )\n')]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    (state) => state.counter\n")]),t._v(")(Counter);\nconst Home = () => <div>Home</div>\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+app.router((api: any) => (\n+    <Router history={api.history}>\n+        <>\n+            <Route path="/" exact={true} component={Home} />\n+            <Route path="/counter" component={ConnectedCounter} />\n+        </>\n+    </Router>\n+));\n')]),t._v("app.start('#root');\n\nfunction delay(ms) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return new Promise((resolve) => {\n        setTimeout(function () {\n            resolve();\n        }, ms);\n    });\n")]),t._v("}\n")])])]),s("h3",{attrs:{id:"_5-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-实现"}},[t._v("#")]),t._v(" 5.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_5-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 5.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { createStore, combineReducers, applyMiddleware } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\nimport * as sagaEffects from 'redux-saga/effects';\nimport { NAMESPACE_SEP } from './constants';\nimport { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import { createHashHistory } from 'history';\n+let history = createHashHistory();\n")]),t._v("export { connect };\n\nexport default function () {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n    const initialReducers = {};\n    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n    function router(router: Router) {\n        app._router = router;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function start(root) {\n        for (const model of app._models) {\n            initialReducers[model.namespace] = getReducer(model);\n        }\n        let rootReducer = createReducer();\n        const sagas = getSagas(app);\n        const sagaMiddleware = createSagaMiddleware();\n        let store = createStore(rootReducer, applyMiddleware(sagaMiddleware));\n        sagas.forEach(saga => sagaMiddleware.run(saga));\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        ReactDOM.render(<Provider store={store}>{app._router({ history })}</Provider>, document.querySelector(root))\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        function createReducer() {\n           return combineReducers(initialReducers);\n        }\n    }\n    function getSagas(app) {\n        let sagas: Array<any> = [];\n        for (const model of app._models) {\n            sagas.push(getSaga(model.effects, model));\n        }\n        return sagas;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\nfunction getSaga(effects, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        for (const key in effects) {\n            const watcher = getWatcher(key, model.effects[key], model);\n            yield sagaEffects.fork(watcher);\n        }\n    };\n")]),t._v("}\nfunction getWatcher(key, effect, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n            yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n        });\n    };\n")]),t._v("}\nfunction prefixType(type, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (type.indexOf('/') === -1) {\n        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n    }\n    return type;\n")]),t._v("}\nfunction getReducer(model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers, state: defaultState } = model;\n    let reducer = (state = defaultState, action) => {\n        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n    return reducer;\n")]),t._v("}\nexport * from './typings';\n")])])]),s("h4",{attrs:{id:"_5-2-2-router-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-2-router-tsx"}},[t._v("#")]),t._v(" 5.2.2 router.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\router.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("export * from 'react-router-dom';\n")])])]),s("h2",{attrs:{id:"_6-跳转路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-跳转路径"}},[t._v("#")]),t._v(" 6. 跳转路径")]),t._v(" "),s("h3",{attrs:{id:"_6-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-使用"}},[t._v("#")]),t._v(" 6.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_6-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-1-index-tsx"}},[t._v("#")]),t._v(" 6.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import { Router, Route, routerRedux } from './dva/router';\n+import { ConnectedRouter } from 'connected-react-router';\n")]),t._v("const app = dva();\napp.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n    effects: {\n        *asyncAdd(action, { call, put }) {\n            yield call(delay, 1000);\n            yield put({ type: 'counter/add' });\n        },\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        *goto({ to }, { put }) {\n+            yield put(routerRedux.push(to));\n+        }\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    return (\n        <div>\n            <p>{props.number}</p>\n            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步+</button>\n')]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            <button onClick={() => props.dispatch({ type: \"counter/goto\", to: '/' })}>跳转到/</button>\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        </div>\n    )\n")]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    (state) => state.counter\n")]),t._v(")(Counter);\nconst Home = () => <div>Home</div>\napp.router((api: any) => (\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    <ConnectedRouter history={api.history}>\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('        <>\n            <Route path="/" exact={true} component={Home} />\n            <Route path="/counter" component={ConnectedCounter} />\n        </>\n')]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    </ConnectedRouter>\n")]),t._v("));\napp.start('#root');\n\nfunction delay(ms) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return new Promise((resolve) => {\n        setTimeout(function () {\n            resolve();\n        }, ms);\n    });\n")]),t._v("}\n")])])]),s("h3",{attrs:{id:"_6-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-实现"}},[t._v("#")]),t._v(" 6.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_6-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 6.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { createStore, combineReducers, applyMiddleware } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\nimport * as sagaEffects from 'redux-saga/effects';\nimport { NAMESPACE_SEP } from './constants';\nimport { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\nimport { createHashHistory } from 'history';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+import { routerMiddleware, connectRouter, ConnectedRouter } from "connected-react-router";\n')]),t._v("let history = createHashHistory();\nexport { connect };\n\nexport default function () {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    const initialReducers = { router: connectRouter(history) };\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n    function router(router: Router) {\n        app._router = router;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function start(root) {\n        for (const model of app._models) {\n            initialReducers[model.namespace] = getReducer(model);\n        }\n        let rootReducer = createReducer();\n        const sagas = getSagas(app);\n        const sagaMiddleware = createSagaMiddleware();\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        let store = createStore(rootReducer, applyMiddleware(routerMiddleware(history), sagaMiddleware));\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        sagas.forEach(saga => sagaMiddleware.run(saga));\n        ReactDOM.render(<Provider store={store}>{app._router({ history })}</Provider>, document.querySelector(root));\n        function createReducer() {\n           return combineReducers(initialReducers);\n        }\n    }\n    function getSagas(app) {\n        let sagas: Array<any> = [];\n        for (const model of app._models) {\n            sagas.push(getSaga(model.effects, model));\n        }\n        return sagas;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\nfunction getSaga(effects, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        for (const key in effects) {\n            const watcher = getWatcher(key, model.effects[key], model);\n            yield sagaEffects.fork(watcher);\n        }\n    };\n")]),t._v("}\nfunction getWatcher(key, effect, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n            yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n        });\n    };\n")]),t._v("}\nfunction prefixType(type, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (type.indexOf('/') === -1) {\n        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n    }\n    return type;\n")]),t._v("}\nfunction getReducer(model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers, state: defaultState } = model;\n    let reducer = (state = defaultState, action) => {\n        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n    return reducer;\n")]),t._v("}\nexport * from './typings';\n")])])]),s("h4",{attrs:{id:"_6-2-2-src-dva-router-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-2-src-dva-router-tsx"}},[t._v("#")]),t._v(" 6.2.2 src\\dva\\router.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\router.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import * as routerRedux from 'connected-react-router';\nexport * from 'react-router-dom';\nexport {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    routerRedux\n")]),t._v("}\n")])])]),s("h2",{attrs:{id:"_7-dva-loading"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-dva-loading"}},[t._v("#")]),t._v(" 7. dva-loading")]),t._v(" "),s("ul",[s("li",[t._v("Auto loading data binding plugin for dva. You don't need to write showLoading and hideLoading any more.")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/dvajs/dva/tree/master/packages/dva-loading",target:"_blank",rel:"noopener noreferrer"}},[t._v("dva-loading"),s("OutboundLink")],1)])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://img.zhufengpeixun.cn/dva-loading.png",alt:"dva-loading"}})]),t._v(" "),s("h3",{attrs:{id:"_7-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-使用"}},[t._v("#")]),t._v(" 7.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_7-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-1-index-tsx"}},[t._v("#")]),t._v(" 7.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\nimport { Router, Route, routerRedux } from './dva/router';\nimport { ConnectedRouter } from 'connected-react-router';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import createLoading from './dva-loading';\n")]),t._v("const app = dva();\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+app.use(createLoading());\n")]),t._v("app.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n    effects: {\n        *asyncAdd(action, { call, put }) {\n            yield call(delay, 1000);\n            yield put({ type: 'counter/add' });\n        },\n        *goto({ to }, { put }) {\n            yield put(routerRedux.push(to));\n        }\n    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return (\n        <div>\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            <p> {props.loading.models.counter ? 'loading' : props.counter.number}</p>\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步+</button>\n            <button onClick={() => props.dispatch({ type: "counter/goto", to: \'/\' })}>跳转到/</button>\n        </div>\n    )\n')]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    (state) => state\n")]),t._v(")(Counter);\nconst Home = () => <div>Home</div>\napp.router((api: any) => (\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    <Router history={api.history}>\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('        <>\n            <Route path="/" exact={true} component={Home} />\n            <Route path="/counter" component={ConnectedCounter} />\n        </>\n')]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    </Router>\n")]),t._v("));\napp.start('#root');\n\nfunction delay(ms) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return new Promise((resolve) => {\n        setTimeout(function () {\n            resolve();\n        }, ms);\n    });\n")]),t._v("}\n")])])]),s("h3",{attrs:{id:"_7-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-实现"}},[t._v("#")]),t._v(" 7.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_7-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 7.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { createStore, combineReducers, applyMiddleware } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\nimport * as sagaEffects from 'redux-saga/effects';\nimport { NAMESPACE_SEP } from './constants';\nimport { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\nimport { createHashHistory } from 'history';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import Plugin, { filterHooks } from './plugin';\n")]),t._v('import { routerMiddleware, connectRouter, ConnectedRouter } from "connected-react-router";\nlet history = createHashHistory();\nexport { connect };\n\n'),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+export default function (opts = {}) {\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n    const initialReducers = { router: connectRouter(history) };\n    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n    function router(router: Router) {\n        app._router = router;\n    }\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    const plugin = new Plugin();\n+    plugin.use(filterHooks(opts));\n+    app.use = plugin.use.bind(plugin);\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function start(root) {\n        for (const model of app._models) {\n            initialReducers[model.namespace] = getReducer(model);\n        }\n        let rootReducer = createReducer();\n        const sagas = getSagas(app);\n        const sagaMiddleware = createSagaMiddleware();\n        let store = createStore(rootReducer, applyMiddleware(routerMiddleware(history), sagaMiddleware));\n        sagas.forEach(saga => sagaMiddleware.run(saga));\n        ReactDOM.render(<Provider store={store}>{app._router({ history })}</Provider>, document.querySelector(root));\n        function createReducer() {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        const extraReducers = plugin.get('extraReducers');\n+        return combineReducers({\n+            ...initialReducers,\n+            ...extraReducers\n+        });\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("       }\n    }\n    function getSagas(app) {\n        let sagas: Array<any> = [];\n        for (const model of app._models) {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            sagas.push(getSaga(model.effects, model, plugin.get('onEffect')));\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        }\n        return sagas;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+function getSaga(effects, model, onEffect) {\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        for (const key in effects) {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            const watcher = getWatcher(key, model.effects[key], model, onEffect);\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("            yield sagaEffects.fork(watcher);\n        }\n    };\n")]),t._v("}\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+function getWatcher(key, effect, model, onEffect) {\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            if (onEffect) {\n+                for (const fn of onEffect) {\n+                    effect = fn(effect, sagaEffects, model, key);\n+                }\n+            }\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("            yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n        });\n    };\n")]),t._v("}\nfunction prefixType(type, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (type.indexOf('/') === -1) {\n        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n    }\n    return type;\n")]),t._v("}\nfunction getReducer(model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers, state: defaultState } = model;\n    let reducer = (state = defaultState, action) => {\n        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n    return reducer;\n")]),t._v("}\nexport * from './typings';\n")])])]),s("h4",{attrs:{id:"_7-2-2-dva-loading-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-2-dva-loading-tsx"}},[t._v("#")]),t._v(" 7.2.2 dva-loading.tsx")]),t._v(" "),s("p",[t._v("src\\dva-loading.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SHOW")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@@DVA_LOADING/SHOW'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HIDE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@@DVA_LOADING/HIDE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NAMESPACE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'loading'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createLoading")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("opts"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" initialState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        global"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        models"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        effects"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" extraReducers "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NAMESPACE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" initialState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" actionType "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" payload "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SHOW")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                    ret "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        global"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        models"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        effects"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("actionType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HIDE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" effects "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("actionType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" models "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("effects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("some")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("actionType")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" _namespace "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" actionType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_namespace "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" effects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("actionType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" global "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("some")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("namespace")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    ret "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        global"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        effects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                    ret "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onEffect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" put "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" actionType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" namespace "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SHOW")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" actionType "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("effect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HIDE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" actionType "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        extraReducers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        onEffect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" createLoading"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"_7-2-3-plugin-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-3-plugin-tsx"}},[t._v("#")]),t._v(" 7.2.3 plugin.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\plugin.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" hooks "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'onEffect'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'extraReducers'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filterHooks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("memo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hooks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            memo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" memo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Plugin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    hooks"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hooks "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hooks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("memo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            memo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" memo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" hooks "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" plugin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            hooks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("plugin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" hooks "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'extraReducers'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getExtraReducers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hooks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" hooks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getExtraReducers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("hook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ret "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" reducerObj "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" hook"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ret "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("ret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("reducerObj "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_8-dynamic"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-dynamic"}},[t._v("#")]),t._v(" 8. dynamic")]),t._v(" "),s("ul",[s("li",[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("dva/dynamic\n")])])]),s("p",[t._v("是解决组件动态加载问题的方法。")]),t._v(" "),s("h3",{attrs:{id:"_8-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-使用"}},[t._v("#")]),t._v(" 8.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_8-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-1-index-tsx"}},[t._v("#")]),t._v(" 8.1.1 index.tsx")])])]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import { Router, Route, routerRedux, Link } from './dva/router';\n")]),t._v("import { ConnectedRouter } from 'connected-react-router';\nimport createLoading from './dva-loading';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import dynamic from './dva/dynamic';\n")]),t._v("const app = dva();\napp.use(createLoading());\napp.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n    effects: {\n        *asyncAdd(action, { call, put }) {\n            yield call(delay, 1000);\n            yield put({ type: 'counter/add' });\n        },\n        *goto({ to }, { put }) {\n            yield put(routerRedux.push(to));\n        }\n    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    return (\n        <div>\n            <p> {props.loading.models.counter ? \'loading\' : props.counter.number}</p>\n            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步+</button>\n            <button onClick={() => props.dispatch({ type: "counter/goto", to: \'/\' })}>跳转到/</button>\n        </div>\n    )\n')]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    (state) => state\n")]),t._v(")(Counter);\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+const Home = () => <div>Home</div>;\n+const UserPageComponent = (dynamic as any)({\n+    app,\n+    models: () => [\n+        import('./models/users'),\n+    ],\n+    component: () => import('./routes/UserPage'),\n+});\n")]),t._v("app.router((api: any) => (\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    <Router history={api.history}>\n        <>\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+            <ul>\n+                <li><Link to="/">Home</Link></li>\n+                <li><Link to="/counter">counter</Link></li>\n+                <li><Link to="/users">users</Link></li>\n+            </ul>\n')]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('            <Route path="/" exact={true} component={Home} />\n            <Route path="/counter" component={ConnectedCounter} />\n')]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+           <Route path="/users" component={UserPageComponent} />\n')]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        </>\n    </Router>\n")]),t._v("));\napp.start('#root');\n\nfunction delay(ms) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return new Promise((resolve) => {\n        setTimeout(function () {\n            resolve();\n        }, ms);\n    });\n")]),t._v("}\n")])])]),s("h3",{attrs:{id:"_8-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-实现"}},[t._v("#")]),t._v(" 8.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_8-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 8.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { createStore, combineReducers, applyMiddleware } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\nimport * as sagaEffects from 'redux-saga/effects';\nimport { NAMESPACE_SEP } from './constants';\nimport { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\nimport { createHashHistory } from 'history';\nimport Plugin, { filterHooks } from './plugin';\nimport { routerMiddleware, connectRouter, ConnectedRouter } from \"connected-react-router\";\nlet history = createHashHistory();\nexport { connect };\n\nexport default function (opts = {}) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n    const initialReducers = { router: connectRouter(history) };\n    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function router(router: Router) {\n        app._router = router;\n    }\n    const plugin = new Plugin();\n    plugin.use(filterHooks(opts));\n    app.use = plugin.use.bind(plugin);\n    function start(root) {\n        for (const model of app._models) {\n            initialReducers[model.namespace] = getReducer(model);\n        }\n        let rootReducer = createReducer();\n        const sagas = getSagas(app);\n        const sagaMiddleware = createSagaMiddleware();\n        let store = createStore(rootReducer, applyMiddleware(routerMiddleware(history), sagaMiddleware));\n        sagas.forEach(saga => sagaMiddleware.run(saga));\n        ReactDOM.render(<Provider store={store}>{app._router({ history })}</Provider>, document.querySelector(root))\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        app.model = injectModel.bind(app);\n+        app._getSaga = getSaga;\n+        function injectModel(m) {\n+            m = model(m);\n+            initialReducers[m.namespace] = getReducer(m);\n+            store.replaceReducer(createReducer());\n+            if (m.effects) {\n+                sagaMiddleware.run(app._getSaga(m.effects, m));\n+            }\n+            if (m.subscriptions) {\n+                runSubscription(m.subscriptions, m, app);\n+            }\n+        }\n+        function runSubscription(subscriptions, model, app) {\n+            for (const key in subscriptions) {\n+                subscriptions[key](\n+                    {\n+                        dispatch: prefixedDispatch(store.dispatch, model),\n+                        history: app._history,\n+                    }\n+                );\n+            }\n+        }\n+        function prefixedDispatch(dispatch, model) {\n+            return action => {\n+                const { type } = action;\n+                return dispatch({ ...action, type: prefixType(type, model) });\n+            };\n+        }\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        function createReducer() {\n            const extraReducers = plugin.get('extraReducers');\n            return combineReducers({\n                ...initialReducers,\n                ...extraReducers\n            });\n        }\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function getSagas(app) {\n        let sagas: Array<any> = [];\n        for (const model of app._models) {\n            sagas.push(getSaga(model.effects, model, plugin.get('onEffect')));\n        }\n        return sagas;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\nfunction getSaga(effects, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        for (const key in effects) {\n            const watcher = getWatcher(key, model.effects[key], model, onEffect);\n            yield sagaEffects.fork(watcher);\n        }\n    };\n")]),t._v("}\nfunction getWatcher(key, effect, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n            if (onEffect) {\n                for (const fn of onEffect) {\n                    effect = fn(effect, sagaEffects, model, key);\n                }\n            }\n            yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n        });\n    };\n")]),t._v("}\nfunction prefixType(type, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (type.indexOf('/') === -1) {\n        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n    }\n    return type;\n")]),t._v("}\nfunction getReducer(model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers = {}, state: defaultState } = model;\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    return (state = defaultState, action) => {\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n")]),t._v("}\nexport * from './typings';\n")])])]),s("h4",{attrs:{id:"_8-2-2-dynamic-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-2-dynamic-tsx"}},[t._v("#")]),t._v(" 8.2.2 dynamic.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\dynamic.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Component"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" JSXElementConstructor "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("defaultLoadingComponent")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("loading"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dynamic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" component "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DynamicComponent")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        LoadingComponent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LoadingComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LoadingComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" defaultLoadingComponent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" AsyncComponent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" JSXElementConstructor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AsyncComponent "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentDidMount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            Promise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Promise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("models")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("component")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" component"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" resolveModels "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("model")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                resolveModels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("model")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("model")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" AsyncComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" component"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" component"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AsyncComponent "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AsyncComponent "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" LoadingComponent "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("AsyncComponent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("AsyncComponent "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("LoadingComponent "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"_8-2-3-src-models-users-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-3-src-models-users-tsx"}},[t._v("#")]),t._v(" 8.2.3 src\\models\\users.tsx")]),t._v(" "),s("p",[t._v("src\\models\\users.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ms")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'users'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" list"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'珠峰'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'架构'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    reducers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" list"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("payload "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    effects"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("asyncAdd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" call"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" put "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'add'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'学院'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"_8-2-4-routes-userpage-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-4-routes-userpage-tsx"}},[t._v("#")]),t._v(" 8.2.4 routes\\UserPage.tsx")]),t._v(" "),s("p",[t._v("src\\routes\\UserPage.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" connect "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"../dva"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("UserPage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("button onClick"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'users/asyncAdd'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("button"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ul"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("user")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("li key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("li"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ul"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserPage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"_9-onaction中间件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-onaction中间件"}},[t._v("#")]),t._v(" 9. onAction中间件")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("cnpm i redux"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("logger "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("S")]),t._v("\n")])])]),s("h3",{attrs:{id:"_9-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-使用"}},[t._v("#")]),t._v(" 9.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_9-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-1-index-tsx"}},[t._v("#")]),t._v(" 9.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\nimport { Router, Route, routerRedux, Link } from './dva/router';\nimport createLoading from './dva-loading';\nimport dynamic from './dva/dynamic';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import { createLogger } from './redux-logger';\n")]),t._v("\nconst app = dva();\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+app.use({ onAction: createLogger() });\n")]),t._v("app.use(createLoading());\napp.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n    effects: {\n        *asyncAdd(action, { call, put }) {\n            yield call(delay, 1000);\n            yield put({ type: 'counter/add' });\n        },\n        *goto({ to }, { put }) {\n            yield put(routerRedux.push(to));\n        }\n    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    return (\n        <div>\n            <p> {props.loading.models.counter ? \'loading\' : props.counter.number}</p>\n            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步+</button>\n            <button onClick={() => props.dispatch({ type: "counter/goto", to: \'/\' })}>跳转到/</button>\n        </div>\n    )\n')]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    (state) => state\n")]),t._v(")(Counter);\nconst Home = () => <div>Home</div>;\nconst UserPageComponent = (dynamic as any)({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    app,\n    models: () => [\n        import('./models/users'),\n    ],\n    component: () => import('./routes/UserPage'),\n")]),t._v("});\napp.router((api: any) => (\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    <Router history={api.history}>\n        <>\n            <ul>\n                <li><Link to="/">Home</Link></li>\n                <li><Link to="/counter">counter</Link></li>\n                <li><Link to="/users">users</Link></li>\n            </ul>\n            <Route path="/" exact={true} component={Home} />\n            <Route path="/counter" component={ConnectedCounter} />\n            <Route path="/users" component={UserPageComponent} />\n        </>\n    </Router>\n')]),t._v("));\napp.start('#root');\n\nfunction delay(ms) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return new Promise((resolve) => {\n        setTimeout(function () {\n            resolve();\n        }, ms);\n    });\n")]),t._v("}\n")])])]),s("h3",{attrs:{id:"_9-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-实现"}},[t._v("#")]),t._v(" 9.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_9-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 9.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { createStore, combineReducers, applyMiddleware } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\nimport * as sagaEffects from 'redux-saga/effects';\nimport { NAMESPACE_SEP } from './constants';\nimport { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\nimport { createHashHistory } from 'history';\nimport Plugin, { filterHooks } from './plugin';\nimport { routerMiddleware, connectRouter } from \"connected-react-router\";\nlet history = createHashHistory();\nexport { connect };\n\nexport default function (opts = {}) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n    const initialReducers = { router: connectRouter(history) };\n    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function router(router: Router) {\n        app._router = router;\n    }\n    const plugin = new Plugin();\n    plugin.use(filterHooks(opts));\n    app.use = plugin.use.bind(plugin);\n    function start(root) {\n        for (const model of app._models) {\n            initialReducers[model.namespace] = getReducer(model);\n        }\n        let rootReducer = createReducer();\n        const sagas = getSagas(app);\n        const sagaMiddleware = createSagaMiddleware();\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        const extraMiddlewares = plugin.get('onAction');\n+        let store = createStore(rootReducer, applyMiddleware(...extraMiddlewares, routerMiddleware(history), sagaMiddleware));\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        sagas.forEach(saga => sagaMiddleware.run(saga));\n        ReactDOM.render(<Provider store={store}>{app._router({ history })}</Provider>, document.querySelector(root))\n        app.model = injectModel.bind(app);\n        app._getSaga = getSaga;\n        function injectModel(m) {\n            m = model(m);\n            initialReducers[m.namespace] = getReducer(m);\n            store.replaceReducer(createReducer());\n            if (m.effects) {\n                sagaMiddleware.run(app._getSaga(m.effects, m));\n            }\n            if (m.subscriptions) {\n                runSubscription(m.subscriptions, m, app);\n            }\n        }\n        function runSubscription(subscriptions, model, app) {\n            for (const key in subscriptions) {\n                subscriptions[key](\n                    {\n                        dispatch: prefixedDispatch(store.dispatch, model),\n                        history: app._history,\n                    }\n                );\n            }\n        }\n        function prefixedDispatch(dispatch, model) {\n            return action => {\n                const { type } = action;\n                return dispatch({ ...action, type: prefixType(type, model) });\n            };\n        }\n        function createReducer() {\n            const extraReducers = plugin.get('extraReducers');\n            return combineReducers({\n                ...initialReducers,\n                ...extraReducers\n            });\n        }\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function getSagas(app) {\n        let sagas: Array<any> = [];\n        for (const model of app._models) {\n            sagas.push(getSaga(model.effects, model, plugin.get('onEffect')));\n        }\n        return sagas;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\nfunction getSaga(effects, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        for (const key in effects) {\n            const watcher = getWatcher(key, model.effects[key], model, onEffect);\n            yield sagaEffects.fork(watcher);\n        }\n    };\n")]),t._v("}\nfunction getWatcher(key, effect, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n            if (onEffect) {\n                for (const fn of onEffect) {\n                    effect = fn(effect, sagaEffects, model, key);\n                }\n            }\n            yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n        });\n    };\n")]),t._v("}\nfunction prefixType(type, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (type.indexOf('/') === -1) {\n        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n    }\n    return type;\n")]),t._v("}\nfunction getReducer(model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers = {}, state: defaultState } = model;\n    return (state = defaultState, action) => {\n        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n")]),t._v("}\nexport * from './typings';\n")])])]),s("h4",{attrs:{id:"_9-2-2-src-dva-plugin-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-2-src-dva-plugin-tsx"}},[t._v("#")]),t._v(" 9.2.2 src\\dva\\plugin.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\plugin.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("const hooks = [\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    'onEffect',\n    'extraReducers',\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    'onAction'\n")]),t._v("];\nexport function filterHooks(obj) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return Object.keys(obj).reduce((memo, key) => {\n        if (hooks.indexOf(key) > -1) {\n            memo[key] = obj[key];\n        }\n        return memo;\n    }, {});\n")]),t._v("}\nexport default class Plugin {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    hooks: any\n    constructor() {\n        this.hooks = hooks.reduce((memo, key) => {\n            memo[key] = [];\n            return memo;\n        }, {});\n    }\n    use(plugin) {\n        const { hooks } = this;\n        for (const key in plugin) {\n            hooks[key].push(plugin[key]);\n        }\n    }\n    get(key) {\n        const { hooks } = this;\n        if (key === 'extraReducers') {\n            return getExtraReducers(hooks[key]);\n        } else {\n            return hooks[key];\n        }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    }\n")]),t._v("}\nfunction getExtraReducers(hook) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let ret = {};\n    for (const reducerObj of hook) {\n        ret = { ...ret, ...reducerObj };\n    }\n    return ret;\n")]),t._v("}\n")])])]),s("h4",{attrs:{id:"_9-2-3-src-redux-logger-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-3-src-redux-logger-tsx"}},[t._v("#")]),t._v(" 9.2.3 src\\redux-logger.tsx")]),t._v(" "),s("p",[t._v("src\\redux-logger.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//https://github.com/LogRocket/redux-logger/blob/5816a9fc8da9b417589380e381ed66f1114ebd9a/src/defaults.js#L12-L17")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" colors "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    title"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'inherit'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    prevState"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#9E9E9E'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    action"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#03A9F4'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    nextState"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#4CAF50'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("logger")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" dispatch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" getState "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("next")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" prevState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" startedTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" returnedValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" took "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" startedTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" headerCSS"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    headerCSS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'color: gray; font-weight: lighter;'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    headerCSS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("color: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("colors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    headerCSS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'color: gray; font-weight: lighter;'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    headerCSS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'color: gray; font-weight: lighter;'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" title "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("titleFormatter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" startedTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" took"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//action %c counter/add %c @ 下午11:17:59 %c (in 2.00 ms)  console.log(`%cred%cgreen`, 'color:red', 'color:green');")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupCollapsed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("%c ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("title"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("headerCSS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%c prev state'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("color: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("colors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prevState"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("; font-weight: bold")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%c action    '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("color: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("colors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("; font-weight: bold")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%c next state'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("color: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("colors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextState"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("; font-weight: bold")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupEnd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" returnedValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("titleFormatter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" took")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" parts "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'action'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    parts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("%c")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    parts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("%c@ ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLocaleTimeString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    parts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("%c(in ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("took"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toFixed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" ms)")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" parts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("' '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createLogger")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" logger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    createLogger\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_10-statechange"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-statechange"}},[t._v("#")]),t._v(" 10. stateChange")]),t._v(" "),s("h3",{attrs:{id:"_10-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-使用"}},[t._v("#")]),t._v(" 10.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_10-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-1-index-tsx"}},[t._v("#")]),t._v(" 10.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\nimport { Router, Route, routerRedux, Link } from './dva/router';\nimport createLoading from './dva-loading';\nimport dynamic from './dva/dynamic';\nimport { createLogger } from './redux-logger';\n\nconst app = dva({\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    initialState: localStorage.getItem('state') ? JSON.parse(localStorage.getItem('state')!) : {},\n+    onStateChange: function () {\n+        localStorage.setItem('state', JSON.stringify(arguments[0]));\n+    }\n")]),t._v("});\napp.use({ onAction: createLogger() });\napp.use(createLoading());\napp.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n    effects: {\n        *asyncAdd(action, { call, put }) {\n            yield call(delay, 1000);\n            yield put({ type: 'counter/add' });\n        },\n        *goto({ to }, { put }) {\n            yield put(routerRedux.push(to));\n        }\n    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    return (\n        <div>\n            <p> {props.loading.models.counter ? \'loading\' : props.counter.number}</p>\n            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步+</button>\n            <button onClick={() => props.dispatch({ type: "counter/goto", to: \'/\' })}>跳转到/</button>\n        </div>\n    )\n')]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    (state) => state\n")]),t._v(")(Counter);\nconst Home = () => <div>Home</div>;\nconst UserPageComponent = (dynamic as any)({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    app,\n    models: () => [\n        import('./models/users'),\n    ],\n    component: () => import('./routes/UserPage'),\n")]),t._v("});\napp.router((api: any) => (\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    <Router history={api.history}>\n        <>\n            <ul>\n                <li><Link to="/">Home</Link></li>\n                <li><Link to="/counter">counter</Link></li>\n                <li><Link to="/users">users</Link></li>\n            </ul>\n            <Route path="/" exact={true} component={Home} />\n            <Route path="/counter" component={ConnectedCounter} />\n            <Route path="/users" component={UserPageComponent} />\n        </>\n    </Router>\n')]),t._v("));\napp.start('#root');\n\nfunction delay(ms) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return new Promise((resolve) => {\n        setTimeout(function () {\n            resolve();\n        }, ms);\n    });\n")]),t._v("}\n")])])]),s("h3",{attrs:{id:"_10-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-实现"}},[t._v("#")]),t._v(" 10.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_10-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 10.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { createStore, combineReducers, applyMiddleware } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\nimport * as sagaEffects from 'redux-saga/effects';\nimport { NAMESPACE_SEP } from './constants';\nimport { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\nimport { createHashHistory } from 'history';\nimport Plugin, { filterHooks } from './plugin';\nimport { routerMiddleware, connectRouter } from \"connected-react-router\";\nlet history = createHashHistory();\nexport { connect };\n\nexport default function (opts: any = {}) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n    const initialReducers = { router: connectRouter(history) };\n    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function router(router: Router) {\n        app._router = router;\n    }\n    const plugin = new Plugin();\n    plugin.use(filterHooks(opts));\n    app.use = plugin.use.bind(plugin);\n    function start(root) {\n        for (const model of app._models) {\n            initialReducers[model.namespace] = getReducer(model);\n        }\n        let rootReducer = createReducer();\n        const sagas = getSagas(app);\n        const sagaMiddleware = createSagaMiddleware();\n        const extraMiddlewares = plugin.get('onAction');\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        let store = createStore(rootReducer, opts.initialState, applyMiddleware(...extraMiddlewares, routerMiddleware(history), sagaMiddleware));\n+        const listeners = plugin.get('onStateChange');\n+        for (const listener of listeners) {\n+            store.subscribe(() => {\n+                listener(store.getState());\n+            });\n+        }\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        sagas.forEach(saga => sagaMiddleware.run(saga));\n        ReactDOM.render(<Provider store={store}>{app._router({ history })}</Provider>, document.querySelector(root))\n        app.model = injectModel.bind(app);\n        app._getSaga = getSaga;\n        function injectModel(m) {\n            m = model(m);\n            initialReducers[m.namespace] = getReducer(m);\n            store.replaceReducer(createReducer());\n            if (m.effects) {\n                sagaMiddleware.run(app._getSaga(m.effects, m));\n            }\n            if (m.subscriptions) {\n                runSubscription(m.subscriptions, m, app);\n            }\n        }\n        function runSubscription(subscriptions, model, app) {\n            for (const key in subscriptions) {\n                subscriptions[key](\n                    {\n                        dispatch: prefixedDispatch(store.dispatch, model),\n                        history: app._history,\n                    }\n                );\n            }\n        }\n        function prefixedDispatch(dispatch, model) {\n            return action => {\n                const { type } = action;\n                return dispatch({ ...action, type: prefixType(type, model) });\n            };\n        }\n        function createReducer() {\n          const extraReducers = plugin.get('extraReducers');\n          return combineReducers({\n            ...initialReducers,\n            ...extraReducers\n          });\n       }\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function getSagas(app) {\n        let sagas: Array<any> = [];\n        for (const model of app._models) {\n            sagas.push(getSaga(model.effects, model, plugin.get('onEffect')));\n        }\n        return sagas;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\nfunction getSaga(effects, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        for (const key in effects) {\n            const watcher = getWatcher(key, model.effects[key], model, onEffect);\n            yield sagaEffects.fork(watcher);\n        }\n    };\n")]),t._v("}\nfunction getWatcher(key, effect, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n            if (onEffect) {\n                for (const fn of onEffect) {\n                    effect = fn(effect, sagaEffects, model, key);\n                }\n            }\n            yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n        });\n    };\n")]),t._v("}\nfunction prefixType(type, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (type.indexOf('/') === -1) {\n        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n    }\n    return type;\n")]),t._v("}\nfunction getReducer(model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers = {}, state: defaultState } = model;\n    return (state = defaultState, action) => {\n        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n")]),t._v("}\nexport * from './typings';\n")])])]),s("h4",{attrs:{id:"_10-2-2-src-dva-plugin-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-2-src-dva-plugin-tsx"}},[t._v("#")]),t._v(" 10.2.2 src\\dva\\plugin.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\plugin.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("const hooks = [\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    'onEffect',\n    'extraReducers',\n    'onAction',\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    'onStateChange'\n")]),t._v("];\nexport function filterHooks(obj) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return Object.keys(obj).reduce((memo, key) => {\n        if (hooks.indexOf(key) > -1) {\n            memo[key] = obj[key];\n        }\n        return memo;\n    }, {});\n")]),t._v("}\nexport default class Plugin {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    hooks: any\n    constructor() {\n        this.hooks = hooks.reduce((memo, key) => {\n            memo[key] = [];\n            return memo;\n        }, {});\n    }\n    use(plugin) {\n        const { hooks } = this;\n        for (const key in plugin) {\n            hooks[key].push(plugin[key]);\n        }\n    }\n    get(key) {\n        const { hooks } = this;\n        if (key === 'extraReducers') {\n            return getExtraReducers(hooks[key]);\n        } else {\n            return hooks[key];\n        }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    }\n")]),t._v("}\nfunction getExtraReducers(hook) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let ret = {};\n    for (const reducerObj of hook) {\n        ret = { ...ret, ...reducerObj };\n    }\n    return ret;\n")]),t._v("}\n")])])]),s("h2",{attrs:{id:"_11-onreducer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-onreducer"}},[t._v("#")]),t._v(" 11. onReducer")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/omnidan/redux-undo",target:"_blank",rel:"noopener noreferrer"}},[t._v("redux-undo"),s("OutboundLink")],1),t._v("利用高阶reducer来增强reducer的例子,它主要作用是使任意reducer变成可以执行撤销和重做的全新reducer")])]),t._v(" "),s("h3",{attrs:{id:"_11-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-使用"}},[t._v("#")]),t._v(" 11.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_11-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-1-index-tsx"}},[t._v("#")]),t._v(" 11.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\nimport { Router, Route, routerRedux, Link } from './dva/router';\nimport createLoading from './dva-loading';\nimport dynamic from './dva/dynamic';\nimport { createLogger } from './redux-logger';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import undoable, { ActionCreators } from './redux-undo';\n")]),t._v("\nconst app = dva({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    initialState: localStorage.getItem('state') ? JSON.parse(localStorage.getItem('state')!) : undefined,\n    onStateChange: function () {\n        localStorage.setItem('state', JSON.stringify(arguments[0]));\n    },\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    onReducer: reducer => {\n+        let undoReducer = undoable(reducer);\n+        return (state, action) => {\n+            let newState: any = undoReducer(state, action);\n+            return { ...newState, router: newState.present.router };\n+        }\n+    }\n")]),t._v("});\napp.use({ onAction: createLogger() });\napp.use(createLoading());\napp.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n    effects: {\n        *asyncAdd(action, { call, put }) {\n            yield call(delay, 1000);\n            yield put({ type: 'counter/add' });\n        },\n        *goto({ to }, { put }) {\n            yield put(routerRedux.push(to));\n        }\n    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    return (\n        <div>\n            <p> {props.loading.models.counter ? \'loading\' : props.counter.number}</p>\n            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步+</button>\n            <button onClick={() => props.dispatch({ type: "counter/goto", to: \'/\' })}>跳转到/</button>\n')]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            <button onClick={() => props.dispatch(ActionCreators.undo())}>undo</button>\n+            <button onClick={() => props.dispatch(ActionCreators.redo())}>redo</button>\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        </div>\n    )\n")]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    (state) => state.present\n")]),t._v(")(Counter);\nconst Home = () => <div>Home</div>;\nconst UserPageComponent = (dynamic as any)({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    app,\n    models: () => [\n        import('./models/users'),\n    ],\n    component: () => import('./routes/UserPage'),\n")]),t._v("});\napp.router((api: any) => (\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    <Router history={api.history}>\n        <>\n            <ul>\n                <li><Link to="/">Home</Link></li>\n                <li><Link to="/counter">counter</Link></li>\n                <li><Link to="/users">users</Link></li>\n            </ul>\n            <Route path="/" exact={true} component={Home} />\n            <Route path="/counter" component={ConnectedCounter} />\n            <Route path="/users" component={UserPageComponent} />\n        </>\n    </Router>\n')]),t._v("));\napp.start('#root');\n\nfunction delay(ms) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return new Promise((resolve) => {\n        setTimeout(function () {\n            resolve();\n        }, ms);\n    });\n")]),t._v("}\n")])])]),s("h3",{attrs:{id:"_11-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-实现"}},[t._v("#")]),t._v(" 11.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_11-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 11.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { createStore, combineReducers, applyMiddleware } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\nimport * as sagaEffects from 'redux-saga/effects';\nimport { NAMESPACE_SEP } from './constants';\nimport { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\nimport { createHashHistory } from 'history';\nimport Plugin, { filterHooks } from './plugin';\nimport { routerMiddleware, connectRouter } from \"connected-react-router\";\nlet history = createHashHistory();\nexport { connect };\n\nexport default function (opts: any = {}) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n    const initialReducers = { router: connectRouter(history) };\n    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function router(router: Router) {\n        app._router = router;\n    }\n    const plugin = new Plugin();\n    plugin.use(filterHooks(opts));\n    app.use = plugin.use.bind(plugin);\n    function start(root) {\n        for (const model of app._models) {\n            initialReducers[model.namespace] = getReducer(model);\n        }\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        const reducerEnhancer = plugin.get('onReducer');\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        let rootReducer = createReducer();\n        const sagas = getSagas(app);\n        const sagaMiddleware = createSagaMiddleware();\n        const extraMiddlewares = plugin.get('onAction');\n        let store = createStore(rootReducer, opts.initialState, applyMiddleware(...extraMiddlewares, routerMiddleware(history), sagaMiddleware));\n        const listeners = plugin.get('onStateChange');\n        for (const listener of listeners) {\n            store.subscribe(() => {\n                listener(store.getState());\n            });\n        }\n        sagas.forEach(saga => sagaMiddleware.run(saga));\n        ReactDOM.render(<Provider store={store}>{app._router({ history })}</Provider>, document.querySelector(root))\n        app.model = injectModel.bind(app);\n        app._getSaga = getSaga;\n        function injectModel(m) {\n            m = model(m);\n            initialReducers[m.namespace] = getReducer(m);\n            store.replaceReducer(createReducer());\n            if (m.effects) {\n                sagaMiddleware.run(app._getSaga(m.effects, m));\n            }\n            if (m.subscriptions) {\n                runSubscription(m.subscriptions, m, app);\n            }\n        }\n        function runSubscription(subscriptions, model, app) {\n            for (const key in subscriptions) {\n                subscriptions[key](\n                    {\n                        dispatch: prefixedDispatch(store.dispatch, model),\n                        history: app._history,\n                    }\n                );\n            }\n        }\n        function prefixedDispatch(dispatch, model) {\n            return action => {\n                const { type } = action;\n                return dispatch({ ...action, type: prefixType(type, model) });\n            };\n        }\n        function createReducer() {\n            const extraReducers = plugin.get('extraReducers');\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            return reducerEnhancer(combineReducers({\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                ...initialReducers,\n                ...extraReducers\n            }));\n        }\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function getSagas(app) {\n        let sagas: Array<any> = [];\n        for (const model of app._models) {\n            sagas.push(getSaga(model.effects, model, plugin.get('onEffect')));\n        }\n        return sagas;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\nfunction getSaga(effects, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        for (const key in effects) {\n            const watcher = getWatcher(key, model.effects[key], model, onEffect);\n            yield sagaEffects.fork(watcher);\n        }\n    };\n")]),t._v("}\nfunction getWatcher(key, effect, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n            if (onEffect) {\n                for (const fn of onEffect) {\n                    effect = fn(effect, sagaEffects, model, key);\n                }\n            }\n            yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n        });\n    };\n")]),t._v("}\nfunction prefixType(type, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (type.indexOf('/') === -1) {\n        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n    }\n    return type;\n")]),t._v("}\nfunction getReducer(model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers = {}, state: defaultState } = model;\n    return (state = defaultState, action) => {\n        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n")]),t._v("}\nexport * from './typings';\n")])])]),s("h4",{attrs:{id:"_11-2-2-src-dva-plugin-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-2-src-dva-plugin-tsx"}},[t._v("#")]),t._v(" 11.2.2 src\\dva\\plugin.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\plugin.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("const hooks = [\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    'onEffect',\n    'extraReducers',\n    'onAction',\n    'onStateChange',\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    'onReducer'\n")]),t._v("];\nexport function filterHooks(obj) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return Object.keys(obj).reduce((memo, key) => {\n        if (hooks.indexOf(key) > -1) {\n            memo[key] = obj[key];\n        }\n        return memo;\n    }, {});\n")]),t._v("}\nexport default class Plugin {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    hooks: any\n    constructor() {\n        this.hooks = hooks.reduce((memo, key) => {\n            memo[key] = [];\n            return memo;\n        }, {});\n    }\n    use(plugin) {\n        const { hooks } = this;\n        for (const key in plugin) {\n            hooks[key].push(plugin[key]);\n        }\n    }\n    get(key) {\n        const { hooks } = this;\n        if (key === 'extraReducers') {\n            return getExtraReducers(hooks[key]);\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        } else if (key === 'onReducer') {\n+            return getOnReducer(hooks[key]);\n+        } else {\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("            return hooks[key];\n        }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    }\n")]),t._v("}\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+function getOnReducer(hook) {\n+    return function (reducer) {\n+        for (const reducerEnhancer of hook) {\n+            reducer = reducerEnhancer(reducer);\n+        }\n+        return reducer;\n+    };\n+}\n")]),t._v("function getExtraReducers(hook) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let ret = {};\n    for (const reducerObj of hook) {\n        ret = { ...ret, ...reducerObj };\n    }\n    return ret;\n")]),t._v("}\n")])])]),s("h4",{attrs:{id:"_11-2-3-src-routes-userpage-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-3-src-routes-userpage-tsx"}},[t._v("#")]),t._v(" 11.2.3 src\\routes\\UserPage.tsx")]),t._v(" "),s("p",[t._v("src\\routes\\UserPage.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport { connect } from \"../dva\";\n\nfunction UserPage(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let list = props.list || [];\n    return (\n        <>\n            <button onClick={() => props.dispatch({ type: 'users/asyncAdd' })}>+</button>\n            <ul>\n                {\n                    list.map(user => (\n                        <li key={user.id}>{user.name}</li>\n                    ))\n                }\n            </ul>\n        </>\n    )\n")]),t._v("}\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+export default connect(state => state.present.users)(UserPage);\n")])])])]),s("h4",{attrs:{id:"_11-2-4-src-redux-undo-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-4-src-redux-undo-tsx"}},[t._v("#")]),t._v(" 11.2.4 src\\redux-undo.tsx")]),t._v(" "),s("p",[t._v("src\\redux-undo.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UNDO_TYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@@redux-unto/UNDO"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REDO_TYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@@redux-unto/REDO"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ActionCreators "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("undo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UNDO_TYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("redo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REDO_TYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("undoable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("reducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" undoType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UNDO_TYPE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" redoType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REDO_TYPE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" initialState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        past"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        future"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        present"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" initialState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" past"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" present"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" future "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" undoType"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" previous "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" past"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("past"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newPast "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" past"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("slice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" past"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    past"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" newPast"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    present"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" previous"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    future"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("present"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("future"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" redoType"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" next "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" future"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newFuture "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" future"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("slice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    past"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("past"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" present"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    present"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    future"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" newFuture\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newPresent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("present"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    past"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("past"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" present"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    present"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" newPresent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    future"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_12-extraenhancers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-extraenhancers"}},[t._v("#")]),t._v(" 12. extraEnhancers")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/rt2zz/redux-persist",target:"_blank",rel:"noopener noreferrer"}},[t._v("redux-persist"),s("OutboundLink")],1),t._v("会将redux的store中的数据缓存到浏览器的localStorage中")])]),t._v(" "),s("h3",{attrs:{id:"_12-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-1-使用"}},[t._v("#")]),t._v(" 12.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_12-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-1-1-index-tsx"}},[t._v("#")]),t._v(" 12.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\nimport { Router, Route, routerRedux, Link } from './dva/router';\nimport createLoading from './dva-loading';\nimport dynamic from './dva/dynamic';\nimport { createLogger } from './redux-logger';\nimport undoable, { ActionCreators } from './redux-undo';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import { persistStore, persistReducer } from './redux-persist';\n+import storage from './redux-persist/lib/storage';\n+import { PersistGate } from './redux-persist/lib/integration/react';\n+const persistConfig = {\n+    key: 'root',\n+    storage\n+}\n")]),t._v("const app = dva({\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    //initialState: localStorage.getItem('state') ? JSON.parse(localStorage.getItem('state')!) : undefined,\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    onStateChange: function () {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        //localStorage.setItem('state', JSON.stringify(arguments[0]));\n+        console.log('currentState', arguments[0]);\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    },\n    onReducer: reducer => {\n        let undoReducer = undoable(reducer);\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        let rootReducer = persistReducer(persistConfig, undoReducer);\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        return (state, action) => {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            let newState: any = rootReducer(state, action);\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("            return { ...newState, router: newState.present.router };\n        }\n    },\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    extraEnhancers: [\n+        createStore => (...args) => {\n+            const store: any = createStore(...args);\n+            const persistor = persistStore(store);\n+            store.persistor = persistor;\n+            return store;\n+        }\n+    ]\n")]),t._v("});\napp.use({ onAction: createLogger() });\napp.use(createLoading());\napp.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n    effects: {\n        *asyncAdd(action, { call, put }) {\n            yield call(delay, 1000);\n            yield put({ type: 'counter/add' });\n        },\n        *goto({ to }, { put }) {\n            yield put(routerRedux.push(to));\n        }\n    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    return (\n        <div>\n            <p> {props.loading.models.counter ? \'loading\' : props.counter.number}</p>\n            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/goto", to: \'/\' })}>跳转到/</button>\n            <button onClick={() => props.dispatch(ActionCreators.undo())}>undo</button>\n            <button onClick={() => props.dispatch(ActionCreators.redo())}>redo</button>\n        </div>\n    )\n')]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    (state) => state.present\n")]),t._v(")(Counter);\nconst Home = () => <div>Home</div>;\nconst UserPageComponent = (dynamic as any)({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    app,\n    models: () => [\n        import('./models/users'),\n    ],\n    component: () => import('./routes/UserPage'),\n")]),t._v("});\napp.router((api: any) => (\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    <PersistGate persistor={(app as any)._store.persistor}>\n        <Router history={api.history}>\n            <>\n                <ul>\n                    <li><Link to="/">Home</Link></li>\n                    <li><Link to="/counter">counter</Link></li>\n                    <li><Link to="/users">users</Link></li>\n                </ul>\n                <Route path="/" exact={true} component={Home} />\n                <Route path="/counter" component={ConnectedCounter} />\n                <Route path="/users" component={UserPageComponent} />\n            </>\n        </Router>\n    </PersistGate>\n')]),t._v("));\napp.start('#root');\n\nfunction delay(ms) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return new Promise((resolve) => {\n        setTimeout(function () {\n            resolve();\n        }, ms);\n    });\n")]),t._v("}\n")])])]),s("h3",{attrs:{id:"_12-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-实现"}},[t._v("#")]),t._v(" 12.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_12-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 12.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import { createStore, combineReducers, applyMiddleware, compose } from 'redux';\n")]),t._v("import createSagaMiddleware from 'redux-saga';\nimport * as sagaEffects from 'redux-saga/effects';\nimport { NAMESPACE_SEP } from './constants';\nimport { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\nimport { createHashHistory } from 'history';\nimport Plugin, { filterHooks } from './plugin';\nimport { routerMiddleware, connectRouter } from \"connected-react-router\";\nlet history = createHashHistory();\nexport { connect };\n\nexport default function (opts: any = {}) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n    const initialReducers = { router: connectRouter(history) };\n    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function router(router: Router) {\n        app._router = router;\n    }\n    const plugin = new Plugin();\n    plugin.use(filterHooks(opts));\n    app.use = plugin.use.bind(plugin);\n    function start(root) {\n        for (const model of app._models) {\n            initialReducers[model.namespace] = getReducer(model);\n        }\n        const reducerEnhancer = plugin.get('onReducer');\n        let rootReducer = createReducer();\n        const sagas = getSagas(app);\n        const sagaMiddleware = createSagaMiddleware();\n        const extraMiddlewares = plugin.get('onAction');\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        const extraEnhancers = plugin.get('extraEnhancers');\n+        const enhancers = [...extraEnhancers, applyMiddleware(...extraMiddlewares, routerMiddleware(history), sagaMiddleware)];\n+        //let store = createStore(rootReducer, opts.initialState, applyMiddleware(...extraMiddlewares, routerMiddleware(history), sagaMiddleware));\n+        let store = createStore(rootReducer, opts.initialState, compose(...enhancers));\n+        app._store = store;\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        const listeners = plugin.get('onStateChange');\n        for (const listener of listeners) {\n            store.subscribe(() => {\n                listener(store.getState());\n            });\n        }\n        sagas.forEach(saga => sagaMiddleware.run(saga));\n        ReactDOM.render(<Provider store={store}>{app._router({ history })}</Provider>, document.querySelector(root))\n        app.model = injectModel.bind(app);\n        app._getSaga = getSaga;\n        function injectModel(m) {\n            m = model(m);\n            initialReducers[m.namespace] = getReducer(m);\n            store.replaceReducer(createReducer());\n            if (m.effects) {\n                sagaMiddleware.run(app._getSaga(m.effects, m));\n            }\n            if (m.subscriptions) {\n                runSubscription(m.subscriptions, m, app);\n            }\n        }\n        function runSubscription(subscriptions, model, app) {\n            for (const key in subscriptions) {\n                subscriptions[key](\n                    {\n                        dispatch: prefixedDispatch(store.dispatch, model),\n                        history: app._history,\n                    }\n                );\n            }\n        }\n        function prefixedDispatch(dispatch, model) {\n            return action => {\n                const { type } = action;\n                return dispatch({ ...action, type: prefixType(type, model) });\n            };\n        }\n        function createReducer() {\n            const extraReducers = plugin.get('extraReducers');\n            return reducerEnhancer(combineReducers({\n                ...initialReducers,\n                ...extraReducers\n            }));\n        }\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function getSagas(app) {\n        let sagas: Array<any> = [];\n        for (const model of app._models) {\n            sagas.push(getSaga(model.effects, model, plugin.get('onEffect')));\n        }\n        return sagas;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\nfunction getSaga(effects, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        for (const key in effects) {\n            const watcher = getWatcher(key, model.effects[key], model, onEffect);\n            yield sagaEffects.fork(watcher);\n        }\n    };\n")]),t._v("}\nfunction getWatcher(key, effect, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n            if (onEffect) {\n                for (const fn of onEffect) {\n                    effect = fn(effect, sagaEffects, model, key);\n                }\n            }\n            yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n        });\n    };\n")]),t._v("}\nfunction prefixType(type, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (type.indexOf('/') === -1) {\n        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n    }\n    return type;\n")]),t._v("}\nfunction getReducer(model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers = {}, state: defaultState } = model;\n    return (state = defaultState, action) => {\n        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n")]),t._v("}\nexport * from './typings';\n")])])]),s("h4",{attrs:{id:"_12-2-2-plugin-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-2-plugin-tsx"}},[t._v("#")]),t._v(" 12.2.2 plugin.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\plugin.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("const hooks = [\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    'onEffect',\n    'extraReducers',\n    'onAction',\n    'onStateChange',\n    'onReducer',\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+    "extraEnhancers"\n')]),t._v("];\nexport function filterHooks(obj) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return Object.keys(obj).reduce((memo, key) => {\n        if (hooks.indexOf(key) > -1) {\n            memo[key] = obj[key];\n        }\n        return memo;\n    }, {});\n")]),t._v("}\nexport default class Plugin {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    hooks: any\n    constructor() {\n        this.hooks = hooks.reduce((memo, key) => {\n            memo[key] = [];\n            return memo;\n        }, {});\n    }\n    use(plugin) {\n        const { hooks } = this;\n        for (const key in plugin) {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            if (key === 'extraEnhancers') {\n+                hooks[key] = plugin[key];\n+            } else {\n+                hooks[key].push(plugin[key]);\n+            }\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        }\n    }\n    get(key) {\n        const { hooks } = this;\n        if (key === 'extraReducers') {\n            return getExtraReducers(hooks[key]);\n        } else if (key === 'onReducer') {\n            return getOnReducer(hooks[key]);\n        } else {\n            return hooks[key];\n        }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    }\n")]),t._v("}\nfunction getOnReducer(hook) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function (reducer) {\n        for (const reducerEnhancer of hook) {\n            reducer = reducerEnhancer(reducer);\n        }\n        return reducer;\n    };\n")]),t._v("}\nfunction getExtraReducers(hook) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let ret = {};\n    for (const reducerObj of hook) {\n        ret = { ...ret, ...reducerObj };\n    }\n    return ret;\n")]),t._v("}\n")])])]),s("h4",{attrs:{id:"_12-2-3-redux-persist-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-3-redux-persist-index-tsx"}},[t._v("#")]),t._v(" 12.2.3 redux-persist\\index.tsx")]),t._v(" "),s("p",[t._v("src\\redux-persist\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" persistReducer "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./persistReducer'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" persistStore "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./persistStore'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    persistReducer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    persistStore\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REHYDRATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'REHYDRATE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"_12-2-4-persistreducer-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-4-persistreducer-tsx"}},[t._v("#")]),t._v(" 12.2.4 persistReducer.tsx")]),t._v(" "),s("p",[t._v("src\\redux-persist\\persistReducer.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("persistConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isInited "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PERSIST_INIT'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                isInited "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" persistConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("storage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'persist:'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" persistConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isInited"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    persistConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("storage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'persist:'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" persistConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"_12-2-5-persiststore-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-5-persiststore-tsx"}},[t._v("#")]),t._v(" 12.2.5 persistStore.tsx")]),t._v(" "),s("p",[t._v("src\\redux-persist\\persistStore.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("store")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" persistor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("store"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            persistor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PERSIST_INIT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" persistor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"_12-2-6-redux-persist-lib-storage-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-6-redux-persist-lib-storage-tsx"}},[t._v("#")]),t._v(" 12.2.6 redux-persist\\lib\\storage.tsx")]),t._v(" "),s("p",[t._v("src\\redux-persist\\lib\\storage.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" storage "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" storage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"_12-2-7-redux-persist-lib-integration-react-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-7-redux-persist-lib-integration-react-tsx"}},[t._v("#")]),t._v(" 12.2.7 redux-persist\\lib\\integration\\react.tsx")]),t._v(" "),s("p",[t._v("src\\redux-persist\\lib\\integration\\react.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Component "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PersistGate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentDidMount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("persistor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" PersistGate "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_13-dva-immer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13-dva-immer"}},[t._v("#")]),t._v(" 13. dva-immer")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://immerjs.github.io/immer/docs/introduction",target:"_blank",rel:"noopener noreferrer"}},[t._v("immer"),s("OutboundLink")],1),t._v("是"),s("code",[t._v("mobx")]),t._v("的作者写的一个"),s("code",[t._v("immutable")]),t._v(" 库，核心实现是利用 ES6 的 proxy，几乎以最小的成本实现了 js 的不可变数据结构")]),t._v(" "),s("li",[t._v("dva-immer\n"),s("ul",[s("li",[s("code",[t._v("currentState")]),t._v(" 被操作对象的最初状态")]),t._v(" "),s("li",[s("code",[t._v("draftState")]),t._v(" 根据 currentState 生成的草稿状态，它是 currentState 的代理，对 draftState 所做的任何修改都将被记录并用于生成 nextState 。在此过程中，currentState 将不受影响")]),t._v(" "),s("li",[s("code",[t._v("nextState")]),t._v(" 根据 draftState 生成的最终状态")]),t._v(" "),s("li",[s("code",[t._v("produce")]),t._v(" 生产 用来生成 nextState的函数")])])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("cnpm i dva"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("immer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("S")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" produce "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"immer"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" baseState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        todo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Learn typescript"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        done"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        todo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Try immer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        done"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" nextState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("produce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("baseState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("draftState")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    draftState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("todo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Tweet about it"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    draftState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_13-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13-1-使用"}},[t._v("#")]),t._v(" 13.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_13-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13-1-1-index-tsx"}},[t._v("#")]),t._v(" 13.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\nimport { Router, Route, routerRedux, Link } from './dva/router';\nimport createLoading from './dva-loading';\nimport dynamic from './dva/dynamic';\nimport { createLogger } from './redux-logger';\nimport undoable, { ActionCreators } from './redux-undo';\nimport { persistStore, persistReducer } from './redux-persist';\nimport storage from './redux-persist/lib/storage';\nimport { PersistGate } from './redux-persist/lib/integration/react';\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import immer from './dva-immer';\n")]),t._v("const persistConfig = {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    key: 'root',\n    storage\n")]),t._v("}\nconst app = dva({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    //initialState: localStorage.getItem('state') ? JSON.parse(localStorage.getItem('state')!) : undefined,\n    onStateChange: function () {\n        //localStorage.setItem('state', JSON.stringify(arguments[0]));\n        console.log('currentState', arguments[0]);\n    },\n    onReducer: reducer => {\n        let undoReducer = undoable(reducer);\n        let rootReducer = persistReducer(persistConfig, undoReducer);\n        return (state, action) => {\n            let newState: any = rootReducer(state, action);\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            return { ...newState, router: newState.present ? newState.present.router : null };\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        }\n    },\n    extraEnhancers: [\n        createStore => (...args) => {\n            const store: any = createStore(...args);\n            const persistor = persistStore(store);\n            store.persistor = persistor;\n            return store;\n        }\n    ]\n")]),t._v("});\napp.use({ onAction: createLogger() });\napp.use(createLoading());\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+app.use(immer());\n")]),t._v("app.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n    effects: {\n        *asyncAdd(action, { call, put }) {\n            yield call(delay, 1000);\n            yield put({ type: 'counter/add' });\n        },\n        *goto({ to }, { put }) {\n            yield put(routerRedux.push(to));\n        }\n    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    return (\n        <div>\n            <p> {props.loading.models.counter ? \'loading\' : props.counter.number}</p>\n            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/goto", to: \'/\' })}>跳转到/</button>\n            <button onClick={() => props.dispatch(ActionCreators.undo())}>undo</button>\n            <button onClick={() => props.dispatch(ActionCreators.redo())}>redo</button>\n        </div>\n    )\n')]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    (state) => state.present\n")]),t._v(")(Counter);\nconst Home = () => <div>Home</div>;\nconst UserPageComponent = (dynamic as any)({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    app,\n    models: () => [\n        import('./models/users'),\n    ],\n    component: () => import('./routes/UserPage'),\n")]),t._v("});\napp.router((api: any) => (\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    <PersistGate persistor={(app as any)._store.persistor}>\n        <Router history={api.history}>\n            <>\n                <ul>\n                    <li><Link to="/">Home</Link></li>\n                    <li><Link to="/counter">counter</Link></li>\n                    <li><Link to="/users">users</Link></li>\n                </ul>\n                <Route path="/" exact={true} component={Home} />\n                <Route path="/counter" component={ConnectedCounter} />\n                <Route path="/users" component={UserPageComponent} />\n            </>\n        </Router>\n    </PersistGate>\n')]),t._v("));\napp.start('#root');\n\nfunction delay(ms) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return new Promise((resolve) => {\n        setTimeout(function () {\n            resolve();\n        }, ms);\n    });\n")]),t._v("}\n")])])]),s("h3",{attrs:{id:"_13-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-实现"}},[t._v("#")]),t._v(" 13.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_13-2-1-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-1-dva-index-tsx"}},[t._v("#")]),t._v(" 13.2.1 dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { createStore, combineReducers, applyMiddleware, compose } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\nimport * as sagaEffects from 'redux-saga/effects';\nimport { NAMESPACE_SEP } from './constants';\nimport { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\nimport { createHashHistory } from 'history';\nimport Plugin, { filterHooks } from './plugin';\nimport { routerMiddleware, connectRouter } from \"connected-react-router\";\nlet history = createHashHistory();\nexport { connect };\n\nexport default function (opts: any = {}) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n    const initialReducers = { router: connectRouter(history) };\n    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function router(router: Router) {\n        app._router = router;\n    }\n    const plugin = new Plugin();\n    plugin.use(filterHooks(opts));\n    app.use = plugin.use.bind(plugin);\n    function start(root) {\n        for (const model of app._models) {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            initialReducers[model.namespace] = getReducer(model, plugin._handleActions);\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        }\n        const reducerEnhancer = plugin.get('onReducer');\n        let rootReducer = createReducer();\n        const sagas = getSagas(app);\n        const sagaMiddleware = createSagaMiddleware();\n        const extraMiddlewares = plugin.get('onAction');\n        const extraEnhancers = plugin.get('extraEnhancers');\n        const enhancers = [...extraEnhancers, applyMiddleware(...extraMiddlewares, routerMiddleware(history), sagaMiddleware)];\n        //let store = createStore(rootReducer, opts.initialState, applyMiddleware(...extraMiddlewares, routerMiddleware(history), sagaMiddleware));\n        let store = createStore(rootReducer, opts.initialState, compose(...enhancers));\n        app._store = store;\n        const listeners = plugin.get('onStateChange');\n        for (const listener of listeners) {\n            store.subscribe(() => {\n                listener(store.getState());\n            });\n        }\n        sagas.forEach(saga => sagaMiddleware.run(saga));\n        ReactDOM.render(<Provider store={store}>{app._router({ history })}</Provider>, document.querySelector(root))\n        app.model = injectModel.bind(app);\n        app._getSaga = getSaga;\n        function injectModel(m) {\n            m = model(m);\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            initialReducers[m.namespace] = getReducer(m, plugin._handleActions);\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("            store.replaceReducer(createReducer());\n            if (m.effects) {\n                sagaMiddleware.run(app._getSaga(m.effects, m));\n            }\n            if (m.subscriptions) {\n                runSubscription(m.subscriptions, m, app);\n            }\n        }\n        function runSubscription(subscriptions, model, app) {\n            for (const key in subscriptions) {\n                subscriptions[key](\n                    {\n                        dispatch: prefixedDispatch(store.dispatch, model),\n                        history: app._history,\n                    }\n                );\n            }\n        }\n        function prefixedDispatch(dispatch, model) {\n            return action => {\n                const { type } = action;\n                return dispatch({ ...action, type: prefixType(type, model) });\n            };\n        }\n        function createReducer() {\n            const extraReducers = plugin.get('extraReducers');\n            return reducerEnhancer(combineReducers({\n                ...initialReducers,\n                ...extraReducers\n            }));\n        }\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function getSagas(app) {\n        let sagas: Array<any> = [];\n        for (const model of app._models) {\n            sagas.push(getSaga(model.effects, model, plugin.get('onEffect')));\n        }\n        return sagas;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\nfunction getSaga(effects, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        for (const key in effects) {\n            const watcher = getWatcher(key, model.effects[key], model, onEffect);\n            yield sagaEffects.fork(watcher);\n        }\n    };\n")]),t._v("}\nfunction getWatcher(key, effect, model, onEffect) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n            if (onEffect) {\n                for (const fn of onEffect) {\n                    effect = fn(effect, sagaEffects, model, key);\n                }\n            }\n            yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n        });\n    };\n")]),t._v("}\nfunction prefixType(type, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (type.indexOf('/') === -1) {\n        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n    }\n    return type;\n")]),t._v("}\nfunction getReducer(model, handleActions) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers = {}, state: defaultState } = model;\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    let reducer = (state = defaultState, action) => {\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    if (handleActions) {\n+        return handleActions(reducers || {}, defaultState);\n+    }\n+    return reducer;\n")]),t._v("}\n\nexport * from './typings';\n")])])]),s("h4",{attrs:{id:"_13-2-2-dva-plugin-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-2-dva-plugin-tsx"}},[t._v("#")]),t._v(" 13.2.2 dva\\plugin.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\plugin.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("const hooks = [\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    'onEffect',\n    'extraReducers',\n    'onAction',\n    'onStateChange',\n    'onReducer',\n    \"extraEnhancers\",\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    '_handleActions'\n")]),t._v("];\nexport function filterHooks(obj) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return Object.keys(obj).reduce((memo, key) => {\n        if (hooks.indexOf(key) > -1) {\n            memo[key] = obj[key];\n        }\n        return memo;\n    }, {});\n")]),t._v("}\nexport default class Plugin {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    hooks: any\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    _handleActions: any = null\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    constructor() {\n        this.hooks = hooks.reduce((memo, key) => {\n            memo[key] = [];\n            return memo;\n        }, {});\n    }\n    use(plugin) {\n        const { hooks } = this;\n        for (const key in plugin) {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            if (key === '_handleActions') {\n+                this._handleActions = plugin[key];\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("            } else if (key === 'extraEnhancers') {\n                hooks[key] = plugin[key];\n            } else {\n                hooks[key].push(plugin[key]);\n            }\n        }\n    }\n    get(key) {\n        const { hooks } = this;\n        if (key === 'extraReducers') {\n            return getExtraReducers(hooks[key]);\n        } else if (key === 'onReducer') {\n            return getOnReducer(hooks[key]);\n        } else {\n            return hooks[key];\n        }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    }\n")]),t._v("}\nfunction getOnReducer(hook) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function (reducer) {\n        for (const reducerEnhancer of hook) {\n            reducer = reducerEnhancer(reducer);\n        }\n        return reducer;\n    };\n")]),t._v("}\nfunction getExtraReducers(hook) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let ret = {};\n    for (const reducerObj of hook) {\n        ret = { ...ret, ...reducerObj };\n    }\n    return ret;\n")]),t._v("}\n")])])]),s("h4",{attrs:{id:"_13-2-3-dva-immer-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-3-dva-immer-tsx"}},[t._v("#")]),t._v(" 13.2.3 dva-immer.tsx")]),t._v(" "),s("p",[t._v("src\\dva-immer.tsx")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" produce "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'immer'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_handleActions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("handlers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" defaultState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" defaultState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ret "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("produce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("draft")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" handler "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" handlers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("draft"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ret "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_14-onerror"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_14-onerror"}},[t._v("#")]),t._v(" 14. onError")]),t._v(" "),s("h3",{attrs:{id:"_14-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_14-1-使用"}},[t._v("#")]),t._v(" 14.1 使用")]),t._v(" "),s("h4",{attrs:{id:"_14-1-1-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_14-1-1-index-tsx"}},[t._v("#")]),t._v(" 14.1.1 index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport dva, { connect } from './dva';\nimport { Router, Route, routerRedux, Link } from './dva/router';\nimport createLoading from './dva-loading';\nimport dynamic from './dva/dynamic';\nimport { createLogger } from './redux-logger';\nimport undoable, { ActionCreators } from './redux-undo';\nimport { persistStore, persistReducer } from './redux-persist';\nimport storage from './redux-persist/lib/storage';\nimport { PersistGate } from './redux-persist/lib/integration/react';\nimport immer from './dva-immer';\nconst persistConfig = {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    key: 'root',\n    storage\n")]),t._v("}\nconst app = dva({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    //initialState: localStorage.getItem('state') ? JSON.parse(localStorage.getItem('state')!) : undefined,\n    onStateChange: function () {\n        //localStorage.setItem('state', JSON.stringify(arguments[0]));\n        console.log('currentState', arguments[0]);\n    },\n    onReducer: reducer => {\n        let undoReducer = undoable(reducer);\n        let rootReducer = persistReducer(persistConfig, undoReducer);\n        return (state, action) => {\n            let newState: any = rootReducer(state, action);\n            return { ...newState, router: newState.present ? newState.present.router : null };\n        }\n    },\n    extraEnhancers: [\n        createStore => (...args) => {\n            const store: any = createStore(...args);\n            const persistor = persistStore(store);\n            store.persistor = persistor;\n            return store;\n        }\n    ],\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    onError(err, dispatch) {\n+        console.error('onError', err);\n+    }\n")]),t._v("});\napp.use({ onAction: createLogger() });\napp.use(createLoading());\napp.use(immer());\napp.model({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    namespace: 'counter',\n    state: { number: 0 },\n    reducers: {\n        add(state) {\n            return { number: state.number + 1 };\n        }\n    },\n    effects: {\n        *asyncAdd(action, { call, put }) {\n            yield call(delay, 1000);\n            yield put({ type: 'counter/add' });\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            throw new Error('asyncAdd');\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        },\n        *goto({ to }, { put }) {\n            yield put(routerRedux.push(to));\n        }\n    },\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    subscriptions: {\n+        changeTitle({ dispatch, history }, done) {\n+            console.log('changeTitle');\n+            done('出错啦');\n+        }\n+    }\n")]),t._v("});\nfunction Counter(props) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    return (\n        <div>\n            <p> {props.loading.models.counter ? \'loading\' : props.counter.number}</p>\n            <button onClick={() => props.dispatch({ type: "counter/add" })}>加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/asyncAdd" })}>异步加1</button>\n            <button onClick={() => props.dispatch({ type: "counter/goto", to: \'/\' })}>跳转到/</button>\n            <button onClick={() => props.dispatch(ActionCreators.undo())}>undo</button>\n            <button onClick={() => props.dispatch(ActionCreators.redo())}>redo</button>\n        </div>\n    )\n')]),t._v("}\nconst ConnectedCounter = connect(\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    (state) => state.present\n")]),t._v(")(Counter);\nconst Home = () => <div>Home</div>;\nconst UserPageComponent = (dynamic as any)({\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    app,\n    models: () => [\n        import('./models/users'),\n    ],\n    component: () => import('./routes/UserPage'),\n")]),t._v("});\napp.router((api: any) => (\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    <PersistGate persistor={(app as any)._store.persistor}>\n        <Router history={api.history}>\n            <>\n                <ul>\n                    <li><Link to="/">Home</Link></li>\n                    <li><Link to="/counter">counter</Link></li>\n                    <li><Link to="/users">users</Link></li>\n                </ul>\n                <Route path="/" exact={true} component={Home} />\n                <Route path="/counter" component={ConnectedCounter} />\n                <Route path="/users" component={UserPageComponent} />\n            </>\n        </Router>\n    </PersistGate>\n')]),t._v("));\napp.start('#root');\n\nfunction delay(ms) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return new Promise((resolve) => {\n        setTimeout(function () {\n            resolve();\n        }, ms);\n    });\n")]),t._v("}\n")])])]),s("h3",{attrs:{id:"_14-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_14-2-实现"}},[t._v("#")]),t._v(" 14.2 实现")]),t._v(" "),s("h4",{attrs:{id:"_14-2-1-src-dva-index-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_14-2-1-src-dva-index-tsx"}},[t._v("#")]),t._v(" 14.2.1 src\\dva\\index.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\index.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { createStore, combineReducers, applyMiddleware, compose } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\nimport * as sagaEffects from 'redux-saga/effects';\nimport { NAMESPACE_SEP } from './constants';\nimport { connect, Provider } from 'react-redux';\nimport { DvaInstance, Router, Model } from './typings';\nimport prefixNamespace from './prefixNamespace';\nimport { createHashHistory } from 'history';\nimport Plugin, { filterHooks } from './plugin';\nimport { routerMiddleware, connectRouter } from \"connected-react-router\";\nlet history = createHashHistory();\nexport { connect };\n\nexport default function (opts: any = {}) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    const app: DvaInstance = {\n        _models: [],\n        model,\n        router,\n        _router: null,\n        start\n    }\n    const initialReducers = { router: connectRouter(history) };\n    function model(model: Model) {\n        const prefixedModel = prefixNamespace(model);\n        app._models.push(prefixedModel);\n        return prefixedModel;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function router(router: Router) {\n        app._router = router;\n    }\n    const plugin = new Plugin();\n    plugin.use(filterHooks(opts));\n    app.use = plugin.use.bind(plugin);\n    function start(root) {\n        for (const model of app._models) {\n            initialReducers[model.namespace] = getReducer(model, plugin._handleActions);\n        }\n        const reducerEnhancer = plugin.get('onReducer');\n        let rootReducer = createReducer();\n        const sagas = getSagas(app);\n        const sagaMiddleware = createSagaMiddleware();\n        const extraMiddlewares = plugin.get('onAction');\n        const extraEnhancers = plugin.get('extraEnhancers');\n        const enhancers = [...extraEnhancers, applyMiddleware(...extraMiddlewares, routerMiddleware(history), sagaMiddleware)];\n        //let store = createStore(rootReducer, opts.initialState, applyMiddleware(...extraMiddlewares, routerMiddleware(history), sagaMiddleware));\n        let store = createStore(rootReducer, opts.initialState, compose(...enhancers));\n        app._store = store;\n        const listeners = plugin.get('onStateChange');\n        for (const listener of listeners) {\n            store.subscribe(() => {\n                listener(store.getState());\n            });\n        }\n        sagas.forEach(saga => sagaMiddleware.run(saga));\n        ReactDOM.render(<Provider store={store}>{app._router({ history })}</Provider>, document.querySelector(root))\n        app.model = injectModel.bind(app);\n        app._getSaga = getSaga;\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        for (const model of app._models) {\n+            if (model.subscriptions) {\n+                runSubscription(model.subscriptions, model, app, plugin.get('onError'));\n+            }\n+        }\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        function injectModel(m) {\n            m = model(m);\n            initialReducers[m.namespace] = getReducer(m, plugin._handleActions);\n            store.replaceReducer(createReducer());\n            if (m.effects) {\n                sagaMiddleware.run(app._getSaga(m.effects, m));\n            }\n            if (m.subscriptions) {\n                runSubscription(m.subscriptions, m, app, plugin.get('onError'));\n            }\n        }\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        function runSubscription(subscriptions, model, app, onError) {\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("            for (const key in subscriptions) {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                let dispatch = prefixedDispatch(store.dispatch, model);\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                subscriptions[key](\n                    {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                        dispatch,\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                        history: app._history,\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                    }, err => {\n+                        for (let fn of onError) {\n+                            fn(err, dispatch);\n+                        }\n+                    }\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                );\n            }\n        }\n        function prefixedDispatch(dispatch, model) {\n            return action => {\n                const { type } = action;\n                return dispatch({ ...action, type: prefixType(type, model) });\n            };\n        }\n        function createReducer() {\n            const extraReducers = plugin.get('extraReducers');\n            return reducerEnhancer(combineReducers({\n                ...initialReducers,\n                ...extraReducers\n            }));\n        }\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    function getSagas(app) {\n        let sagas: Array<any> = [];\n        for (const model of app._models) {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            sagas.push(getSaga(model.effects, model, plugin.get('onEffect'), plugin.get('onError')));\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        }\n        return sagas;\n    }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return app;\n")]),t._v("}\n\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+function getSaga(effects, model, onEffect, onError) {\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        for (const key in effects) {\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            const watcher = getWatcher(key, model.effects[key], model, onEffect, onError);\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("            yield sagaEffects.fork(watcher);\n        }\n    };\n")]),t._v("}\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+function getWatcher(key, effect, model, onEffect, onError) {\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function* () {\n        yield sagaEffects.takeEvery(key, function* sagaWithCatch(...args) {\n            if (onEffect) {\n                for (const fn of onEffect) {\n                    effect = fn(effect, sagaEffects, model, key);\n                }\n            }\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            try {\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                yield effect(...args, { ...sagaEffects, put: action => sagaEffects.put({ ...action, type: prefixType(action.type, model) }) });\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            } catch (err) {\n+                for (const fn of onError) {\n+                    fn(err);\n+                }\n+            }\n")]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        });\n    };\n")]),t._v("}\nfunction prefixType(type, model) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    if (type.indexOf('/') === -1) {\n        return `${model.namespace}${NAMESPACE_SEP}${type}`;\n    }\n    return type;\n")]),t._v("}\nfunction getReducer(model, handleActions) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let { reducers = {}, state: defaultState } = model;\n    let reducer = (state = defaultState, action) => {\n        let reducer = reducers[action.type];\n        if (reducer) {\n            return reducer(state, action);\n        }\n        return state;\n    }\n    if (handleActions) {\n        return handleActions(reducers || {}, defaultState);\n    }\n    return reducer;\n")]),t._v("}\n\nexport * from './typings';\n")])])]),s("h4",{attrs:{id:"_14-2-2-src-dva-plugin-tsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_14-2-2-src-dva-plugin-tsx"}},[t._v("#")]),t._v(" 14.2.2 src\\dva\\plugin.tsx")]),t._v(" "),s("p",[t._v("src\\dva\\plugin.tsx")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("const hooks = [\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    'onEffect',\n    'extraReducers',\n    'onAction',\n    'onStateChange',\n    'onReducer',\n    \"extraEnhancers\",\n    '_handleActions',\n")]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+    "onError"\n')]),t._v("];\nexport function filterHooks(obj) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return Object.keys(obj).reduce((memo, key) => {\n        if (hooks.indexOf(key) > -1) {\n            memo[key] = obj[key];\n        }\n        return memo;\n    }, {});\n")]),t._v("}\nexport default class Plugin {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    hooks: any\n    _handleActions: any = null\n    constructor() {\n        this.hooks = hooks.reduce((memo, key) => {\n            memo[key] = [];\n            return memo;\n        }, {});\n    }\n    use(plugin) {\n        const { hooks } = this;\n        for (const key in plugin) {\n            if (key === '_handleActions') {\n                this._handleActions = plugin[key];\n            } else if (key === 'extraEnhancers') {\n                hooks[key] = plugin[key];\n            } else {\n                hooks[key].push(plugin[key]);\n            }\n        }\n    }\n    get(key) {\n        const { hooks } = this;\n        if (key === 'extraReducers') {\n            return getExtraReducers(hooks[key]);\n        } else if (key === 'onReducer') {\n            return getOnReducer(hooks[key]);\n        } else {\n            return hooks[key];\n        }\n")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    }\n")]),t._v("}\nfunction getOnReducer(hook) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    return function (reducer) {\n        for (const reducerEnhancer of hook) {\n            reducer = reducerEnhancer(reducer);\n        }\n        return reducer;\n    };\n")]),t._v("}\nfunction getExtraReducers(hook) {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    let ret = {};\n    for (const reducerObj of hook) {\n        ret = { ...ret, ...reducerObj };\n    }\n    return ret;\n")]),t._v("}\n")])])]),s("p",[s("a",{attrs:{href:"https://gitee.com/zhufengpeixun/zhufeng-dva-source-typescript2",target:"_blank",rel:"noopener noreferrer"}},[t._v("dva-source"),s("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=e.exports}}]);