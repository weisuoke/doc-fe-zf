(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{354:function(t,s,a){"use strict";a.r(s);var n=a(33),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"tree"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tree"}},[t._v("#")]),t._v(" Tree")]),t._v(" "),a("h2",{attrs:{id:"_1-初始化项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-初始化项目"}},[t._v("#")]),t._v(" 1. 初始化项目")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://img.zhufengpeixun.cn/tree4.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("项目预览"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"_1-1-创建项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-创建项目"}},[t._v("#")]),t._v(" 1.1 创建项目")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("mkdir zhufeng_prepare_tree\ncd zhufeng_prepare_tree\ncnpm init "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y\ntouch "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gitignore\n")])])]),a("h3",{attrs:{id:"_1-2-安装依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-安装依赖"}},[t._v("#")]),t._v(" 1.2 安装依赖")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/DefinitelyTyped/DefinitelyTyped",target:"_blank",rel:"noopener noreferrer"}},[t._v("@types"),a("OutboundLink")],1),t._v("开头的包都是typeScript的声明文件，可以进入"),a("code",[t._v("node_modules/@types/XX/index.d.ts")]),t._v("进行查看")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("cnpm i react @types"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("react react"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dom @types"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("react"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dom "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("S")]),t._v("\ncnpm i webpack webpack"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cli webpack"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\ncnpm i typescript ts"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("loader source"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("map"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("loader style"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("loader css"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("loader  less"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("loader  less file"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("loader url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("loader html"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("webpack"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("plugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\ncnpm i jest @types"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("jest ts"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("jest jest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("junit enzyme @types"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("enzyme \nenzyme"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("adapter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("react"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" @types"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("enzyme"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("adapter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("react"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\ncnpm i axios express qs @types"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("qs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("模块名")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("使用方式")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("react")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("React is a JavaScript library for creating user interfaces.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("react-dom")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("This package serves as the entry point to the DOM and server renderers for React. It is intended to be paired with the generic React package, which is shipped as react to npm.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("webpack")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("webpack is a module bundler. Its main purpose is to bundle JavaScript files for usage in a browser, yet it is also capable of transforming, bundling, or packaging just about any resource or asset.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("webpack-cli")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("The official CLI of webpack")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("webpack-dev-server")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Use webpack with a development server that provides live reloading. This should be used for development only.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("typescript")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("TypeScript is a language for application-scale JavaScript.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("ts-loader")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("This is the TypeScript loader for webpack.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("source-map-loader")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Extracts source maps from existing source files (from their sourceMappingURL).")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("style-loader")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Inject CSS into the DOM.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("css-loader")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("The css-loader interprets @import and url() like import/require() and will resolve them.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("less-loader")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("A Less loader for webpack. Compiles Less to CSS.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("less")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("This is the JavaScript, official, stable version of Less.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("file-loader")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("The file-loader resolves import/require() on a file into a url and emits the file into the output directory.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("url-loader")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("A loader for webpack which transforms files into base64 URIs.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("html-webpack-plugin")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Plugin that simplifies creation of HTML files to serve your bundles")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("jest")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://jestjs.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("jest"),a("OutboundLink")],1),t._v(" is a delightful JavaScript Testing Framework with a focus on simplicity.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("jest-junit")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("A Jest reporter that creates compatible junit xml files")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("ts-jest")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ts-jest is a TypeScript preprocessor with source map support for Jest that lets you use Jest to test projects written in TypeScript.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("enzyme")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("JavaScript Testing utilities for React")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("enzyme-adapter-react-16")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Enzyme is a JavaScript Testing utility for React that makes it easier to test your React Components' output. You can also manipulate, traverse, and in some ways simulate runtime given the output.")])])])]),t._v(" "),a("h3",{attrs:{id:"_1-3-支持typescript"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-支持typescript"}},[t._v("#")]),t._v(" 1.3 支持typescript")]),t._v(" "),a("ul",[a("li",[t._v("首先需要生成一个"),a("code",[t._v("tsconfig.json")]),t._v("文件来告诉"),a("code",[t._v("ts-loader")]),t._v("如何编译代码TypeScript代码")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("tsc "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("init\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"compilerOptions"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"target"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"es5"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"module"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"commonjs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsx"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"react"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"outDir"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./dist"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rootDir"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"noImplicitAny"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"esModuleInterop"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"include"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src/**/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./typings/**/*"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("target")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("转换成es5")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("module")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("代码规范")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("jsx")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("react模式会生成React.createElement，在使用前不需要再进行转换操作了，输出文件的扩展名为.js")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("outDir")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定输出目录")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("rootDir")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定根目录")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("sourceMap")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("把 ts 文件编译成 js 文件的时候，同时生成对应的sourceMap文件")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("noImplicitAny")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("如果为true的话，TypeScript 编译器无法推断出类型时，它仍然会生成 JS文件，但是它也会报告一个错误")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("esModuleInterop")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("是否转译common.js模块")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("include")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("需要编译的目录")])])])]),t._v(" "),a("h3",{attrs:{id:"_1-4-webpack-config-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-webpack-config-js"}},[t._v("#")]),t._v(" 1.4 webpack.config.js")]),t._v(" "),a("p",[t._v("webpack.config.js")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" webpack "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HtmlWebpackPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html-webpack-plugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'development'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src/index.tsx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    devtool"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source-map"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    devServer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        hot"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        contentBase"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        historyApiFallback"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            index"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./index.html'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    resolve"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        extensions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".ts"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".tsx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\.tsx?$/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            loader"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ts-loader"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            enforce"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pre"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\.tsx$/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            loader"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"source-map-loader"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\.less$/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'style-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'less-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\.(jpg|png|gif|svg)$/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            loader"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"url-loader"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HtmlWebpackPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            template"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./src/index.html'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("webpack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HotModuleReplacementPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_1-5-src-index-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-src-index-tsx"}},[t._v("#")]),t._v(" 1.5 src\\index.tsx")]),t._v(" "),a("p",[t._v("src\\index.tsx")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_1-6-src-index-html"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-src-index-html"}},[t._v("#")]),t._v(" 1.6 src\\index.html")]),t._v(" "),a("p",[t._v("src\\index.html")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h3",{attrs:{id:"_1-7-package-json"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-package-json"}},[t._v("#")]),t._v(" 1.7 package.json")]),t._v(" "),a("p",[t._v("package.json")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpack"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpack-dev-server"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jest"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"_2-单元测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-单元测试"}},[t._v("#")]),t._v(" 2. 单元测试")]),t._v(" "),a("h3",{attrs:{id:"_2-1-jest-config-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-jest-config-js"}},[t._v("#")]),t._v(" 2.1 jest.config.js")]),t._v(" "),a("p",[t._v("jest.config.js")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    verbose"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    clearMocks"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    collectCoverage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    reporters"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jest-junit"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    moduleFileExtensions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tsx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    moduleDirectories"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    transform"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^.+\\\\.tsx?$'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ts-jest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    moduleNameMapper"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\\\.(jpg|jpeg|png|gif||svg|ttf|woff|woff2)$"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<rootDir>/test/__mocks__/file-mock.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\\\.(css|less|sass|scss)$"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<rootDir>/test/__mocks__/object-mock.js"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    testRegex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'(/__tests__/.*|(\\\\.|/)(test|spec))\\\\.(jsx|tsx)$'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    moduleFileExtensions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tsx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    setupFilesAfterEnv"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<rootDir>/test/setupTests.tsx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-2-src-utils-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-src-utils-tsx"}},[t._v("#")]),t._v(" 2.2 src\\utils.tsx")]),t._v(" "),a("p",[t._v("src\\utils.tsx")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-3-utils-spec-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-utils-spec-tsx"}},[t._v("#")]),t._v(" 2.3 utils.spec.tsx")]),t._v(" "),a("p",[t._v("src__tests__\\utils.spec.tsx")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" sum "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../utils'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("describe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sum'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1+1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2+2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-4-mocks-file-mock-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-mocks-file-mock-js"}},[t._v("#")]),t._v(" 2.4 mocks\\file-mock.js")]),t._v(" "),a("p",[t._v("test__mocks__\\file-mock.js")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'file-stub'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-5-object-mock-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-object-mock-js"}},[t._v("#")]),t._v(" 2.5 object-mock.js")]),t._v(" "),a("p",[t._v("test__mocks__\\object-mock.js")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"_3-创建树型菜单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建树型菜单"}},[t._v("#")]),t._v(" 3. 创建树型菜单")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2020-04-21-150936.png",alt:"treecomponent"}})]),t._v(" "),a("h3",{attrs:{id:"_3-1-src-index-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-src-index-tsx"}},[t._v("#")]),t._v(" 3.1 src\\index.tsx")]),t._v(" "),a("p",[t._v("src\\index.tsx")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ReactDOM "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react-dom'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Tree "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./components/tree'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nReactDOM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-2-src-data-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-src-data-tsx"}},[t._v("#")]),t._v(" 3.2 src\\data.tsx")]),t._v(" "),a("p",[t._v("src\\data.tsx")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" TreeData "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./typings'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TreeData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'父亲'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'folder'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    collapsed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    children"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'儿子1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1-1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'folder'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            collapsed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            children"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'孙子1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1-1-1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'folder'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    collapsed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    children"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'重孙1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1-1-1-1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'file'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            collapsed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            children"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'儿子2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1-2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'folder'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            collapsed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-3-typings-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-typings-tsx"}},[t._v("#")]),t._v(" 3.3 typings.tsx")]),t._v(" "),a("p",[t._v("src\\typings.tsx")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TreeData")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    collapsed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    children"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    parent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TreeData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-4-components-tree-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-components-tree-tsx"}},[t._v("#")]),t._v(" 3.4 components\\tree.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree.tsx")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./index.less'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" TreeData "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../typings'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Props")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TreeData\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tree")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            \n\n                Tree\n            \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" Tree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-5-index-less"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-index-less"}},[t._v("#")]),t._v(" 3.5 index.less")]),t._v(" "),a("p",[t._v("src\\components\\index.less")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    position"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fixed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    left"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    top"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    bottom"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    width"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    overflow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hidden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    overflow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" auto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    background"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("color"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" #"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EEE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"_4-渲染树型结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-渲染树型结构"}},[t._v("#")]),t._v(" 4. 渲染树型结构")]),t._v(" "),a("h3",{attrs:{id:"_4-1-src-components-tree-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-src-components-tree-tsx"}},[t._v("#")]),t._v(" 4.1 src\\components\\tree.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree.tsx")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("import React from 'react';\nimport './index.less';\nimport { TreeData } from '../typings';\n"),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import TreeNode from './tree-node';\n")]),t._v("interface Props {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData\n")]),t._v("}\n"),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+interface KeyToNodeMap {\n+    [key: string]: TreeData\n+}\n+interface State {\n+    data: TreeData\n+}\n")]),t._v("class Tree extends React.Component<Props, State> {\n"),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    data: TreeData;\n+    keyToNodeMap: KeyToNodeMap;\n+    constructor(props: Props) {\n+        super(props);\n+        this.data = props.data;\n+        this.state={ data: this.props.data };\n+        this.buildKeyMap();\n+    }\n+    buildKeyMap = () => {\n+        let data = this.data;\n+        this.keyToNodeMap = {};\n+        this.keyToNodeMap[data.key] = data;\n+        if (data.children && data.children.length > 0) {\n+            this.walk(data.children, data);\n+        }\n+    }\n+    walk = (children: Array<TreeData>, parent: TreeData): void => {\n+        children.map((item: TreeData) => {\n+            item.parent = parent;\n+            this.keyToNodeMap[item.key] = item;\n+            if (item.children && item.children.length > 0) {\n+                this.walk(item.children, item);\n+            }\n+        });\n+    }\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    render() {\n        return (\n            <div className="tree">\n')]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+                <div className="tree-nodes">\n+                    <TreeNode\n+                        data={this.props.data}\n+                    />\n+                </div>\n')]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("            </div>\n        )\n    }\n")]),t._v("}\nexport default Tree;\n")])])]),a("h3",{attrs:{id:"_4-2-index-less"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-index-less"}},[t._v("#")]),t._v(" 4.2 index.less")]),t._v(" "),a("p",[t._v("src\\components\\index.less")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v(".tree{\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    position: fixed;\n    left:0;\n    top:0;\n    bottom:0;\n    width:80%;\n    overflow-x: hidden;\n    overflow-y: auto;\n    background-color: #EEE;\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    .tree-nodes{\n+        position: relative;\n+        overflow:hidden;\n+        .tree-node{\n+            .inner{\n+                color:#000;\n+                font-size:20px;\n+                position: relative;\n+                cursor:pointer;\n+                padding-left:10px;\n+                .content{\n+                    display: inline-block;\n+                    width:100%;\n+                    padding:4px 5px;\n+                }\n+            }\n+            .children{\n+                padding-left: 20px;\n+            }\n+        }    \n+    }\n")]),t._v("}\n")])])]),a("h3",{attrs:{id:"_4-3-components-tree-node-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-components-tree-node-tsx"}},[t._v("#")]),t._v(" 4.3 components\\tree-node.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree-node.tsx")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" TreeData "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../typings'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Props")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TreeData\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TreeNode")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Props"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Props")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" children "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div className"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tree-node"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div className"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"inner"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("span className"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"content"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("span"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("children "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div className"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"children"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                                children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TreeData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("TreeNode key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" TreeNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"_5-打开关闭功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-打开关闭功能"}},[t._v("#")]),t._v(" 5. 打开关闭功能")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://img.zhufengpeixun.cn/icons.zip",target:"_blank",rel:"noopener noreferrer"}},[t._v("icons.zip"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"_5-1-components-tree-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-components-tree-tsx"}},[t._v("#")]),t._v(" 5.1 components\\tree.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree.tsx")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("import React from 'react';\nimport './index.less';\nimport { TreeData } from '../typings';\nimport TreeNode from './tree-node';\ninterface Props {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData\n")]),t._v("}\ninterface KeyToNodeMap {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    [key: string]: TreeData\n")]),t._v("}\ninterface State {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData\n")]),t._v("}\nclass Tree extends React.Component<Props, State> {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData;\n    keyToNodeMap: KeyToNodeMap;\n    constructor(props: Props) {\n        super(props);\n        this.data = props.data;\n        this.state={ data: this.props.data };\n        this.buildKeyMap();\n    }\n    buildKeyMap = () => {\n        let data = this.data;\n        this.keyToNodeMap = {};\n        this.keyToNodeMap[data.key] = data;\n        if (data.children && data.children.length > 0) {\n            this.walk(data.children, data);\n        }\n    }\n    walk = (children: Array<TreeData>, parent: TreeData): void => {\n        children.map((item: TreeData) => {\n            item.parent = parent;\n            this.keyToNodeMap[item.key] = item;\n            if (item.children && item.children.length > 0) {\n                this.walk(item.children, item);\n            }\n        });\n    }\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    onCollapse = (key: string) => {\n+        let data = this.keyToNodeMap[key];\n+        if (data) {\n+            data.collapsed = !data.collapsed;\n+            data.children = data.children || [];\n+            this.setState({ data: this.state.data });\n+        }\n+    }\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    render() {\n        return (\n            <div className="tree">\n                <div className="tree-nodes">\n                    <TreeNode\n                        data={this.props.data}\n')]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                        onCollapse={this.onCollapse}\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                    />\n                </div>\n            </div>\n        )\n    }\n")]),t._v("}\nexport default Tree;\n")])])]),a("h3",{attrs:{id:"_5-2-tree-node-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-tree-node-tsx"}},[t._v("#")]),t._v(" 5.2 tree-node.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree-node.tsx")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("import React from 'react';\nimport { TreeData } from '../typings';\n"),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import file from '../assets/file.png';\n+import closedFolder from '../assets/closed-folder.png';\n+import openedFolder from '../assets/opened-folder.png';\n")]),t._v("interface Props {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData,\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    onCollapse: any\n")]),t._v("}\nclass TreeNode extends React.Component<Props> {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    constructor(props: Props) {\n        super(props);\n    }\n    render() {\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        let { data: { name, children, collapsed = false, key } } = this.props;\n+        let caret, icon;\n+        if (children) {\n+            if (children.length > 0) {\n+                caret = (\n+                    <span className={`collapse ${collapsed ? 'caret-right' : 'caret-down'}`}\n+                        onClick={() => this.props.onCollapse(key)}\n+                    />\n+                )\n+                icon = collapsed ? closedFolder : openedFolder;\n+            } else {\n+                caret = null;\n+                icon = file;\n+            }\n+        } else {\n+            caret = (\n+                <span className={`collapse caret-right`}\n+                    onClick={() => this.props.onCollapse(key)}\n+                />\n+            )\n+            icon = closedFolder;\n+        }\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('        return (\n            <div className="tree-node">\n                <div className="inner">\n')]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+                    {caret}\n+                    <span className="content">\n+                        <img style={{ width: 20 }} src={icon} />\n+                        {name}\n+                    </span>\n')]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                </div>\n                {\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                    (children && children.length > 0 && !collapsed) && (\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('                        <div className="children">\n                            {\n                                children.map((item: TreeData) => (\n                                    <TreeNode\n')]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                                        onCollapse={this.props.onCollapse}\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                                        key={item.key}\n                                        data={item} />\n                                ))\n                            }\n                        </div>\n                    )\n                }\n            </div>\n        )\n    }\n")]),t._v("}\nexport default TreeNode;\n")])])]),a("h3",{attrs:{id:"_5-3-components-index-less"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-components-index-less"}},[t._v("#")]),t._v(" 5.3 components\\index.less")]),t._v(" "),a("p",[t._v("src\\components\\index.less")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v(".tree{\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    position: fixed;\n    left:0;\n    top:0;\n    bottom:0;\n    width:80%;\n    overflow-x: hidden;\n    overflow-y: auto;\n    background-color: #EEE;\n    .tree-nodes{\n        position: relative;\n        overflow:hidden;\n        .tree-node{\n            .inner{\n                color:#000;\n                font-size:20px;\n                position: relative;\n                cursor:pointer;\n                padding-left:10px;\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                .collapse {\n+                    position: absolute;\n+                    left: 0;\n+                    cursor: pointer;\n+                }\n+                .caret-right:before {\n+                    content: '\\25B8';\n+                }\n+                .caret-down:before {\n+                    content: '\\25BE';\n+                }\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                .content{\n                    display: inline-block;\n                    width:100%;\n                    padding:4px 5px;\n                }\n            }\n            .children{\n                padding-left: 20px;\n            }\n        }\n")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    }\n")]),t._v("}\n")])])]),a("h3",{attrs:{id:"_5-4-images-d-ts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-images-d-ts"}},[t._v("#")]),t._v(" 5.4 images.d.ts")]),t._v(" "),a("p",[t._v("typings\\images.d.ts")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*.svg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*.png'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*.jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*.jpeg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*.gif'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*.bmp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*.tiff'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"_6-全选和全消功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-全选和全消功能"}},[t._v("#")]),t._v(" 6. 全选和全消功能")]),t._v(" "),a("h3",{attrs:{id:"_6-1-src-typings-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-src-typings-tsx"}},[t._v("#")]),t._v(" 6.1 src\\typings.tsx")]),t._v(" "),a("p",[t._v("src\\typings.tsx")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TreeData")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    collapsed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    children"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Array"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("TreeData"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    parent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TreeData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    checked"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_6-2-components-tree-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-components-tree-tsx"}},[t._v("#")]),t._v(" 6.2 components\\tree.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree.tsx")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("import React from 'react';\nimport './index.less';\nimport { TreeData } from '../typings';\nimport TreeNode from './tree-node';\ninterface Props {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData\n")]),t._v("}\ninterface KeyToNodeMap {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    [key: string]: TreeData\n")]),t._v("}\ninterface State {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData\n")]),t._v("}\nclass Tree extends React.Component<Props, State> {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData;\n    keyToNodeMap: KeyToNodeMap;\n    constructor(props: Props) {\n        super(props);\n        this.data = props.data;\n        this.state={ data: this.props.data };\n        this.buildKeyMap();\n    }\n    buildKeyMap = () => {\n        let data = this.data;\n        this.keyToNodeMap = {};\n        this.keyToNodeMap[data.key] = data;\n        if (data.children && data.children.length > 0) {\n            this.walk(data.children, data);\n        }\n    }\n    walk = (children: Array<TreeData>, parent: TreeData): void => {\n        children.map((item: TreeData) => {\n            item.parent = parent;\n            this.keyToNodeMap[item.key] = item;\n            if (item.children && item.children.length > 0) {\n                this.walk(item.children, item);\n            }\n        });\n    }\n    onCollapse = (key: string) => {\n        let data = this.keyToNodeMap[key];\n        if (data) {\n            data.collapsed = !data.collapsed;\n            data.children = data.children || [];\n            this.setState({ data: this.state.data });\n        }\n    }\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    onCheck = (key: string) => {\n+        let data: TreeData = this.keyToNodeMap[key];\n+        if (data) {\n+            data.checked = !data.checked;\n+            if (data.checked) {\n+                this.checkChildren(data.children, true);\n+                this.checkParentCheckAll(data.parent);\n+            } else {\n+                this.checkChildren(data.children, false);\n+                this.checkParent(data.parent, false);\n+            }\n+            this.setState({ data: this.state.data });\n+        }\n+    }\n+    checkParentCheckAll = (parent: TreeData) => {\n+        while (parent) {\n+            parent.checked = parent.children.every(item => item.checked);\n+            parent = parent.parent;\n+        }\n+    }\n+    checkParent = (parent: TreeData, checked: boolean) => {\n+        while (parent) {\n+            parent.checked = checked;\n+            parent = parent.parent;\n+        }\n+    }\n+    checkChildren = (children: Array<TreeData> = [], checked: boolean) => {\n+        children.forEach((item: TreeData) => {\n+            item.checked = checked;\n+            this.checkChildren(item.children, checked);\n+        });\n+    }\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    render() {\n        return (\n            <div className="tree">\n                <div className="tree-nodes">\n                    <TreeNode\n                        data={this.props.data}\n                        onCollapse={this.onCollapse}\n')]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                        onCheck={this.onCheck}\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                    />\n                </div>\n            </div>\n        )\n    }\n")]),t._v("}\nexport default Tree;\n")])])]),a("h3",{attrs:{id:"_6-3-tree-node-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-tree-node-tsx"}},[t._v("#")]),t._v(" 6.3 tree-node.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree-node.tsx")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("import React from 'react';\nimport { TreeData } from '../typings';\nimport file from '../assets/file.png';\nimport closedFolder from '../assets/closed-folder.png';\nimport openedFolder from '../assets/opened-folder.png';\ninterface Props {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData,\n    onCollapse: any,\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    onCheck: any\n")]),t._v("}\nclass TreeNode extends React.Component<Props> {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    constructor(props: Props) {\n        super(props);\n    }\n    render() {\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        let { data: { name, children, collapsed = false, key, checked = false } } = this.props;\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('        let caret, icon;\n        if (children) {\n            if (children.length > 0) {\n                caret = (\n                    <span className={`collapse ${collapsed ? \'caret-right\' : \'caret-down\'}`}\n                        onClick={() => this.props.onCollapse(key)}\n                    />\n                )\n                icon = collapsed ? closedFolder : openedFolder;\n            } else {\n                caret = null;\n                icon = file;\n            }\n        } else {\n            caret = (\n                <span className={`collapse caret-right`}\n                    onClick={() => this.props.onCollapse(key)}\n                />\n            )\n            icon = closedFolder;\n        }\n        return (\n            <div className="tree-node">\n                <div className="inner">\n                    {caret}\n                    <span className="content">\n')]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v('+                        <input type="checkbox" checked={checked} onChange={() => this.props.onCheck(key)} />\n')]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('                        <img style={{ width: 20 }} src={icon} />\n                        {name}\n                    </span>\n                </div>\n                {\n                    (children && children.length > 0 && !collapsed) && (\n                        <div className="children">\n                            {\n                                children.map((item: TreeData) => (\n                                    <TreeNode\n                                        onCollapse={this.props.onCollapse}\n')]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                                       onCheck={this.props.onCheck}\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                                        key={item.key}\n                                        data={item} />\n                                ))\n                            }\n                        </div>\n                    )\n                }\n            </div>\n        )\n    }\n")]),t._v("}\nexport default TreeNode;\n")])])]),a("h2",{attrs:{id:"_7-动态加载数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-动态加载数据"}},[t._v("#")]),t._v(" 7. 动态加载数据")]),t._v(" "),a("h3",{attrs:{id:"_7-1-typings-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-typings-tsx"}},[t._v("#")]),t._v(" 7.1 typings.tsx")]),t._v(" "),a("p",[t._v("src\\typings.tsx")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("export interface TreeData {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    name: string;\n    key: string;\n    type: string;\n    collapsed: boolean;\n    children?: Array<TreeData>;\n    parent?: TreeData;\n    checked?: boolean;\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+   loading?: boolean;\n")]),t._v("}\n")])])]),a("h3",{attrs:{id:"_7-2-tree-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-tree-tsx"}},[t._v("#")]),t._v(" 7.2 tree.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree.tsx")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("import React from 'react';\nimport './index.less';\nimport { TreeData } from '../typings';\nimport TreeNode from './tree-node';\n"),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import { getChildren } from '../api';\n")]),t._v("interface Props {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData\n")]),t._v("}\ninterface KeyToNodeMap {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    [key: string]: TreeData\n")]),t._v("}\ninterface State {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData\n")]),t._v("}\nclass Tree extends React.Component<Props, State> {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData;\n    keyToNodeMap: KeyToNodeMap;\n    constructor(props: Props) {\n        super(props);\n        this.data = props.data;\n        this.state={ data: this.props.data };\n        this.buildKeyMap();\n    }\n    buildKeyMap = () => {\n        let data = this.data;\n        this.keyToNodeMap = {};\n        this.keyToNodeMap[data.key] = data;\n        if (data.children && data.children.length > 0) {\n            this.walk(data.children, data);\n        }\n    }\n    walk = (children: Array<TreeData>, parent: TreeData): void => {\n        children.map((item: TreeData) => {\n            item.parent = parent;\n            this.keyToNodeMap[item.key] = item;\n            if (item.children && item.children.length > 0) {\n                this.walk(item.children, item);\n            }\n        });\n    }\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    onCollapse = async (key: string) => {\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        let data = this.keyToNodeMap[key];\n        if (data) {\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            let { children } = data;\n+            if (!children) {\n+                data.loading = true;\n+                this.setState({ data: this.state.data });\n+                let result = await getChildren(data);\n+                if (result.code == 0) {\n+                    data.children = result.data;\n+                    data.collapsed = false;\n+                    data.loading = false;\n+                    this.buildKeyMap();\n+                    this.setState({ data: this.state.data });\n+                } else {\n+                    alert('加载失败');\n+                }\n+            } else {\n+                data.collapsed = !data.collapsed;\n+                this.setState({ data: this.state.data });\n+            }\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('        }\n    }\n    onCheck = (key: string) => {\n        let data: TreeData = this.keyToNodeMap[key];\n        if (data) {\n            data.checked = !data.checked;\n            if (data.checked) {\n                this.checkChildren(data.children, true);\n                this.checkParentCheckAll(data.parent);\n            } else {\n                this.checkChildren(data.children, false);\n                this.checkParent(data.parent, false);\n            }\n            this.setState({ data: this.state.data });\n        }\n    }\n    checkParentCheckAll = (parent: TreeData) => {\n        while (parent) {\n            parent.checked = parent.children.every(item => item.checked);\n            parent = parent.parent;\n        }\n    }\n    checkParent = (parent: TreeData, checked: boolean) => {\n        while (parent) {\n            parent.checked = checked;\n            parent = parent.parent;\n        }\n    }\n    checkChildren = (children: Array<TreeData> = [], checked: boolean) => {\n        children.forEach((item: TreeData) => {\n            item.checked = checked;\n            this.checkChildren(item.children, checked);\n        });\n    }\n    render() {\n        return (\n            <div className="tree">\n                <div className="tree-nodes">\n                    <TreeNode\n                        data={this.props.data}\n                        onCollapse={this.onCollapse}\n                        onCheck={this.onCheck}\n                    />\n                </div>\n            </div>\n        )\n    }\n')]),t._v("}\nexport default Tree;\n")])])]),a("h3",{attrs:{id:"_7-3-tree-node-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-tree-node-tsx"}},[t._v("#")]),t._v(" 7.3 tree-node.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree-node.tsx")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("import React from 'react';\nimport { TreeData } from '../typings';\nimport file from '../assets/file.png';\nimport closedFolder from '../assets/closed-folder.png';\nimport openedFolder from '../assets/opened-folder.png';\n"),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+import loadingSrc from '../assets/loading.gif';\n")]),t._v("interface Props {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData,\n    onCollapse: any,\n    onCheck: any\n")]),t._v("}\nclass TreeNode extends React.Component<Props> {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    constructor(props: Props) {\n        super(props);\n    }\n    render() {\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        let { data: { name, children, collapsed = false, key, checked = false,loading } } = this.props;\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("        let caret, icon;\n        if (children) {\n            if (children.length > 0) {\n                caret = (\n                    <span className={`collapse ${collapsed ? 'caret-right' : 'caret-down'}`}\n                        onClick={() => this.props.onCollapse(key)}\n                    />\n                )\n                icon = collapsed ? closedFolder : openedFolder;\n            } else {\n                caret = null;\n                icon = file;\n            }\n        } else {\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+            caret = (\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('                loading?<img className="collapse" src={loadingSrc} style={{ width: 14, top: \'50%\', marginTop: -7 }}/>:<span className={`collapse caret-right`}\n                    onClick={() => this.props.onCollapse(key)}\n                />\n            )\n            icon = closedFolder;\n        }\n        return (\n            <div className="tree-node">\n                <div className="inner">\n                    {caret}\n                    <span className="content">\n                        <input type="checkbox" checked={checked} onChange={() => this.props.onCheck(key)} />\n                        <img style={{ width: 20 }} src={icon} />\n                        {name}\n                    </span>\n                </div>\n                {\n                    (children && children.length > 0 && !collapsed) && (\n                        <div className="children">\n                            {\n                                children.map((item: TreeData) => (\n                                    <TreeNode\n                                        onCollapse={this.props.onCollapse}\n                                        onCheck={this.props.onCheck}\n                                        key={item.key}\n                                        data={item} />\n                                ))\n                            }\n                        </div>\n                    )\n                }\n            </div>\n        )\n    }\n')]),t._v("}\nexport default TreeNode;\n")])])]),a("h3",{attrs:{id:"_7-4-src-api-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-src-api-tsx"}},[t._v("#")]),t._v(" 7.4 src\\api.tsx")]),t._v(" "),a("p",[t._v("src\\api.tsx")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" axios "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'axios'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" qs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'qs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\naxios"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("defaults"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baseURL "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:3000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getChildren")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" axios"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/getChildren?")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("qs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_7-5-api-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-5-api-js"}},[t._v("#")]),t._v(" 7.5 api.js")]),t._v(" "),a("p",[t._v("api.js")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" express "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OPTIONS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendStatus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/getChildren'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            code"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'的儿子1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("-1")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'folder'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    collapsed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'的儿子2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("-2")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'folder'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    collapsed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("接口服务器在")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("上启动")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"_8-拖动排序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-拖动排序"}},[t._v("#")]),t._v(" 8. 拖动排序")]),t._v(" "),a("h3",{attrs:{id:"_8-1-components-tree-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-components-tree-tsx"}},[t._v("#")]),t._v(" 8.1 components\\tree.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree.tsx")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("import React from 'react';\nimport './index.less';\nimport { TreeData } from '../typings';\nimport TreeNode from './tree-node';\nimport { getChildren } from '../api';\ninterface Props {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData;\n")]),t._v("}\ninterface KeyToNodeMap {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    [key: string]: TreeData\n")]),t._v("}\ninterface State {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData;\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    fromNode?: TreeData;\n")]),t._v("}\nclass Tree extends React.Component<Props, State> {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData;\n    keyToNodeMap: KeyToNodeMap;\n    constructor(props: Props) {\n        super(props);\n        this.state = { data: this.props.data };\n        this.data = props.data;\n        this.buildKeyMap();\n    }\n    buildKeyMap = () => {\n        let data = this.data;\n        this.keyToNodeMap = {};\n        this.keyToNodeMap[data.key] = data;\n        if (data.children && data.children.length > 0) {\n            this.walk(data.children, data);\n        }\n        this.setState({ data: this.state.data });\n    }\n    walk = (children: Array<TreeData>, parent: TreeData): void => {\n        children.map((item: TreeData) => {\n            item.parent = parent;\n            this.keyToNodeMap[item.key] = item;\n            if (item.children && item.children.length > 0) {\n                this.walk(item.children, item);\n            }\n        });\n    }\n    onCollapse = async (key: string) => {\n        let data = this.keyToNodeMap[key];\n        if (data) {\n            let { children } = data;\n            if (!children) {\n                data.loading = true;\n                this.setState({ data: this.state.data });\n                let result = await getChildren(data);\n                if (result.code == 0) {\n                    data.children = result.data;\n                    data.collapsed = false;\n                    data.loading = false;\n                    this.buildKeyMap();\n                } else {\n                    alert('加载失败');\n                }\n            } else {\n                data.collapsed = !data.collapsed;\n                this.setState({ data: this.state.data });\n            }\n        }\n    }\n    onCheck = (key: string) => {\n        let data: TreeData = this.keyToNodeMap[key];\n        if (data) {\n            data.checked = !data.checked;\n            if (data.checked) {\n                this.checkChildren(data.children, true);\n                this.checkParentCheckAll(data.parent);\n            } else {\n                this.checkChildren(data.children, false);\n                this.checkParent(data.parent, false);\n            }\n            this.setState({ data: this.state.data });\n        }\n    }\n    checkParentCheckAll = (parent: TreeData) => {\n        while (parent) {\n            parent.checked = parent.children.every(item => item.checked);\n            parent = parent.parent;\n        }\n    }\n    checkParent = (parent: TreeData, checked: boolean) => {\n        while (parent) {\n            parent.checked = checked;\n            parent = parent.parent;\n        }\n    }\n    checkChildren = (children: Array<TreeData> = [], checked: boolean) => {\n        children.forEach((item: TreeData) => {\n            item.checked = checked;\n            this.checkChildren(item.children, checked);\n        });\n    }\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    setFromNode = (fromNode: TreeData) => {\n+        this.setState({ ...this.state, fromNode });\n+    }\n+    onMove = (toNode: TreeData) => {\n+        let fromNode = this.state.fromNode;\n+        let fromChildren = fromNode.parent.children, toChildren = toNode.parent.children;\n+        let fromIndex = fromChildren.findIndex((item: TreeData) => item === fromNode);\n+        let toIndex = toChildren.findIndex(item => item === toNode);\n+        fromChildren.splice(fromIndex, 1, toNode);\n+        toChildren.splice(toIndex, 1, fromNode);\n+        this.buildKeyMap();\n+    }\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    render() {\n        return (\n            <div className="tree">\n                <div className="tree-nodes">\n                    <TreeNode\n                        data={this.props.data}\n                        onCollapse={this.onCollapse}\n                        onCheck={this.onCheck}\n')]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                        setFromNode={this.setFromNode}\n+                        onMove={this.onMove}\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                    />\n                </div>\n            </div>\n        )\n    }\n")]),t._v("}\nexport default Tree;\n")])])]),a("h3",{attrs:{id:"_8-2-tree-node-tsx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-tree-node-tsx"}},[t._v("#")]),t._v(" 8.2 tree-node.tsx")]),t._v(" "),a("p",[t._v("src\\components\\tree-node.tsx")]),t._v(" "),a("div",{staticClass:"language-diff extra-class"},[a("pre",{pre:!0,attrs:{class:"language-diff"}},[a("code",[t._v("import React from 'react';\nimport { TreeData } from '../typings';\nimport file from '../assets/file.png';\nimport closedFolder from '../assets/closed-folder.png';\nimport openedFolder from '../assets/opened-folder.png';\nimport loadingSrc from '../assets/loading.gif';\ninterface Props {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    data: TreeData,\n    onCollapse: any,\n    onCheck: any;\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+   setFromNode: any;\n+   onMove: any\n")]),t._v("}\nclass TreeNode extends React.Component<Props> {\n"),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    treeNodeRef: React.RefObject<HTMLDivElement>;\n    constructor(props: Props) {\n        super(props);\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+        this.treeNodeRef = React.createRef();\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("    }\n")]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+    componentDidMount() {\n+        this.treeNodeRef.current.addEventListener('dragstart', (event: DragEvent): void => {\n+            this.props.setFromNode(this.props.data);\n+            event.stopPropagation();\n+        }, false);//useCapture=false\n+        this.treeNodeRef.current.addEventListener('dragenter', (event: DragEvent) => {\n+            event.preventDefault();\n+            event.stopPropagation();\n+        }, false);\n+        this.treeNodeRef.current.addEventListener('dragover', (event: DragEvent) => {\n+            event.preventDefault();\n+            event.stopPropagation();\n+        }, false);\n+        this.treeNodeRef.current.addEventListener('drop', (event: DragEvent) => {\n+            event.preventDefault();\n+            this.props.onMove(this.props.data);\n+            event.stopPropagation();\n+        }, false);\n+    }\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v('    render() {\n        let { data: { name, children, collapsed = false, key, checked = false, loading } } = this.props;\n        let caret, icon;\n        if (children) {\n            if (children.length > 0) {\n                caret = (\n                    <span className={`collapse ${collapsed ? \'caret-right\' : \'caret-down\'}`}\n                        onClick={() => this.props.onCollapse(key)}\n                    />\n                )\n                icon = collapsed ? closedFolder : openedFolder;\n            } else {\n                caret = null;\n                icon = file;\n            }\n        } else {\n            caret = (\n                loading ? <img className="collapse" src={loadingSrc} style={{ width: 14, top: \'50%\', marginTop: -7 }} /> : <span className={`collapse caret-right`}\n                    onClick={() => this.props.onCollapse(key)}\n                />\n            )\n            icon = closedFolder;\n        }\n        return (\n            <div className="tree-node" draggable={true} ref={this.treeNodeRef}>\n                <div className="inner">\n                    {caret}\n                    <span className="content">\n                        <input type="checkbox" checked={checked} onChange={() => this.props.onCheck(key)} />\n                        <img style={{ width: 20 }} src={icon} />\n                        {name}\n                    </span>\n                </div>\n                {\n                    (children && children.length > 0 && !collapsed) && (\n                        <div className="children">\n                            {\n                                children.map((item: TreeData) => (\n                                    <TreeNode\n                                        onCollapse={this.props.onCollapse}\n                                        onCheck={this.props.onCheck}\n                                        key={item.key}\n')]),a("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t._v("+                                        setFromNode={this.props.setFromNode}\n+                                        onMove={this.props.onMove}\n")]),a("span",{pre:!0,attrs:{class:"token unchanged"}},[t._v("                                        data={item} />\n                                ))\n                            }\n                        </div>\n                    )\n                }\n            </div>\n        )\n    }\n")]),t._v("}\nexport default TreeNode;\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);