<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redux saga hand | 珠峰架构</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.1657c744.css" as="style"><link rel="preload" href="/assets/js/app.2af561cb.js" as="script"><link rel="preload" href="/assets/js/2.b2a5c435.js" as="script"><link rel="preload" href="/assets/js/50.0bb20f92.js" as="script"><link rel="prefetch" href="/assets/js/10.2b2c8443.js"><link rel="prefetch" href="/assets/js/11.689524dc.js"><link rel="prefetch" href="/assets/js/12.849e2da9.js"><link rel="prefetch" href="/assets/js/13.c798d95d.js"><link rel="prefetch" href="/assets/js/14.380c4ee7.js"><link rel="prefetch" href="/assets/js/15.d5753b2e.js"><link rel="prefetch" href="/assets/js/16.49eb1f17.js"><link rel="prefetch" href="/assets/js/17.5ecf2b4f.js"><link rel="prefetch" href="/assets/js/18.da9c8265.js"><link rel="prefetch" href="/assets/js/19.59d827ef.js"><link rel="prefetch" href="/assets/js/20.73eb42bb.js"><link rel="prefetch" href="/assets/js/21.8570b5b4.js"><link rel="prefetch" href="/assets/js/22.34094913.js"><link rel="prefetch" href="/assets/js/23.5209939b.js"><link rel="prefetch" href="/assets/js/24.53d92201.js"><link rel="prefetch" href="/assets/js/25.7241adf1.js"><link rel="prefetch" href="/assets/js/26.fecc2611.js"><link rel="prefetch" href="/assets/js/27.e50fca48.js"><link rel="prefetch" href="/assets/js/28.4c168acc.js"><link rel="prefetch" href="/assets/js/29.f5186710.js"><link rel="prefetch" href="/assets/js/3.ba1dcccd.js"><link rel="prefetch" href="/assets/js/30.33cb1c11.js"><link rel="prefetch" href="/assets/js/31.c088791d.js"><link rel="prefetch" href="/assets/js/32.3b724af5.js"><link rel="prefetch" href="/assets/js/33.f975c942.js"><link rel="prefetch" href="/assets/js/34.7d1f4bd2.js"><link rel="prefetch" href="/assets/js/35.26c11750.js"><link rel="prefetch" href="/assets/js/36.e8890e58.js"><link rel="prefetch" href="/assets/js/37.516eba46.js"><link rel="prefetch" href="/assets/js/38.4f8b8525.js"><link rel="prefetch" href="/assets/js/39.26f95568.js"><link rel="prefetch" href="/assets/js/4.fca74266.js"><link rel="prefetch" href="/assets/js/40.b9a8ffbb.js"><link rel="prefetch" href="/assets/js/41.fd02ea5f.js"><link rel="prefetch" href="/assets/js/42.d2483185.js"><link rel="prefetch" href="/assets/js/43.70bff2de.js"><link rel="prefetch" href="/assets/js/44.219702ca.js"><link rel="prefetch" href="/assets/js/45.aba93af9.js"><link rel="prefetch" href="/assets/js/46.447ba87c.js"><link rel="prefetch" href="/assets/js/47.519ddc28.js"><link rel="prefetch" href="/assets/js/48.fd8af347.js"><link rel="prefetch" href="/assets/js/49.b3783fa9.js"><link rel="prefetch" href="/assets/js/5.cc992e8b.js"><link rel="prefetch" href="/assets/js/51.37ba1a59.js"><link rel="prefetch" href="/assets/js/52.054af132.js"><link rel="prefetch" href="/assets/js/53.5aca78a0.js"><link rel="prefetch" href="/assets/js/54.78c43f89.js"><link rel="prefetch" href="/assets/js/55.8ecaadc1.js"><link rel="prefetch" href="/assets/js/56.e844f110.js"><link rel="prefetch" href="/assets/js/57.530db0e9.js"><link rel="prefetch" href="/assets/js/58.8c839289.js"><link rel="prefetch" href="/assets/js/59.6634b409.js"><link rel="prefetch" href="/assets/js/6.b8b36e50.js"><link rel="prefetch" href="/assets/js/60.7ebe5787.js"><link rel="prefetch" href="/assets/js/61.bfe89a8b.js"><link rel="prefetch" href="/assets/js/62.4cdf6e8c.js"><link rel="prefetch" href="/assets/js/63.a0e80f0d.js"><link rel="prefetch" href="/assets/js/64.62a1b782.js"><link rel="prefetch" href="/assets/js/65.7be0994b.js"><link rel="prefetch" href="/assets/js/66.5a592a8e.js"><link rel="prefetch" href="/assets/js/67.40b4291c.js"><link rel="prefetch" href="/assets/js/68.2ac34b58.js"><link rel="prefetch" href="/assets/js/69.728773d5.js"><link rel="prefetch" href="/assets/js/7.0414e914.js"><link rel="prefetch" href="/assets/js/70.30137f66.js"><link rel="prefetch" href="/assets/js/71.7735c9fc.js"><link rel="prefetch" href="/assets/js/72.e9f43339.js"><link rel="prefetch" href="/assets/js/73.2d754e71.js"><link rel="prefetch" href="/assets/js/74.bf70dd09.js"><link rel="prefetch" href="/assets/js/75.18c28356.js"><link rel="prefetch" href="/assets/js/76.a0626bc9.js"><link rel="prefetch" href="/assets/js/77.dfde57e0.js"><link rel="prefetch" href="/assets/js/78.b380a0d6.js"><link rel="prefetch" href="/assets/js/79.f7bafb5d.js"><link rel="prefetch" href="/assets/js/8.c3544379.js"><link rel="prefetch" href="/assets/js/80.ade6c33e.js"><link rel="prefetch" href="/assets/js/81.6335ba85.js"><link rel="prefetch" href="/assets/js/82.9d01c14e.js"><link rel="prefetch" href="/assets/js/83.47911fdd.js"><link rel="prefetch" href="/assets/js/9.844fca3b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1657c744.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">珠峰架构</span></a> <div class="links"><!----> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/react/" class="sidebar-heading clickable router-link-active open"><span>react</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/basic/" class="sidebar-heading clickable"><span>基础</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/fiber/" class="sidebar-heading clickable"><span>Fiber</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/router/" class="sidebar-heading clickable"><span>react router</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/redux/" class="sidebar-heading clickable router-link-active open"><span>redux</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/redux/手写Redux.html" class="sidebar-link">手写Redux</a></li><li><a href="/react/redux/Redux中间件.html" class="sidebar-link">Redux中间件</a></li><li><a href="/react/redux/Redux-hooks.html" class="sidebar-link">Redux-hooks</a></li><li><a href="/react/redux/Redux-saga.html" class="sidebar-link">Redux Saga</a></li><li><a href="/react/redux/Redux-saga-hand.html" class="active sidebar-link">Redux saga hand</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_1-redux-saga" class="sidebar-link">1. redux-saga</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_2-redux-saga工作原理" class="sidebar-link">2. redux-saga工作原理</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_3-redux-saga分类" class="sidebar-link">3. redux-saga分类</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_4-计数器" class="sidebar-link">4. 计数器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_4-1-index-js" class="sidebar-link">4.1 index.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_4-2-sagas-js" class="sidebar-link">4.2 sagas.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_4-3-counter-js" class="sidebar-link">4.3 Counter.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_4-4-index-js" class="sidebar-link">4.4 index.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_4-5-actions-js" class="sidebar-link">4.5 actions.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_4-6-action-types-js" class="sidebar-link">4.6 action-types.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_4-7-reducer-js" class="sidebar-link">4.7 reducer.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_5-实现take" class="sidebar-link">5. 实现take</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_5-1-index-js" class="sidebar-link">5.1 index.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_5-2-effects-js" class="sidebar-link">5.2 effects.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_6-支持产出terator" class="sidebar-link">6.支持产出terator</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_6-1-symbol-iterator" class="sidebar-link">6.1 Symbol.iterator</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_6-2-saga-js" class="sidebar-link">6.2 saga.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_6-2-redux-saga-index-js" class="sidebar-link">6.2 redux-saga/index.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_7-支持takeevery" class="sidebar-link">7. 支持takeEvery</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_7-1-saga-js" class="sidebar-link">7.1 saga.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_7-2-effects-js" class="sidebar-link">7.2 effects.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_7-3-redux-saga-index-js" class="sidebar-link">7.3 redux-saga/index.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_8-支持promise" class="sidebar-link">8. 支持promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_8-1-saga-js" class="sidebar-link">8.1 saga.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_8-2-redux-saga-index-js" class="sidebar-link">8.2 redux-saga/index.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_9-支持-call" class="sidebar-link">9. 支持 call</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_9-1-sagas-js" class="sidebar-link">9.1 sagas.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_9-2-effects-js" class="sidebar-link">9.2 effects.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_9-3-saga-js" class="sidebar-link">9.3 saga.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_10-支持-delay" class="sidebar-link">10. 支持 delay</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_10-1-sagas-js" class="sidebar-link">10.1 sagas.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_10-2-effects-js" class="sidebar-link">10.2 effects.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_11-支持-cps" class="sidebar-link">11. 支持 cps</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_11-1-sagas-js" class="sidebar-link">11.1 sagas.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_11-2-effects-js" class="sidebar-link">11.2 effects.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_11-3-saga-js" class="sidebar-link">11.3 saga.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_12-支持all" class="sidebar-link">12. 支持all</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_12-1-saga" class="sidebar-link">12.1 saga</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_12-2-effects" class="sidebar-link">12.2 effects</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_12-3-redux-saga-index-js" class="sidebar-link">12.3 redux-saga/index.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_13-取消任务" class="sidebar-link">13. 取消任务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_13-1-saga" class="sidebar-link">13.1 saga</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_13-2-counter-js" class="sidebar-link">13.2 Counter.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_13-3-effects-js" class="sidebar-link">13.3 effects.js</a></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_13-4-index-js" class="sidebar-link">13.4 index.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux/Redux-saga-hand.html#_14-资源" class="sidebar-link">14. 资源</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/ssr/" class="sidebar-heading clickable"><span>SSR</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/nextjs/" class="sidebar-heading clickable"><span>nextjs</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/dva/" class="sidebar-heading clickable"><span>dva</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/umi/" class="sidebar-heading clickable"><span>umi</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/component/" class="sidebar-heading clickable"><span>组件</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/interview/" class="sidebar-heading clickable"><span>面试</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vue/" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/webpack/" class="sidebar-heading clickable"><span>webpack</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/flutter/" class="sidebar-heading clickable"><span>flutter</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/interview/" class="sidebar-heading clickable"><span>interview</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/other/" class="sidebar-heading clickable"><span>other</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redux-saga-hand"><a href="#redux-saga-hand" class="header-anchor">#</a> Redux saga hand</h1> <h2 id="_1-redux-saga"><a href="#_1-redux-saga" class="header-anchor">#</a> 1. redux-saga</h2> <ul><li><a href="https://redux-saga-in-chinese.js.org/" target="_blank" rel="noopener noreferrer">redux-saga<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个 redux 的中间件，而中间件的作用是为 redux 提供额外的功能。</li> <li>在 reducers 中的所有操作都是同步的并且是纯粹的，即 reducer 都是纯函数，纯函数是指一个函数的返回结果只依赖于它的参数，并且在执行过程中不会对外部产生副作用，即给它传什么，就吐出什么。</li> <li>但是在实际的应用开发中，我们希望做一些异步的（如Ajax请求）且不纯粹的操作（如改变外部的状态），这些在函数式编程范式中被称为“副作用”。</li></ul> <blockquote><p>redux-saga 就是用来处理上述副作用（异步任务）的一个中间件。它是一个接收事件，并可能触发新事件的过程管理者，为你的应用管理复杂的流程。</p></blockquote> <h2 id="_2-redux-saga工作原理"><a href="#_2-redux-saga工作原理" class="header-anchor">#</a> 2. redux-saga工作原理</h2> <ul><li>sages 采用 Generator 函数来 yield Effects（包含指令的文本对象）</li> <li>Generator 函数的作用是可以暂停执行，再次执行的时候从上次暂停的地方继续执行</li> <li>Effect 是一个简单的对象，该对象包含了一些给 middleware 解释执行的信息。</li> <li>你可以通过使用 effects API 如 fork，call，take，put，cancel 等来创建 Effect。</li></ul> <h2 id="_3-redux-saga分类"><a href="#_3-redux-saga分类" class="header-anchor">#</a> 3. redux-saga分类</h2> <ul><li>worker saga 做左右的工作，如调用API，进行异步请求，获取异步封装结果</li> <li>watcher saga 监听被dispatch的actions,当接受到action或者知道其被触发时，调用worker执行任务</li> <li>root saga 立即启动saga的唯一入口</li></ul> <h2 id="_4-计数器"><a href="#_4-计数器" class="header-anchor">#</a> 4. 计数器</h2> <h3 id="_4-1-index-js"><a href="#_4-1-index-js" class="header-anchor">#</a> 4.1 index.js</h3> <p>src/index.js</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'./components/Counter'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-2-sagas-js"><a href="#_4-2-sagas-js" class="header-anchor">#</a> 4.2 sagas.js</h3> <p>src/sagas.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>put<span class="token punctuation">,</span>take<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-saga/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> types <span class="token keyword">from</span> <span class="token string">'./store/action-types'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">INCREMENT_ASYNC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span>types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'已经达到最大值'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-3-counter-js"><a href="#_4-3-counter-js" class="header-anchor">#</a> 4.3 Counter.js</h3> <p>src/components/Counter.js</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">'../store/action'</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>number<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>increment<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
    <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">,</span>
    actions
<span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-4-index-js"><a href="#_4-4-index-js" class="header-anchor">#</a> 4.4 index.js</h3> <p>src/store/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">,</span> applyMiddleware<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createSagaMiddleware <span class="token keyword">from</span> <span class="token string">'redux-saga'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>rootSaga<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../saga'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> sagaMiddleware<span class="token operator">=</span><span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> store<span class="token operator">=</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>sagaMiddleware<span class="token punctuation">)</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
sagaMiddleware<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>rootSaga<span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>store<span class="token operator">=</span>store<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-5-actions-js"><a href="#_4-5-actions-js" class="header-anchor">#</a> 4.5 actions.js</h3> <p>src/store/actions.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> types <span class="token keyword">from</span> <span class="token string">'./action-types'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>type<span class="token operator">:</span>types<span class="token punctuation">.</span><span class="token constant">INCREMENT_ASYNC</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-6-action-types-js"><a href="#_4-6-action-types-js" class="header-anchor">#</a> 4.6 action-types.js</h3> <p>src/store/action-types.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">INCREMENT_ASYNC</span><span class="token operator">=</span><span class="token string">'INCREMENT_ASYNC'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">INCREMENT</span><span class="token operator">=</span><span class="token string">'INCREMENT'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-7-reducer-js"><a href="#_4-7-reducer-js" class="header-anchor">#</a> 4.7 reducer.js</h3> <p>rc/store/reducer.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> types <span class="token keyword">from</span> <span class="token string">'./action-types'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token punctuation">{</span>number<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span> types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>number<span class="token operator">:</span> state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-实现take"><a href="#_5-实现take" class="header-anchor">#</a> 5. 实现take</h2> <ul><li><p>runSaga.js</p> <h3 id="_5-1-index-js"><a href="#_5-1-index-js" class="header-anchor">#</a> 5.1 index.js</h3> <p>redux-saga/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> listener<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">function</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">actionType<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          listener<span class="token punctuation">[</span>actionType<span class="token punctuation">]</span><span class="token operator">=</span>cb<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">function</span> <span class="token function">publish</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>listener<span class="token punctuation">[</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> temp<span class="token operator">=</span>listener<span class="token punctuation">[</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token keyword">delete</span> listener<span class="token punctuation">[</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token function">temp</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>subscribe<span class="token punctuation">,</span>publish<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> channel<span class="token operator">=</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">sagaMiddleware</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>getState<span class="token punctuation">,</span>dispatch<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">generator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> it<span class="token operator">=</span><span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> <span class="token punctuation">{</span>value<span class="token operator">:</span>effect<span class="token punctuation">,</span>done<span class="token punctuation">}</span> <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">switch</span> <span class="token punctuation">(</span>effect<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">case</span> <span class="token string">'TAKE'</span><span class="token operator">:</span>
                          channel<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>actionType<span class="token punctuation">,</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
                          <span class="token keyword">break</span><span class="token punctuation">;</span>
                      <span class="token keyword">case</span> <span class="token string">'PUT'</span><span class="token operator">:</span>
                          <span class="token function">dispatch</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
                          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                          <span class="token keyword">break</span><span class="token punctuation">;</span>
                      <span class="token keyword">default</span><span class="token operator">:</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      sagaMiddleware<span class="token punctuation">.</span>run<span class="token operator">=</span>run<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              channel<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> sagaMiddleware<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_5-2-effects-js"><a href="#_5-2-effects-js" class="header-anchor">#</a> 5.2 effects.js</h3> <p>src\redux-saga\effects.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token parameter">actionType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span><span class="token string">'take'</span><span class="token punctuation">,</span>
        actionType
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'put'</span><span class="token punctuation">,</span>
        action
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-支持产出terator"><a href="#_6-支持产出terator" class="header-anchor">#</a> 6.支持产出terator</h2> <h3 id="_6-1-symbol-iterator"><a href="#_6-1-symbol-iterator" class="header-anchor">#</a> 6.1 Symbol.iterator</h3> <p>遍历器（Iterator）就是这样一种机制。它是一种接口，为各种不同的数据结构提供统一的访问机制。任何数据结构只要部署 Iterator 接口，就可以完成遍历操作（即依次处理该数据结构的所有成员）。 Iterator 的作用有三个：</p> <ul><li>一是为各种数据结构，提供一个统一的、简便的访问接口</li> <li>二是使得数据结构的成员能够按某种次序排列</li> <li>三是 ES6 创造了一种新的遍历命令for...of循环，Iterator 接口主要供for...of消费</li></ul> <p>原生具备 Iterator 接口的数据结构如下。</p> <ul><li>Array</li> <li>Map</li> <li>Set</li> <li>String</li> <li>TypedArray</li> <li>函数的 arguments 对象</li> <li>NodeList 对象</li></ul> <h4 id="_6-1-1-arr"><a href="#_6-1-1-arr" class="header-anchor">#</a> 6.1.1 arr</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> iterator <span class="token operator">=</span> arr<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: 1, done: false }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: 2, done: false }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: undefined, done: true }</span>
</code></pre></div><h4 id="_6-1-2-对象"><a href="#_6-1-2-对象" class="header-anchor">#</a> 6.1.2 对象</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'zhufeng'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> values <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span>value<span class="token operator">:</span>values<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span>done<span class="token operator">:</span>index<span class="token operator">&gt;</span>values<span class="token punctuation">.</span>length<span class="token operator">?</span><span class="token boolean">true</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> iterator <span class="token operator">=</span> obj<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: 1, done: false }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: 2, done: false }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: undefined, done: true }</span>
</code></pre></div><h3 id="_6-2-saga-js"><a href="#_6-2-saga-js" class="header-anchor">#</a> 6.2 saga.js</h3> <div class="language-diff extra-class"><pre class="language-diff"><code>import {put,take} from '../redux-saga/effects';
import * as types from './action-types';

<span class="token inserted-sign inserted">+export function* increment() {
+    yield put({type:types.INCREMENT});
+}
</span>
export function* rootSaga() {
<span class="token unchanged">    for (let i=0;i&lt;3;i++){
        yield take(types.INCREMENT_ASYNC);
</span><span class="token inserted-sign inserted">+        yield increment();
</span><span class="token unchanged">    }
    console.log('已经达到最大值');
</span>}
</code></pre></div><h3 id="_6-2-redux-saga-index-js"><a href="#_6-2-redux-saga-index-js" class="header-anchor">#</a> 6.2 redux-saga/index.js</h3> <div class="language-diff extra-class"><pre class="language-diff"><code>export default function createSagaMiddleware() {
<span class="token unchanged">    function createChannel() {
        let listener={};
        function subscribe(actionType,cb) {
            listener[actionType]=cb;
        }
        function publish(action) {
            if (listener[action.type]) {
                let temp=listener[action.type];
                delete listener[action.type];
                temp(action);
            }
        }
        return {subscribe,publish};
    }
    let channel=createChannel();
    function sagaMiddleware({getState,dispatch}) {
        function run(generator) {
</span><span class="token inserted-sign inserted">+            let it= typeof generator == 'function'? generator():generator;
</span><span class="token unchanged">            function next(action) {
                let {value:effect,done} = it.next(action);
                if (!done) {
</span><span class="token inserted-sign inserted">+                    if (typeof effect[Symbol.iterator]=='function') {
+                        run(effect);
+                        next();
+                    } else {
</span><span class="token unchanged">                        switch (effect.type) {
                            case 'TAKE':
                                channel.subscribe(effect.actionType,next);
                                break;
                            case 'PUT':
                                dispatch(effect.action);
                                next();
                                break;
                            default:
                        }
                    }
                }
            }
            next();
        }
        sagaMiddleware.run=run;
        return function (next) {
            return function (action) {
                channel.publish(action);
                next(action);
            }
        }
    }
    return sagaMiddleware;
</span>}
</code></pre></div><h2 id="_7-支持takeevery"><a href="#_7-支持takeevery" class="header-anchor">#</a> 7. 支持takeEvery</h2> <ul><li>一个 task 就像是一个在后台运行的进程，在基于redux-saga的应用程序中，可以同时运行多个task</li> <li>通过 fork 函数来创建 task</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>otherSaga<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>
</code></pre></div><h3 id="_7-1-saga-js"><a href="#_7-1-saga-js" class="header-anchor">#</a> 7.1 saga.js</h3> <div class="language-diff extra-class"><pre class="language-diff"><code>import {put,takeEvery} from '../redux-saga/effects';
import * as types from './action-types';
export function* increment() {
<span class="token unchanged">    yield put({type:types.INCREMENT});
</span>}

export function* rootSaga() {
<span class="token inserted-sign inserted">+    yield takeEvery(types.INCREMENT_ASYNC,increment);
</span>}
</code></pre></div><h3 id="_7-2-effects-js"><a href="#_7-2-effects-js" class="header-anchor">#</a> 7.2 effects.js</h3> <p>src\redux-saga\effects.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token parameter">actionType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span><span class="token string">'TAKE'</span><span class="token punctuation">,</span>
        actionType
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'PUT'</span><span class="token punctuation">,</span>
        action
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'FORK'</span><span class="token punctuation">,</span>
        task
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token parameter">actionType<span class="token punctuation">,</span>task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>actionType<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">yield</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-3-redux-saga-index-js"><a href="#_7-3-redux-saga-index-js" class="header-anchor">#</a> 7.3 redux-saga/index.js</h3> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged">                        switch (effect.type) {
                            case 'TAKE':
                                channel.subscribe(effect.actionType,next);
                                break;
                            case 'PUT':
                                dispatch(effect.action);
                                next();
                                break;
</span><span class="token inserted-sign inserted">+                            case 'FORK':
+                                run(effect.task);
+                                next();    
+                                break;
</span><span class="token unchanged">                            default:
                                break;
                        }
</span></code></pre></div><h2 id="_8-支持promise"><a href="#_8-支持promise" class="header-anchor">#</a> 8. 支持promise</h2> <h3 id="_8-1-saga-js"><a href="#_8-1-saga-js" class="header-anchor">#</a> 8.1 saga.js</h3> <div class="language-diff extra-class"><pre class="language-diff"><code>import {put,takeEvery} from '../redux-saga/effects';
import * as types from './action-types';
<span class="token inserted-sign inserted">+const delay=ms =&gt; new Promise((resolve,reject) =&gt; {
+    setTimeout(() =&gt; {
+        resolve();
+    },ms);
+});
</span>export function* increment() {
<span class="token inserted-sign inserted">+    yield delay(1000);
</span><span class="token unchanged">    yield put({type:types.INCREMENT});
</span>}

export function* rootSaga() {
<span class="token unchanged">    yield takeEvery(types.INCREMENT_ASYNC,increment);
</span>}
</code></pre></div><h3 id="_8-2-redux-saga-index-js"><a href="#_8-2-redux-saga-index-js" class="header-anchor">#</a> 8.2 redux-saga/index.js</h3> <div class="language-diff extra-class"><pre class="language-diff"><code>function next(action) {
<span class="token unchanged">                let {value:effect,done} = it.next(action);
                if (!done) {
                    if (typeof effect[Symbol.iterator]=='function') {
                        run(effect);
                        next();
</span><span class="token inserted-sign inserted">+                    } else if(effect.then){
+                        effect.then(next);
+                    }else {
</span><span class="token unchanged">                        switch (effect.type) {
                            case 'TAKE':
                                channel.subscribe(effect.actionType,next);
                                break;
</span></code></pre></div><h2 id="_9-支持-call"><a href="#_9-支持-call" class="header-anchor">#</a> 9. 支持 call</h2> <h3 id="_9-1-sagas-js"><a href="#_9-1-sagas-js" class="header-anchor">#</a> 9.1 sagas.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//yield delay(1000);</span>
    <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>delay<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span>types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-2-effects-js"><a href="#_9-2-effects-js" class="header-anchor">#</a> 9.2 effects.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'CALL'</span><span class="token punctuation">,</span>
        fn<span class="token punctuation">,</span>
        args
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-3-saga-js"><a href="#_9-3-saga-js" class="header-anchor">#</a> 9.3 saga.js</h3> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">case</span> <span class="token string">'CALL'</span><span class="token operator">:</span>
        effect<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>effect<span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_10-支持-delay"><a href="#_10-支持-delay" class="header-anchor">#</a> 10. 支持 delay</h2> <h3 id="_10-1-sagas-js"><a href="#_10-1-sagas-js" class="header-anchor">#</a> 10.1 sagas.js</h3> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted">+import {put,takeEvery,delay} from '../redux-saga/effects';
</span>import * as types from './action-types';

export function* increment() {
<span class="token inserted-sign inserted">+    yield delay(1000);
</span><span class="token unchanged">    yield put({type:types.INCREMENT});
</span>}

export function* rootSaga() {
<span class="token unchanged">    yield takeEvery(types.INCREMENT_ASYNC,increment);
</span>}
</code></pre></div><h3 id="_10-2-effects-js"><a href="#_10-2-effects-js" class="header-anchor">#</a> 10.2 effects.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">innerDelay</span><span class="token operator">=</span><span class="token parameter">ms</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">call</span><span class="token punctuation">(</span>innerDelay<span class="token punctuation">,</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_11-支持-cps"><a href="#_11-支持-cps" class="header-anchor">#</a> 11. 支持 cps</h2> <h3 id="_11-1-sagas-js"><a href="#_11-1-sagas-js" class="header-anchor">#</a> 11.1 sagas.js</h3> <div class="language-diff extra-class"><pre class="language-diff"><code>import {put,takeEvery,call,cps} from '../redux-saga/effects';
import * as types from './action-types';

<span class="token inserted-sign inserted">+const delay = (ms,callback)=&gt;{
+    setTimeout(() =&gt; {
+        callback('ok');
+    },ms);
+}
</span>
<span class="token inserted-sign inserted">+export function* increment() {
+    let data = yield cps(delay,1000);
+    console.log(data);
+    yield put({type:types.INCREMENT});
+}
</span>
export function* rootSaga() {
<span class="token unchanged">    yield takeEvery(types.INCREMENT_ASYNC,increment);
</span>}
</code></pre></div><h3 id="_11-2-effects-js"><a href="#_11-2-effects-js" class="header-anchor">#</a> 11.2 effects.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">cps</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'CPS'</span><span class="token punctuation">,</span>
        fn<span class="token punctuation">,</span>
        args
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_11-3-saga-js"><a href="#_11-3-saga-js" class="header-anchor">#</a> 11.3 saga.js</h3> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">case</span> <span class="token string">'CALL'</span><span class="token operator">:</span>
        effect<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>effect<span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token operator">+</span>    <span class="token keyword">case</span> <span class="token string">'CPS'</span><span class="token operator">:</span>
<span class="token operator">+</span>        effect<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>effect<span class="token punctuation">.</span>args<span class="token punctuation">,</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_12-支持all"><a href="#_12-支持all" class="header-anchor">#</a> 12. 支持all</h2> <h3 id="_12-1-saga"><a href="#_12-1-saga" class="header-anchor">#</a> 12.1 saga</h3> <p>src\store\saga.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>put<span class="token punctuation">,</span>takeEvery<span class="token punctuation">,</span>delay<span class="token punctuation">,</span>all<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../redux-saga/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> types <span class="token keyword">from</span> <span class="token string">'./action-types'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span>types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">incrementWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">INCREMENT_ASYNC</span><span class="token punctuation">,</span>increment<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'action'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">loggerWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">INCREMENT_ASYNC</span><span class="token punctuation">,</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">incrementWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">loggerWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_12-2-effects"><a href="#_12-2-effects" class="header-anchor">#</a> 12.2 effects</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token parameter">fns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'ALL'</span><span class="token punctuation">,</span>
        fns
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_12-3-redux-saga-index-js"><a href="#_12-3-redux-saga-index-js" class="header-anchor">#</a> 12.3 redux-saga/index.js</h3> <div class="language-diff extra-class"><pre class="language-diff"><code>export default function createSagaMiddleware() {
<span class="token unchanged">    function createChannel() {
        let listener={};
        function subscribe(actionType,cb) {
            listener[actionType]=cb;
        }
        function publish(action) {
            if (listener[action.type]) {
                let temp=listener[action.type];
                delete listener[action.type];
                temp(action);
            }
        }
        return {subscribe,publish};
    }
    let channel=createChannel();
</span><span class="token inserted-sign inserted">+    function times(cb,total) {
+        let count=0;
+        return function () {
+            if (++count === total) {
+                cb();
+            }
+        }
+    }
</span><span class="token unchanged">    function sagaMiddleware({getState,dispatch}) {
</span><span class="token inserted-sign inserted">+        function run(generator,callback) {
</span><span class="token unchanged">            let it= typeof generator == 'function'? generator():generator;
            function next(action) {
                let {value:effect,done} = it.next(action);
                if (!done) {
                    if (typeof effect[Symbol.iterator]=='function') {
                        run(effect);
                        next();
                    } else if(effect.then){
                        effect.then(next);
                    }else {
                        switch (effect.type) {
                            case 'TAKE':
                                channel.subscribe(effect.actionType,next);
                                break;
                            case 'PUT':
                                dispatch(effect.action);
                                next();
                                break;
                            case 'FORK':
                                run(effect.task);
                                next();    
                                break;
                            case 'CALL':
                                effect.fn(...effect.args).then(next);    
                                break;
</span><span class="token inserted-sign inserted">+                            case 'ALL':
+                                let fns=effect.fns;
+                                let done=times(next,fns.length);
+                                for (let i=0;i&lt;fns.length;i++){
+                                    let fn=fns[i];
+                                    run(fn,done);
+                                }
+                                break;    
</span><span class="token unchanged">                            case 'CPS':
                                effect.fn(...effect.args,next);
                                break;
                            default:
                                break;
                        }
                    }
</span><span class="token inserted-sign inserted">+                } else {
+                    callback&amp;&amp;callback();
+                }
</span><span class="token unchanged">            }
            next();
        }
        sagaMiddleware.run=run;
        return function (next) {
            return function (action) {
                channel.publish(action);
                next(action);
            }
        }
    }
    return sagaMiddleware;
</span>}
</code></pre></div><h2 id="_13-取消任务"><a href="#_13-取消任务" class="header-anchor">#</a> 13. 取消任务</h2> <h3 id="_13-1-saga"><a href="#_13-1-saga" class="header-anchor">#</a> 13.1 saga</h3> <p>src\store\saga.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>put<span class="token punctuation">,</span>take<span class="token punctuation">,</span>delay<span class="token punctuation">,</span>all<span class="token punctuation">,</span>fork<span class="token punctuation">,</span>cancel<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../redux-saga/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> types <span class="token keyword">from</span> <span class="token string">'./action-types'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">yield</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span>types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">incrementWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>increment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">STOP_INCREMENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">incrementWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_13-2-counter-js"><a href="#_13-2-counter-js" class="header-anchor">#</a> 13.2 Counter.js</h3> <p>src\components\Counter.js</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">'../store/action'</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>number<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>increment<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>stop<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">stop</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
    <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">,</span>
    actions
<span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_13-3-effects-js"><a href="#_13-3-effects-js" class="header-anchor">#</a> 13.3 effects.js</h3> <p>src\redux-saga\effects.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'CANCEL'</span><span class="token punctuation">,</span>
        task
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_13-4-index-js"><a href="#_13-4-index-js" class="header-anchor">#</a> 13.4 index.js</h3> <p>src\redux-saga\index.js</p> <div class="language-diff extra-class"><pre class="language-diff"><code>function sagaMiddleware({getState,dispatch}) {
<span class="token unchanged">        function run(generator,callback) {
            let it= typeof generator == 'function'? generator():generator;
            function next(action) {
                let {value:effect,done} = it.next(action);
                if (!done) {
                    if (typeof effect[Symbol.iterator]=='function') {
                        run(effect);
                        next();
                    } else if(effect.then){
                        effect.then(next);
                    }else {
                        switch (effect.type) {
                            case 'TAKE':
                                channel.subscribe(effect.actionType,next);
                                break;
                            case 'PUT':
                                dispatch(effect.action);
                                next();
                                break;
</span><span class="token inserted-sign inserted">+                            case 'FORK':
+                                let newTask = effect.task();
+                                run(newTask);
+                                next(newTask);
+                                break;
</span><span class="token unchanged">                            case 'CALL':
                                effect.fn(...effect.args).then(next);    
                                break;
                            case 'ALL':
                                let fns=effect.fns;
                                let done=times(next,fns.length);
                                for (let i=0;i&lt;fns.length;i++){
                                    let fn=fns[i];
                                    run(fn,done);
                                }
                                break;    
                            case 'CPS':
                                effect.fn(...effect.args,next);
                                break;
</span><span class="token inserted-sign inserted">+                            case 'CANCEL':
+                                effect.task.return('over');    
+                                break;
</span><span class="token unchanged">                            default:
                                break;
                        }
                    }
                } else {
                    callback&amp;&amp;callback();
                }
            }
            next();
        }
        sagaMiddleware.run=run;
        return function (next) {
            return function (action) {
                channel.publish(action);
                next(action);
            }
        }
    }
</span></code></pre></div><h2 id="_14-资源"><a href="#_14-资源" class="header-anchor">#</a> 14. 资源</h2> <ul><li><a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank" rel="noopener noreferrer">redux-devtools-extension<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/reactjs/react-router-redux" target="_blank" rel="noopener noreferrer">react-router-redux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/redux-saga/redux-saga" target="_blank" rel="noopener noreferrer">redux-saga<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://gitee.com/zhufengpeixun/zhufeng-redux-saga2" target="_blank" rel="noopener noreferrer">zhufeng-redux-saga2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://gitee.com/zhufengpeixun/zhufeng-saga2" target="_blank" rel="noopener noreferrer">zhufeng-saga2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">4/21/2020, 10:47:40 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/redux/Redux-saga.html" class="prev">
        Redux Saga
      </a></span> <span class="next"><a href="/react/ssr/ssr.html">
        React SSR
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2af561cb.js" defer></script><script src="/assets/js/2.b2a5c435.js" defer></script><script src="/assets/js/50.0bb20f92.js" defer></script>
  </body>
</html>
