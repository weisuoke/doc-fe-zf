<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>02. Webpack optimize | 珠峰架构</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.1657c744.css" as="style"><link rel="preload" href="/assets/js/app.2af561cb.js" as="script"><link rel="preload" href="/assets/js/2.b2a5c435.js" as="script"><link rel="preload" href="/assets/js/73.2d754e71.js" as="script"><link rel="prefetch" href="/assets/js/10.2b2c8443.js"><link rel="prefetch" href="/assets/js/11.689524dc.js"><link rel="prefetch" href="/assets/js/12.849e2da9.js"><link rel="prefetch" href="/assets/js/13.c798d95d.js"><link rel="prefetch" href="/assets/js/14.380c4ee7.js"><link rel="prefetch" href="/assets/js/15.d5753b2e.js"><link rel="prefetch" href="/assets/js/16.49eb1f17.js"><link rel="prefetch" href="/assets/js/17.5ecf2b4f.js"><link rel="prefetch" href="/assets/js/18.da9c8265.js"><link rel="prefetch" href="/assets/js/19.59d827ef.js"><link rel="prefetch" href="/assets/js/20.73eb42bb.js"><link rel="prefetch" href="/assets/js/21.8570b5b4.js"><link rel="prefetch" href="/assets/js/22.34094913.js"><link rel="prefetch" href="/assets/js/23.5209939b.js"><link rel="prefetch" href="/assets/js/24.53d92201.js"><link rel="prefetch" href="/assets/js/25.7241adf1.js"><link rel="prefetch" href="/assets/js/26.fecc2611.js"><link rel="prefetch" href="/assets/js/27.e50fca48.js"><link rel="prefetch" href="/assets/js/28.4c168acc.js"><link rel="prefetch" href="/assets/js/29.f5186710.js"><link rel="prefetch" href="/assets/js/3.ba1dcccd.js"><link rel="prefetch" href="/assets/js/30.33cb1c11.js"><link rel="prefetch" href="/assets/js/31.c088791d.js"><link rel="prefetch" href="/assets/js/32.3b724af5.js"><link rel="prefetch" href="/assets/js/33.f975c942.js"><link rel="prefetch" href="/assets/js/34.7d1f4bd2.js"><link rel="prefetch" href="/assets/js/35.26c11750.js"><link rel="prefetch" href="/assets/js/36.e8890e58.js"><link rel="prefetch" href="/assets/js/37.516eba46.js"><link rel="prefetch" href="/assets/js/38.4f8b8525.js"><link rel="prefetch" href="/assets/js/39.26f95568.js"><link rel="prefetch" href="/assets/js/4.fca74266.js"><link rel="prefetch" href="/assets/js/40.b9a8ffbb.js"><link rel="prefetch" href="/assets/js/41.fd02ea5f.js"><link rel="prefetch" href="/assets/js/42.d2483185.js"><link rel="prefetch" href="/assets/js/43.70bff2de.js"><link rel="prefetch" href="/assets/js/44.219702ca.js"><link rel="prefetch" href="/assets/js/45.aba93af9.js"><link rel="prefetch" href="/assets/js/46.447ba87c.js"><link rel="prefetch" href="/assets/js/47.519ddc28.js"><link rel="prefetch" href="/assets/js/48.fd8af347.js"><link rel="prefetch" href="/assets/js/49.b3783fa9.js"><link rel="prefetch" href="/assets/js/5.cc992e8b.js"><link rel="prefetch" href="/assets/js/50.0bb20f92.js"><link rel="prefetch" href="/assets/js/51.37ba1a59.js"><link rel="prefetch" href="/assets/js/52.054af132.js"><link rel="prefetch" href="/assets/js/53.5aca78a0.js"><link rel="prefetch" href="/assets/js/54.78c43f89.js"><link rel="prefetch" href="/assets/js/55.8ecaadc1.js"><link rel="prefetch" href="/assets/js/56.e844f110.js"><link rel="prefetch" href="/assets/js/57.530db0e9.js"><link rel="prefetch" href="/assets/js/58.8c839289.js"><link rel="prefetch" href="/assets/js/59.6634b409.js"><link rel="prefetch" href="/assets/js/6.b8b36e50.js"><link rel="prefetch" href="/assets/js/60.7ebe5787.js"><link rel="prefetch" href="/assets/js/61.bfe89a8b.js"><link rel="prefetch" href="/assets/js/62.4cdf6e8c.js"><link rel="prefetch" href="/assets/js/63.a0e80f0d.js"><link rel="prefetch" href="/assets/js/64.62a1b782.js"><link rel="prefetch" href="/assets/js/65.7be0994b.js"><link rel="prefetch" href="/assets/js/66.5a592a8e.js"><link rel="prefetch" href="/assets/js/67.40b4291c.js"><link rel="prefetch" href="/assets/js/68.2ac34b58.js"><link rel="prefetch" href="/assets/js/69.728773d5.js"><link rel="prefetch" href="/assets/js/7.0414e914.js"><link rel="prefetch" href="/assets/js/70.30137f66.js"><link rel="prefetch" href="/assets/js/71.7735c9fc.js"><link rel="prefetch" href="/assets/js/72.e9f43339.js"><link rel="prefetch" href="/assets/js/74.bf70dd09.js"><link rel="prefetch" href="/assets/js/75.18c28356.js"><link rel="prefetch" href="/assets/js/76.a0626bc9.js"><link rel="prefetch" href="/assets/js/77.dfde57e0.js"><link rel="prefetch" href="/assets/js/78.b380a0d6.js"><link rel="prefetch" href="/assets/js/79.f7bafb5d.js"><link rel="prefetch" href="/assets/js/8.c3544379.js"><link rel="prefetch" href="/assets/js/80.ade6c33e.js"><link rel="prefetch" href="/assets/js/81.6335ba85.js"><link rel="prefetch" href="/assets/js/82.9d01c14e.js"><link rel="prefetch" href="/assets/js/83.47911fdd.js"><link rel="prefetch" href="/assets/js/9.844fca3b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1657c744.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">珠峰架构</span></a> <div class="links"><!----> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/react/" class="sidebar-heading clickable"><span>react</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vue/" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/webpack/" class="sidebar-heading clickable router-link-active open"><span>webpack</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/webpack/2020/" class="sidebar-heading clickable"><span>2020版</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/webpack/backup/" class="sidebar-heading clickable router-link-active open"><span>备份</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/webpack/backup/01-webpack-basic.html" class="sidebar-link">01 Webpack基础</a></li><li><a href="/webpack/backup/02-webpack-optimize.html" class="active sidebar-link">02. Webpack optimize</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/backup/02-webpack-optimize.html#_1-purgecss-webpack-plugin" class="sidebar-link">1. purgecss-webpack-plugin</a></li><li class="sidebar-sub-header"><a href="/webpack/backup/02-webpack-optimize.html#_2-dll" class="sidebar-link">2.DLL</a></li><li class="sidebar-sub-header"><a href="/webpack/backup/02-webpack-optimize.html#_3-多进程处理" class="sidebar-link">3. 多进程处理</a></li><li class="sidebar-sub-header"><a href="/webpack/backup/02-webpack-optimize.html#_4-cdn" class="sidebar-link">4. CDN</a></li><li class="sidebar-sub-header"><a href="/webpack/backup/02-webpack-optimize.html#_5-tree-shaking" class="sidebar-link">5.Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/webpack/backup/02-webpack-optimize.html#_6-代码分割" class="sidebar-link">6.代码分割</a></li><li class="sidebar-sub-header"><a href="/webpack/backup/02-webpack-optimize.html#_7-开启-scope-hoisting" class="sidebar-link">7.开启 Scope Hoisting</a></li><li class="sidebar-sub-header"><a href="/webpack/backup/02-webpack-optimize.html#_8-用-hmr-提高开发效率" class="sidebar-link">8. 用 HMR 提高开发效率</a></li></ul></li><li><a href="/webpack/backup/03-webpack-file.html" class="sidebar-link">03. Webpack file</a></li><li><a href="/webpack/backup/04-webpack-tapable.html" class="sidebar-link">04. Webpack Tapable</a></li><li><a href="/webpack/backup/05-webpack-ast.html" class="sidebar-link">05. AST</a></li><li><a href="/webpack/backup/06-webpack-source.html" class="sidebar-link">06. Webpack Source</a></li><li><a href="/webpack/backup/07-webpack-loader.html" class="sidebar-link">07. Webpack Loader</a></li><li><a href="/webpack/backup/08-webpack-plugin.html" class="sidebar-link">08. Webpack Plugin</a></li><li><a href="/webpack/backup/09-webpack-hand.html" class="sidebar-link">09. Webpack hand</a></li><li><a href="/webpack/backup/10-webpack-prepare.html" class="sidebar-link">10. Webpack Prepare</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/flutter/" class="sidebar-heading clickable"><span>flutter</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/interview/" class="sidebar-heading clickable"><span>interview</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/other/" class="sidebar-heading clickable"><span>other</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_02-webpack-optimize"><a href="#_02-webpack-optimize" class="header-anchor">#</a> 02. Webpack optimize</h1> <h2 id="_1-purgecss-webpack-plugin"><a href="#_1-purgecss-webpack-plugin" class="header-anchor">#</a> 1. purgecss-webpack-plugin</h2> <ul><li><a href="https://www.purgecss.com/" target="_blank" rel="noopener noreferrer">purgecss<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>可以去除未使用的 css，一般与 glob、glob-all 配合使用</li> <li>必须和<code>mini-css-extract-plugin</code>配合使用</li> <li><code>paths</code>路径是绝对路径</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> purgecss<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin mini<span class="token operator">-</span>css<span class="token operator">-</span>extract<span class="token operator">-</span>plugin glob
</code></pre></div><p>webpack.config.js</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted">+ const glob = require('glob');
+ const PurgecssPlugin = require('purgecss-webpack-plugin');
</span>
module.exports = {
<span class="token unchanged">  mode: 'development',
  plugins: [
</span><span class="token inserted-sign inserted">+    new PurgecssPlugin({
+      paths: glob.sync(`${path.join(__dirname, 'src')}/**/*`
+    }),
</span><span class="token unchanged">  ],
</span>}
plugins: [
<span class="token inserted-sign inserted">+        new MiniCssExtractPlugin({
+            filename: '[name].css',
+            chunkFilename:'[id].css'
+        }),
</span>
{
<span class="token unchanged">                test: /\.css/,
                include: path.resolve(__dirname,'src'),
                exclude: /node_modules/,
                use: [{
</span><span class="token inserted-sign inserted">+                    loader: MiniCssExtractPlugin.loader
</span><span class="token unchanged">                },'css-loader']
            }
</span></code></pre></div><h2 id="_2-dll"><a href="#_2-dll" class="header-anchor">#</a> 2.DLL</h2> <ul><li><code>.dll</code>为后缀的文件称为动态链接库，在一个动态链接库中可以包含给其他模块调用的函数和数据</li> <li>把基础模块独立出来打包到单独的动态连接库里</li> <li>当需要导入的模块在动态连接库里的时候，模块不能再次被打包，而是去动态连接库里获取</li> <li><a href="https://webpack.js.org/plugins/dll-plugin/" target="_blank" rel="noopener noreferrer">dll-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="_2-1-定义dll"><a href="#_2-1-定义dll" class="header-anchor">#</a> 2.1 定义Dll</h3> <ul><li>DllPlugin插件： 用于打包出一个个动态连接库</li> <li>DllReferencePlugin: 在配置文件中引入DllPlugin插件打包好的动态连接库</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> DllPlugin<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/DllPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        react<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span><span class="token string">'react-dom'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 把 React 相关模块的放到一个单独的动态链接库</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// 输出的文件都放到 dist 目录下</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span><span class="token comment">//输出的动态链接库的文件名称，[name] 代表当前动态链接库的名称</span>
        library<span class="token operator">:</span> <span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span><span class="token comment">//存放动态链接库的全局变量名称,例如对应 react 来说就是 _dll_react</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 动态链接库的全局变量名称，需要和 output.library 中保持一致</span>
            <span class="token comment">// 该字段的值也就是输出的 manifest.json 文件 中 name 字段的值</span>
            <span class="token comment">// 例如 react.manifest.json 中就有 &quot;name&quot;: &quot;_dll_react&quot;</span>
            name<span class="token operator">:</span> <span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span>
            <span class="token comment">// 描述动态链接库的 manifest.json 文件输出时的文件名称</span>
            path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">,</span> <span class="token string">'[name].manifest.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
webpack <span class="token operator">--</span>config webpack<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js <span class="token operator">--</span>mode development
</code></pre></div><h3 id="_2-2-使用动态链接库文件"><a href="#_2-2-使用动态链接库文件" class="header-anchor">#</a> 2.2 使用动态链接库文件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> DllReferencePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/DllReferencePlugin'</span><span class="token punctuation">)</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    manifest<span class="token operator">:</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/react.manifest.json'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
webpack <span class="token operator">--</span>config webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js <span class="token operator">--</span>mode development
</code></pre></div><h3 id="_2-3-html中使用"><a href="#_2-3-html中使用" class="header-anchor">#</a> 2.3 html中使用</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>react.dll.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bundle.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_3-多进程处理"><a href="#_3-多进程处理" class="header-anchor">#</a> 3. 多进程处理</h2> <h3 id="_3-1-thread-loader"><a href="#_3-1-thread-loader" class="header-anchor">#</a> 3.1 thread-loader</h3> <ul><li>把这个 loader 放置在其他 loader 之前， 放置在这个 loader 之后的 loader 就会在一个单独的 worker 池(worker pool)中运行</li> <li><a href="https://webpack.js.org/loaders/thread-loader/" target="_blank" rel="noopener noreferrer">thread-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(js)$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
           <span class="token punctuation">{</span>
            loader<span class="token operator">:</span><span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span><span class="token punctuation">{</span>
              workers<span class="token operator">:</span><span class="token number">3</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> 
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span><span class="token string">'babel-loader'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-cdn"><a href="#_4-cdn" class="header-anchor">#</a> 4. CDN</h2> <ul><li><a href="https://www.qiniu.com/" target="_blank" rel="noopener noreferrer">qiniu<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>CDN 又叫内容分发网络，通过把资源部署到世界各地，用户在访问时按照就近原则从离用户最近的服务器获取资源，从而加速资源的获取速度。</li></ul> <p><img src="https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2020-04-22-064607.jpg" alt="cdn"></p> <ul><li>HTML文件不缓存，放在自己的服务器上，关闭自己服务器的缓存，静态资源的URL变成指向CDN服务器的地址</li> <li>静态的JavaScript、CSS、图片等文件开启CDN和缓存，并且文件名带上HASH值</li> <li>为了并行加载不阻塞，把不同的静态资源分配到不同的CDN服务器上</li></ul> <h3 id="_4-1-使用缓存"><a href="#_4-1-使用缓存" class="header-anchor">#</a> 4.1 使用缓存</h3> <ul><li>由于 CDN 服务一般都会给资源开启很长时间的缓存，例如用户从 CDN 上获取到了 index.html 这个文件后， 即使之后的发布操作把 index.html 文件给重新覆盖了，但是用户在很长一段时间内还是运行的之前的版本，这会新的导致发布不能立即生效 解决办法</li> <li>针对 HTML 文件：不开启缓存，把 HTML 放到自己的服务器上，而不是 CDN 服务上，同时关闭自己服务器上的缓存。自己的服务器只提供 HTML 文件和数据接口。</li> <li>针对静态的 JavaScript、CSS、图片等文件：开启 CDN 和缓存，上传到 CDN 服务上去，同时给每个文件名带上由文件内容算出的 Hash 值</li> <li>带上 Hash 值的原因是文件名会随着文件内容而变化，只要文件发生变化其对应的 URL 就会变化，它就会被重新下载，无论缓存时间有多长。</li> <li>启用CDN之后 相对路径，都变成了绝对的指向 CDN 服务的 URL 地址</li></ul> <h3 id="_4-2-域名限制"><a href="#_4-2-域名限制" class="header-anchor">#</a> 4.2 域名限制</h3> <ul><li>同一时刻针对同一个域名的资源并行请求是有限制</li> <li>可以把这些静态资源分散到不同的 CDN 服务上去</li> <li>多个域名后会增加域名解析时间</li> <li>可以通过在 HTML HEAD 标签中 加入``去预解析域名，以降低域名解析带来的延迟</li></ul> <h3 id="_4-3-接入cdn"><a href="#_4-3-接入cdn" class="header-anchor">#</a> 4.3 接入CDN</h3> <p>要给网站接入 CDN，需要把网页的静态资源上传到 CDN 服务上去，在服务这些静态资源的时候需要通过 CDN 服务提供的 URL 地址去访问</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged">    output: {
        path: path.resolve(__dirname, 'dist'),
</span><span class="token inserted-sign inserted">+        filename: '[name]_[hash:8].js',
+        publicPath: 'http://img.zhufengpeixun.cn'
</span><span class="token unchanged">    },
</span></code></pre></div><h2 id="_5-tree-shaking"><a href="#_5-tree-shaking" class="header-anchor">#</a> 5.Tree Shaking</h2> <ul><li>一个模块可以有多个方法，只要其中某个方法使用到了，则整个文件都会被打到bundle里面去，tree shaking就是只把用到的方法打入bundle,没用到的方法会uglify阶段擦除掉</li> <li>原理是利用es6模块的特点,只能作为模块顶层语句出现,import的模块名只能是字符串常量</li></ul> <h3 id="_5-1-开启"><a href="#_5-1-开启" class="header-anchor">#</a> 5.1 开启</h3> <ul><li>webpack默认支持，在.babelrc里设置<code>module:false</code>即可在<code>production mode</code>下默认开启</li> <li>还要注意把devtool设置为null</li></ul> <p>.babelrc</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged">    &quot;presets&quot;:[
</span><span class="token inserted-sign inserted">+        [&quot;@babel/preset-env&quot;,{&quot;modules&quot;:false}],//转译 ES6 ES7
</span><span class="token unchanged">        &quot;@babel/preset-react&quot;//转译JSX语法
    ],
</span></code></pre></div><h3 id="_5-2-没有导入和使用"><a href="#_5-2-没有导入和使用" class="header-anchor">#</a> 5.2 没有导入和使用</h3> <p>functions.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'func1'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token string">'func2'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
  func1<span class="token punctuation">,</span>
  func2
<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>func2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./functions'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result2 <span class="token operator">=</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-3-代码不会被执行，不可到达"><a href="#_5-3-代码不会被执行，不可到达" class="header-anchor">#</a> 5.3 代码不会被执行，不可到达</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'false'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-4-代码执行的结果不会被用到"><a href="#_5-4-代码执行的结果不会被用到" class="header-anchor">#</a> 5.4 代码执行的结果不会被用到</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>func2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./functions'</span><span class="token punctuation">;</span>
<span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-4-代码中只写不读的变量"><a href="#_5-4-代码中只写不读的变量" class="header-anchor">#</a> 5.4 代码中只写不读的变量</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> aabbcc<span class="token operator">=</span><span class="token string">'aabbcc'</span><span class="token punctuation">;</span>
aabbcc<span class="token operator">=</span><span class="token string">'eeffgg'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_6-代码分割"><a href="#_6-代码分割" class="header-anchor">#</a> 6.代码分割</h2> <h3 id="_6-1-代码分割的意义"><a href="#_6-1-代码分割的意义" class="header-anchor">#</a> 6.1 代码分割的意义</h3> <ul><li>对于大的Web应用来讲，将所有的代码都放在一个文件中显然是不够有效的，特别是当你的某些代码块是在某些特殊的时候才会被用到。</li> <li>webpack有一个功能就是将你的代码库分割成chunks语块，当代码运行到需要它们的时候再进行加载。 适用的场景</li> <li>抽离相同代码到一个共享块</li> <li>脚本懒加载，使得初始下载的代码更小</li></ul> <h3 id="_6-2-entry-points"><a href="#_6-2-entry-points" class="header-anchor">#</a> 6.2 Entry Points</h3> <ul><li>Entry Points：入口文件设置的时候可以配置</li> <li>这种方法的问题
<ul><li>如果入口 chunks 之间包含重复的模块(lodash)，那些重复模块都会被引入到各个 bundle 中</li> <li>不够灵活，并且不能将核心应用程序逻辑进行动态拆分代码</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        index<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
        login<span class="token operator">:</span> <span class="token string">&quot;./src/login.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-2-动态导入和懒加载"><a href="#_6-2-动态导入和懒加载" class="header-anchor">#</a> 6.2 动态导入和懒加载</h3> <ul><li>用户当前需要用什么功能就只加载这个功能对应的代码，也就是所谓的按需加载 在给单页应用做按需加载优化时，一般采用以下原则：
<ul><li>对网站功能进行划分，每一类一个chunk</li> <li>对于首次打开页面需要的功能直接加载，尽快展示给用户,某些依赖大量代码的功能点可以按需加载</li> <li>被分割出去的代码需要一个按需加载的时机</li></ul></li></ul> <p>hello.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#clickBtn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./hello'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>index.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clickBtn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_6-3-提取公共代码"><a href="#_6-3-提取公共代码" class="header-anchor">#</a> 6.3 提取公共代码</h3> <h3 id="_6-1-为什么需要提取公共代码"><a href="#_6-1-为什么需要提取公共代码" class="header-anchor">#</a> 6.1 为什么需要提取公共代码</h3> <p>大网站有多个页面，每个页面由于采用相同技术栈和样式代码，会包含很多公共代码，如果都包含进来会有问题</p> <ul><li>相同的资源被重复的加载，浪费用户的流量和服务器的成本；</li> <li>每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验。</li> <li>如果能把公共代码抽离成单独文件进行加载能进行优化，可以减少网络传输流量，降低服务器成本</li></ul> <h3 id="_6-2-如何提取"><a href="#_6-2-如何提取" class="header-anchor">#</a> 6.2 如何提取</h3> <ul><li>基础类库，方便长期缓存</li> <li>页面之间的公用代码</li> <li>各个页面单独生成文件</li> <li><a href="https://www.webpackjs.com/plugins/split-chunks-plugin/" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/webpack/webpack/tree/master/examples/common-chunk-and-vendor-chunk" target="_blank" rel="noopener noreferrer">common-chunk-and-vendor-chunk<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>webpack将会基于以下条件自动分割代码块:
<ul><li>新的代码块被共享或者来自node_modules文件夹</li> <li>新的代码块大于30kb(在min+giz之前)</li> <li>按需加载代码块的请求数量应该&lt;=5</li> <li>页面初始化时加载代码块的请求数量应该&lt;=3</li></ul></li></ul> <p>默认配置</p> <div class="language-js extra-class"><pre class="language-js"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
            chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span><span class="token comment">//默认作用于异步chunk，值为all/initial/async</span>
            minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>  <span class="token comment">//默认值是30kb,代码块的最小尺寸</span>
            minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">//被多少模块共享,在分割之前模块的被引用次数</span>
            maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token comment">//按需加载最大并行请求数量</span>
            maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment">//一个入口的最大并行请求数量</span>
            name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//打包后的名称，默认是chunk的名字通过分隔符（默认是～）分隔开，如vendor~</span>
            automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span><span class="token comment">//默认webpack将会使用入口名和代码块的名称生成命名,比如 'vendors~main.js'</span>
            cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//设置缓存组用来抽取满足不同规则的chunk,下面以生成common为例</span>
                vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
                    chunks<span class="token operator">:</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span>
                    test<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span><span class="token comment">//条件</span>
                    priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span> <span class="token comment">///优先级，一个chunk很可能满足多个缓存组，会被抽取到优先级高的缓存组中,为了能够让自定义缓存组有更高的优先级(默认0),默认缓存组的priority属性为负值.</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                commons<span class="token operator">:</span> <span class="token punctuation">{</span>
                    chunks<span class="token operator">:</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span>
                    minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//最小提取字节数</span>
                    minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//最少被几个chunk引用</span>
                    priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
                    reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token comment">//    如果该chunk中引用了已经被抽取的chunk，直接引用该chunk，不会重复打包代码</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-3-提取公共代码-2"><a href="#_6-3-提取公共代码-2" class="header-anchor">#</a> 6.3 提取公共代码</h3> <p>pageA.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> utils1 <span class="token keyword">from</span> <span class="token string">'./utils1'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> utils2 <span class="token keyword">from</span> <span class="token string">'./utils2'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utils1<span class="token punctuation">,</span>utils2<span class="token punctuation">,</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>pageB.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> utils1 <span class="token keyword">from</span> <span class="token string">'./utils1'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> utils2 <span class="token keyword">from</span> <span class="token string">'./utils2'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utils1<span class="token punctuation">,</span>utils2<span class="token punctuation">,</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
</code></pre></div><p>pageC.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> utils3 <span class="token keyword">from</span> <span class="token string">'./utils3'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> utils1 <span class="token keyword">from</span> <span class="token string">'./utils1'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utils1<span class="token punctuation">,</span>utils3<span class="token punctuation">,</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>utils1.js</p> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div><p>utils2.js</p> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div><p>utils3.js</p> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        pageA<span class="token operator">:</span> <span class="token string">'./src/pageA'</span><span class="token punctuation">,</span>
        pageB<span class="token operator">:</span> <span class="token string">'./src/pageB'</span><span class="token punctuation">,</span>
        pageC<span class="token operator">:</span> <span class="token string">'./src/pageC'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
       <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'pageA.html'</span><span class="token punctuation">,</span>
            excludeChunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'pageB'</span><span class="token punctuation">,</span><span class="token string">'pageC'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'pageB.html'</span><span class="token punctuation">,</span>
            excludeChunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'pageA'</span><span class="token punctuation">,</span><span class="token string">'pageC'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'pageC.html'</span><span class="token punctuation">,</span>
            excludeChunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'pageA'</span><span class="token punctuation">,</span><span class="token string">'pageB'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
</code></pre></div><p><img src="https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2020-04-22-064613.png" alt="splitchunks"></p> <h2 id="_7-开启-scope-hoisting"><a href="#_7-开启-scope-hoisting" class="header-anchor">#</a> 7.开启 Scope Hoisting</h2> <ul><li>Scope Hoisting 可以让 Webpack 打包出来的代码文件更小、运行的更快， 它又译作 &quot;作用域提升&quot;，是在 Webpack3 中新推出的功能。</li> <li>初webpack转换后的模块会包裹上一层函数,import会转换成require</li> <li>代码体积更小，因为函数申明语句会产生大量代码</li> <li>代码在运行时因为创建的函数作用域更少了，内存开销也随之变小</li> <li>大量作用域包裹代码会导致体积增大</li> <li>运行时创建的函数作用域变多，内存开销增大</li> <li>scope hoisting的原理是将所有的模块按照引用顺序放在一个函数作用域里，然后适当地重命名一些变量以防止命名冲突</li> <li>这个功能在mode为production下默认开启,开发环境要用 <code>webpack.optimize.ModuleConcatenationPlugin</code>插件</li> <li>也要使用ES6 Module,CJS不支持</li></ul> <h3 id="_7-1-开发环境插件配置"><a href="#_7-1-开发环境插件配置" class="header-anchor">#</a> 7.1 开发环境插件配置</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 针对 Npm 中的第三方模块优先采用 jsnext:main 中指向的 ES6 模块化语法的文件</span>
    mainFields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'jsnext:main'</span><span class="token punctuation">,</span> <span class="token string">'browser'</span><span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 开启 Scope Hoisting</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>ModuleConcatenationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-2-代码"><a href="#_7-2-代码" class="header-anchor">#</a> 7.2 代码</h3> <p>hello.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> str <span class="token keyword">from</span> <span class="token string">'./hello.js'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出的结果main.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;./src/index.js&quot;</span><span class="token operator">:</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> hello <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>函数由两个变成了一个，hello.js 中定义的内容被直接注入到了 main.js 中</p></blockquote> <h2 id="_8-用-hmr-提高开发效率"><a href="#_8-用-hmr-提高开发效率" class="header-anchor">#</a> 8. 用 HMR 提高开发效率</h2> <ul><li>HMR 全称是 Hot Module Replacement，即模块热替换</li> <li>Hot Reloading，当代码变更时通知浏览器刷新页面，以避免频繁手动刷新浏览器页面</li> <li>HMR 可以理解为增强版的 Hot Reloading，但不用整个页面刷新，而是局部替换掉部分模块代码并且使其生效</li> <li>原理是当一个源码发生变化时，只重新编译发生变化的模块，再用新输出的模块替换掉浏览器中对应的老模块</li> <li>模块热替换技术的优势有：
<ul><li>实时预览反应更快，等待时间更短。</li> <li>不刷新浏览器能保留当前网页的运行状态，例如在使用 Redux 来管理数据的应用中搭配模块热替换能做到代码更新时Redux 中的数据还保持不变</li></ul></li></ul> <h3 id="_8-1-模块热替换原理"><a href="#_8-1-模块热替换原理" class="header-anchor">#</a> 8.1 模块热替换原理</h3> <ul><li>模块热替换的原理和自动刷新原理类似，都需要往要开发的网页中注入一个代理客户端用于连接 DevServer 和网页</li></ul> <p><img src="https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2020-04-22-064618.png" alt="hotupdate"></p> <h3 id="_8-2-配置"><a href="#_8-2-配置" class="header-anchor">#</a> 8.2 配置</h3> <h4 id="_8-2-1-配置hot"><a href="#_8-2-1-配置hot" class="header-anchor">#</a> 8.2.1 配置hot</h4> <ul><li><p>DevServer 默认不会开启模块热替换模式，要开启该模式，只需在启动时带上参数</p> <div class="language- extra-class"><pre class="language-text"><code>--hot
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
entry<span class="token operator">:</span><span class="token punctuation">{</span>
  main<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token comment">// 该插件的作用就是实现模块热替换，实际上当启动时带上 `--hot` 参数，会注入该插件，生成 .hot-update.json 文件。</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 用于启动 HMR 时可以显示模块的相对路径</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Hot Module Replacement 的插件</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
devServer<span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token comment">// 告诉 DevServer 要开启模块热替换模式</span>
  hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      
<span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>在启动 Webpack 时带上参数 --hot 其实就是自动为你完成以上配置。</p></blockquote></li></ul> <h4 id="_8-2-2-代码实现"><a href="#_8-2-2-代码实现" class="header-anchor">#</a> 8.2.2 代码实现</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 只有当开启了模块热替换时 module.hot 才存在</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// accept 函数的第一个参数指出当前文件接受哪些子模块的替换，这里表示只接受 ./AppComponent 这个子模块</span>
  <span class="token comment">// 第2个参数用于在新的子模块加载完毕后需要执行的逻辑</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./App'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 新的 AppComponent 加载成功后重新执行下组建渲染逻辑</span>
    <span class="token keyword">let</span> App<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./App'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>  
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>module.hot 是当开启模块热替换后注入到全局的 API，用于控制模块热替换的逻辑</li> <li>当子模块发生更新时，更新事件会一层层往上传递，也就是从<code>App.js</code>文件传递到<code>index.js</code>文件， 直到有某层的文件接受了当前变化的模块</li> <li>如果事件一直往上抛到最外层都没有文件接受它，就会直接刷新网页</li> <li><code>.css</code>文件都会触发模块热替换的原因是<code>style-loader</code>会注入用于接受 CSS 的代码</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">7/11/2020, 3:44:30 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/webpack/backup/01-webpack-basic.html" class="prev">
        01 Webpack基础
      </a></span> <span class="next"><a href="/webpack/backup/03-webpack-file.html">
        03. Webpack file
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2af561cb.js" defer></script><script src="/assets/js/2.b2a5c435.js" defer></script><script src="/assets/js/73.2d754e71.js" defer></script>
  </body>
</html>
